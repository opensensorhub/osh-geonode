!function(){var initializing=!1,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.BaseClass=function(){},BaseClass.extend=function(prop){function BaseClass(){!initializing&&this.initialize&&this.initialize.apply(this,arguments)}var _super=this.prototype;initializing=!0;var prototype=new this;initializing=!1;for(var name in prop)"function"==typeof prop[name]&&"function"==typeof _super[name]&&fnTest.test(prop[name])?prototype[name]=function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(name,prop[name]):prototype[name]=prop[name];return BaseClass.prototype=prototype,BaseClass.prototype.constructor=BaseClass,BaseClass.extend=arguments.callee,BaseClass}}();
function isUndefined(object){return void 0===object}function isUndefinedOrNull(object){return void 0===object||null===object}function assert(condition,message){if(!condition){if(message=message||"Assertion failed","undefined"!=typeof Error)throw new Error(message);throw message}}var OSH={version:"1.3"};window.OSH=OSH,window.OSH.Exception={},window.OSH.Video={},window.OSH.UI={},window.OSH.UI.View={},window.OSH.Styler={},window.OSH.ContextMenu={},window.OSH.DataReceiver={},window.OSH.DataConnector={},window.OSH.Utils={},window.OSH.Helper={},window.OSH.DataSender={},window.OSH.BASE_WORKER_URL="js/workers",String.prototype.replaceAll=function(search,replacement){return this.replace(new RegExp(search,"g"),replacement)},Function.prototype.toSource=function(){return this.toString().replace(/^[^{]*{\s*/,"").replace(/\s*}[^}]*$/,"").trim()},Element.prototype.insertChildAtIndex=function(child,index){index||(index=0),index>=this.children.length?this.appendChild(child):this.insertBefore(child,this.children[index])};
!function(){var ua=navigator.userAgent.toLowerCase(),doc=document.documentElement,ie="ActiveXObject"in window,webkit=ua.indexOf("webkit")!==-1,phantomjs=ua.indexOf("phantom")!==-1,android23=ua.search("android [23]")!==-1,chrome=ua.indexOf("chrome")!==-1,gecko=ua.indexOf("gecko")!==-1&&!webkit&&!window.opera&&!ie,win=0===navigator.platform.indexOf("Win"),mobile="undefined"!=typeof orientation||ua.indexOf("mobile")!==-1,msPointer=!window.PointerEvent&&window.MSPointerEvent,pointer=window.PointerEvent||msPointer,ie3d=ie&&"transition"in doc.style,webkit3d="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!android23,gecko3d="MozPerspective"in doc.style,opera12="OTransition"in doc.style,touch=!window.L_NO_TOUCH&&(pointer||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);OSH.Browser={ie:ie,ielt9:ie&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:webkit,gecko:gecko,android:ua.indexOf("android")!==-1,android23:android23,chrome:chrome,safari:!chrome&&ua.indexOf("safari")!==-1,win:win,ie3d:ie3d,webkit3d:webkit3d,gecko3d:gecko3d,opera12:opera12,any3d:!window.L_DISABLE_3D&&(ie3d||webkit3d||gecko3d)&&!opera12&&!phantomjs,mobile:mobile,mobileWebkit:mobile&&webkit,mobileWebkit3d:mobile&&webkit3d,mobileOpera:mobile&&window.opera,mobileGecko:mobile&&gecko,touch:!!touch,msPointer:!!msPointer,pointer:!!pointer,retina:(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1}}();
OSH.Exception.Exception=function(msg,errorObj){var error=Error.apply(this,arguments);return error.name=this.name="OSH Exception",this.message=error.message,this.originalErrorObject=errorObj,this.stack=error.stack,this},OSH.Exception.Exception.prototype=Object.create(Error.prototype,{constructor:{value:OSH.Exception.Exception}}),OSH.Exception.Exception.prototype.printStackTrace=function(){console.error(this.stack)},OSH.Exception.Exception.prototype.getMessage=function(){return this.message},OSH.Exception.Exception.prototype.getOriginalError=function(){return this.originalErrorObject};
OSH.Asserts=function(){},OSH.Asserts.checkIsDefineOrNotNull=function(object){if(isUndefinedOrNull(object))throw new OSH.Exception.Exception("the object is undefined or null");return object},OSH.Asserts.checkObjectPropertyPath=function(object,path,errorMessage){if(!OSH.Utils.hasOwnNestedProperty(object,path)){var message="The path "+path+" for the object does not exists";throw isUndefinedOrNull(errorMessage)||(message=errorMessage),new OSH.Exception.Exception(message)}return object},OSH.Asserts.checkArrayIndex=function(array,index){if(0===array.length)throw new OSH.Exception.Exception("The array length is 0");if(index>array.length-1)throw new OSH.Exception.Exception("The given index of the array is out of range:"+index+" > "+(array.length-1))},OSH.Asserts.checkTrue=function(cond,errorMessage){if(!cond)throw isUndefinedOrNull(errorMessage)?new OSH.Exception.Exception("Assert failed, cond ["+cond+"] is not met"):new OSH.Exception.Exception(errorMessage)};
function onMouseUpdate(e){absoluteXposition=e.pageX,absoluteYposition=e.pageY}var MAX_LONG=Math.pow(2,53)+1;OSH.Utils=function(){},OSH.Utils.randomUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})},OSH.Utils.stampUUID=function(obj){return obj._osh_id=obj._osh_id||OSH.Utils.randomUUID(),obj._osh_id},OSH.Utils.jsonix_XML2JSON=function(xmlStr){SOS_2_0_Module_Factory();return new Jsonix.Context([XLink_1_0,IC_2_0,SMIL_2_0,SMIL_2_0_Language,GML_3_1_1,SWE_1_0_1,GML_3_2_1,OWS_1_1_0,SWE_2_0,SWES_2_0,WSN_T_1,WS_Addr_1_0_Core,OM_2_0,ISO19139_GMD_20070417,ISO19139_GCO_20070417,ISO19139_GSS_20070417,ISO19139_GTS_20070417,ISO19139_GSR_20070417,Filter_2_0,SensorML_2_0,SOS_2_0]).createUnmarshaller().unmarshalString(xmlStr)},OSH.Utils.jsonix_JSON2XML=function(jsonStr){SOS_2_0_Module_Factory();return new Jsonix.Context([XLink_1_0,IC_2_0,SMIL_2_0,SMIL_2_0_Language,GML_3_1_1,SWE_1_0_1,GML_3_2_1,OWS_1_1_0,SWE_2_0,SWES_2_0,WSN_T_1,WS_Addr_1_0_Core,OM_2_0,ISO19139_GMD_20070417,ISO19139_GCO_20070417,ISO19139_GSS_20070417,ISO19139_GTS_20070417,ISO19139_GSR_20070417,Filter_2_0,SensorML_2_0,SOS_2_0]).createMarshaller().marshalString(jsonStr)},OSH.Utils.ParseBytes=function(buffer,offset,type){var view=new DataView(buffer);return{double:function(offset){return{val:view.getFloat64(offset),bytes:8}},float64:function(offset){return{val:view.getFloat64(offset),bytes:8}},float32:function(offset){return{val:view.getFloat32(offset),bytes:4}},signedByte:function(offset){return{val:view.getInt8(offset),bytes:1}},signedInt:function(offset){return{val:view.getInt32(offset),bytes:4}},signedShort:function(offset){return{val:view.getInt16(offset),bytes:2}},unsignedByte:function(offset){return{val:view.getUint8(offset),bytes:1}},unsignedInt:function(offset){return{val:view.getUint32(offset),bytes:4}},unsignedShort:function(offset){return{val:view.getUint16(offset),bytes:2}}}[type](offset)},OSH.Utils.ReadData=function(struct,data,offsetBytes){for(var offset=offsetBytes,i=0;i<struct.fields.length;i++){var currFieldStruct=struct.fields[i];if(void 0!==currFieldStruct.type&&null!==currFieldStruct.type){var ret=OSH.Utils.ParseBytes(data,offset,currFieldStruct.type);currFieldStruct.val=ret.val,offset+=ret.bytes}else if(void 0!==currFieldStruct.count&&null!==currFieldStruct.count){if(isNaN(currFieldStruct.count)){var id=currFieldStruct.count,fieldName=struct.id2FieldMap[id];currFieldStruct.count=struct.findFieldByName(fieldName).val}for(var c=0;c<currFieldStruct.count;c++)for(var j=0;j<currFieldStruct.fields.length;j++){var field=JSON.parse(JSON.stringify(currFieldStruct.fields[j]));offset=OSH.Utils.ReadData(field,data,offset),currFieldStruct.val.push(field)}}}return offset},OSH.Utils.GetResultObject=function(resultStructure){for(var result={},i=0;i<resultStructure.fields.length;i++)if(void 0!==resultStructure.fields[i].count){result[resultStructure.fields[i].name]=[];for(var c=0;c<resultStructure.fields[i].count;c++){for(var item={},k=0;k<resultStructure.fields[i].val[c].fields.length;k++)item[resultStructure.fields[i].val[c].fields[k].name]=resultStructure.fields[i].val[c].fields[k].val;result[resultStructure.fields[i].name].push(item)}}else result[resultStructure.fields[i].name]=resultStructure.fields[i].val;return result},OSH.Utils.isOpera=function(){return!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0},OSH.Utils.isFirefox=function(){return"undefined"!=typeof InstallTrigger},OSH.Utils.isSafari=function(){return Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0},OSH.Utils.isIE=function(){return!!document.documentMode},OSH.Utils.isChrome=function(){return!!window.chrome&&!!window.chrome.webstore},OSH.Utils.isBlink=function(){return(isChrome||isOpera)&&!!window.CSS};var absoluteXposition=null,absoluteYposition=null;document.addEventListener("mousemove",onMouseUpdate,!1),document.addEventListener("mouseenter",onMouseUpdate,!1),OSH.Utils.getXCursorPosition=function(){return absoluteXposition},OSH.Utils.getYCursorPosition=function(){return absoluteYposition},OSH.Utils.isArrayIntersect=function(a,b){return a.filter(function(element){return b.indexOf(element)>-1}).length>0},OSH.Utils.isElement=function(o){return"object"==typeof HTMLElement?o instanceof HTMLElement:o&&"object"==typeof o&&null!==o&&1===o.nodeType&&"string"==typeof o.nodeName},OSH.Utils.isWebWorker=function(){return"undefined"!=typeof Worker},OSH.Utils.takeScreeshot=function(div){},OSH.Utils.removeCss=function(div,css){css=div.className.replace(css,""),div.className=css},OSH.Utils.containsCss=function(div,className){return div.className.indexOf(className)>-1},OSH.Utils.replaceCss=function(div,oldCss,newCss){css=div.className.replace(oldCss,newCss),div.className=css},OSH.Utils.addCss=function(div,css){OSH.Asserts.checkIsDefineOrNotNull(div),OSH.Asserts.checkIsDefineOrNotNull(css),OSH.Asserts.checkIsDefineOrNotNull(div.className);var split=div.className.split(" ");(isUndefinedOrNull(split)||!isUndefinedOrNull(split)&&split.length>0&&split.indexOf(css)===-1)&&div.setAttribute("class",div.className+" "+css)},OSH.Utils.removeLastCharIfExist=function(value,char){return void 0!==typeof value&&null!==value&&0!==value.length&&value.endsWith("/")?value.substring(0,value.length-1):value},OSH.Utils.copyProperties=function(from,to,forceMerge){for(var property in from)isUndefinedOrNull(to[property])||forceMerge||OSH.Utils.isFunction(from[property])||Array.isArray(from[property])?to[property]=from[property]:OSH.Utils.isObject(from[property])&&OSH.Utils.copyProperties(from[property],to[property]);return to},OSH.Utils.isFunction=function(object){return"function"===object||object instanceof Function},OSH.Utils.isObject=function(object){return"object"===object||object instanceof Object},OSH.Utils.traverse=function(o,func,params){for(var i in o)func.apply(this,[i,o[i],params]),null!==o[i]&&"object"==typeof o[i]&&(params.level=params.level+1,OSH.Utils.traverse(o[i],func,params),params.level=params.level-1)},OSH.Utils.clone=function(o){return clone(o)},OSH.Utils.getUOM=function(uomObject){var result,codeMap={Cel:"&#x2103;",deg:"&#176;"};if(!isUndefinedOrNull(uomObject)&&!isUndefinedOrNull(uomObject.code)){var code=uomObject.code;isUndefinedOrNull(codeMap[uomObject.code])||(code=codeMap[uomObject.code]),result=code}return result},OSH.Utils.arrayBufferToImageDataURL=function(arraybuffer){var blob=new Blob([new Uint8Array(arraybuffer)]);return URL.createObjectURL(blob)},OSH.Utils.getArrayBufferFromHttpImage=function(url,type,callback){var xhr=new XMLHttpRequest;xhr.open("GET",url,!0),xhr.responseType="arraybuffer",xhr.onload=function(e){callback(new Uint8Array(this.response))},xhr.send()},OSH.Utils.createJSEditor=function(parentElt,content){return OSH.Helper.HtmlHelper.addHTMLTextArea(parentElt,js_beautify(content))},OSH.Utils.hasOwnNestedProperty=function(obj,propertyPath){if(!propertyPath)return!1;for(var properties=propertyPath.split("."),i=0;i<properties.length;i++){var prop=properties[i];if(!obj||!obj.hasOwnProperty(prop))return!1;obj=obj[prop]}return!0},OSH.Utils.createXDomainRequest=function(){var xdr=null;if(window.XDomainRequest)xdr=new XDomainRequest;else{if(!window.XMLHttpRequest)throw new OSH.Exception.Exception("The browser does not handle cross-domain");xdr=new XMLHttpRequest}return xdr},OSH.Utils.checkUrlImage=function(url,callback){callback(null!=url.match(/\.(jpeg|jpg|gif|png)$/i),{remote:url.startsWith("http")||url.startsWith("https")})},OSH.Utils.circularJSONStringify=function(object){return function(e,t){function l(e,t,o){var d,u=[],f=[e],l=[e],c=[o?n:"[Circular]"],h=e,p=1;return function(e,v){return t&&(v=t.call(this,e,v)),""!==e&&(h!==this&&(d=p-a.call(f,this)-1,p-=d,f.splice(p,f.length),u.splice(p-1,u.length),h=this),"object"==typeof v&&v?(a.call(f,v)<0&&f.push(h=v),p=f.length,d=a.call(l,v),d<0?(d=l.push(v)-1,o?(u.push((""+e).replace(s,r)),c[d]=n+u.join(n)):c[d]=c[0]):v=c[d]):"string"==typeof v&&o&&(v=v.replace(r,i).replace(n,r))),v}}function c(e,t){for(var r=0,i=t.length;r<i;e=e[t[r++].replace(o,n)]);return e}function h(e){return function(t,s){var o="string"==typeof s;return o&&s.charAt(0)===n?new f(s.slice(1)):(""===t&&(s=v(s,s,{})),o&&(s=s.replace(u,"$1"+n).replace(i,r)),e?e.call(this,t,s):s)}}function p(e,t,n){for(var r=0,i=t.length;r<i;r++)t[r]=v(e,t[r],n);return t}function d(e,t,n){for(var r in t)t.hasOwnProperty(r)&&(t[r]=v(e,t[r],n));return t}function v(e,t,r){return t instanceof Array?p(e,t,r):t instanceof f?t.length?r.hasOwnProperty(t)?r[t]:r[t]=c(e,t.split(n)):e:t instanceof Object?d(e,t,r):t}function m(t,n,r,i){return e.stringify(t,l(t,n,!i),r)}function g(t,n){return e.parse(t,h(n))}var n="~",r="\\x"+("0"+n.charCodeAt(0).toString(16)).slice(-2),i="\\"+r,s=new t(r,"g"),o=new t(i,"g"),u=new t("(?:^|([^\\\\]))"+i),a=[].indexOf||function(e){for(var t=this.length;t--&&this[t]!==e;);return t},f=String;return{stringify:m,parse:g}}(JSON,RegExp).stringify(object)},OSH.Utils.destroyElement=function(element){OSH.Asserts.checkIsDefineOrNotNull(element),OSH.Asserts.checkIsDefineOrNotNull(element.parentNode),element.parentNode.removeChild(element)},OSH.Utils.getChildNumber=function(node){return Array.prototype.indexOf.call(node.parentNode.children,node)},OSH.Utils.searchPropertyByValue=function(object,propertyValue,resultArray){for(var property in object)if(!isUndefinedOrNull(object[property]))if(OSH.Utils.isObject(object[property]))OSH.Utils.searchPropertyByValue(object[property],propertyValue,resultArray);else if(Array.isArray(object[property])&&object[property].indexOf(propertyValue)>-1)resultArray.push(object);else{if(OSH.Utils.isFunction(object[property]))continue;object[property]===propertyValue&&resultArray.push(object)}},OSH.Utils.binaryStringToBlob=function(binaryString){for(var array=new Uint8Array(binaryString.length),i=0;i<binaryString.length;i++)array[i]=binaryString.charCodeAt(i);var blob=new Blob([array],{type:"application/octet-stream"});return URL.createObjectURL(blob)},OSH.Utils.fixSelectable=function(oElement,bGotFocus){for(var oParent=oElement.parentNode;null!==oParent&&!/\bdraggable\b/.test(oParent.className);)oParent=oParent.parentNode;null!==oParent&&(oParent.draggable=!bGotFocus)},OSH.Utils.getSomeParentTheClass=function(element,classname){return element.className.split(" ").indexOf(classname)>=0?element:element.parentNode&&OSH.Utils.getSomeParentTheClass(element.parentNode,classname)},OSH.Utils.getObjectById=function(objectId,callbackFn){OSH.EventManager.observe(OSH.EventManager.EVENT.GET_OBJECT+"-"+objectId,function(event){OSH.EventManager.remove(OSH.EventManager.EVENT.GET_OBJECT+"-"+objectId),callbackFn(event)}),OSH.EventManager.fire(OSH.EventManager.EVENT.SEND_OBJECT+"-"+objectId)};
OSH.Helper.HtmlHelper=function(){},OSH.Helper.HtmlHelper.createHTMLTitledLine=function(title){var div=document.createElement("div");return div.setAttribute("class","horizontal-titled-line"),div.innerHTML=title,div},OSH.Helper.HtmlHelper.createHTMLLine=function(title){var div=document.createElement("div");return div.setAttribute("class","horizontal-line"),div},OSH.Helper.HtmlHelper.addHTMLLine=function(parentElt){parentElt.appendChild(OSH.Helper.HtmlHelper.createHTMLLine())},OSH.Helper.HtmlHelper.addHTMLTitledLine=function(parentElt,title){parentElt.appendChild(OSH.Helper.HtmlHelper.createHTMLTitledLine(title))},OSH.Helper.HtmlHelper.HTMLListBoxSetSelected=function(listboxElt,defaultValue){if(!isUndefinedOrNull(defaultValue)&&""!==defaultValue)for(var i=0;i<listboxElt.options.length;i++){var currentOption=listboxElt.options[i].value;if(currentOption===defaultValue){listboxElt.options[i].setAttribute("selected","");break}}},OSH.Helper.HtmlHelper.addHTMLTextArea=function(parentElt,content){var ulElt=document.createElement("ul");ulElt.setAttribute("class","osh-ul");var liElt=document.createElement("li");liElt.setAttribute("class","osh-li");var textareaId=OSH.Utils.randomUUID(),textAreaElt=document.createElement("textarea");return textAreaElt.setAttribute("class","text-area"),textAreaElt.setAttribute("id",textareaId),textAreaElt.value=content,textAreaElt.onfocus=function(e){OSH.Utils.fixSelectable(this,!0)},textAreaElt.onblur=function(e){OSH.Utils.fixSelectable(this,!1)},liElt.appendChild(textAreaElt),ulElt.appendChild(liElt),parentElt.appendChild(ulElt),textareaId},OSH.Helper.HtmlHelper.onDomReady=function(callback){!function(name,definition){"undefined"!=typeof module?module.exports=definition():"function"==typeof define&&"object"==typeof define.amd?define(definition):this.domready=definition()}(0,function(){var listener,fns=[],doc="object"==typeof document&&document,hack=doc&&doc.documentElement.doScroll,loaded=doc&&(hack?/^loaded|^c/:/^loaded|^i|^c/).test(doc.readyState);return!loaded&&doc&&doc.addEventListener("DOMContentLoaded",listener=function(){for(doc.removeEventListener("DOMContentLoaded",listener),loaded=1;listener=fns.shift();)listener()}),function(fn){loaded?setTimeout(fn,0):fns.push(fn)}}),domready(callback)},OSH.Helper.HtmlHelper.addFileChooser=function(div,createPreview,defaultInputDivId){return OSH.Helper.HtmlHelper.addTitledFileChooser(div,null,createPreview,defaultInputDivId)},OSH.Helper.HtmlHelper.addTitledFileChooser=function(div,label,createPreview,defaultInputDivId){var id=OSH.Utils.randomUUID();isUndefined(defaultInputDivId)||(id=defaultInputDivId);var ulElt=document.createElement("ul");ulElt.setAttribute("class","osh-ul");var liElt=document.createElement("li");if(liElt.setAttribute("class","osh-li"),!isUndefinedOrNull(label)){var labelElt=document.createElement("label");labelElt.innerHTML=label}var labelForElt=document.createElement("label");labelForElt.setAttribute("class","input-file-label-for"),labelForElt.setAttribute("for",id);var iElt=document.createElement("i");iElt.setAttribute("class","fa input-file-i"),iElt.setAttribute("aria-hidden","true"),labelForElt.appendChild(iElt);var inputTextElt=document.createElement("input");inputTextElt.setAttribute("class","input-file-text"),inputTextElt.setAttribute("id","text-"+id),inputTextElt.setAttribute("type","text"),inputTextElt.setAttribute("name","file-text-"+id),inputTextElt.onfocus=function(e){OSH.Utils.fixSelectable(this,!0)},inputTextElt.onblur=function(e){OSH.Utils.fixSelectable(this,!1)};var inputFileElt=document.createElement("input");if(inputFileElt.setAttribute("class","input-file"),inputFileElt.setAttribute("id",id),inputFileElt.setAttribute("type","file"),inputFileElt.setAttribute("name","file-"+id),isUndefinedOrNull(label)||liElt.appendChild(labelElt),liElt.appendChild(labelForElt),liElt.appendChild(inputFileElt),liElt.appendChild(inputTextElt),ulElt.appendChild(liElt),!isUndefinedOrNull(createPreview)&&createPreview){var prevId=OSH.Utils.randomUUID(),divPrevElt=document.createElement("div");divPrevElt.setAttribute("class","preview"),divPrevElt.setAttribute("id",prevId),OSH.Utils.addCss(inputFileElt,"preview"),OSH.Utils.addCss(inputTextElt,"preview"),liElt.appendChild(divPrevElt),function(inputElt){OSH.Helper.HtmlHelper.onDomReady(function(){inputElt.addEventListener("change",function(evt){var file=evt.target.files[0],reader=new FileReader,inputElt=this;reader.onload=function(theFile){return inputElt.nextSibling.text=theFile.name,inputElt.nextSibling.value=theFile.name,function(e){inputElt.parentNode.querySelectorAll("div.preview")[0].innerHTML=['<img class="thumb" src="',e.target.result,'" title="',escape(e.target.result),'"/>'].join("")}}(file),reader.readAsDataURL(file)},!1),inputElt.nextElementSibling.addEventListener("paste",function(evt){OSH.Asserts.checkIsDefineOrNotNull(evt);var clipboardData=evt.clipboardData||window.clipboardData,pastedData=clipboardData.getData("Text");this.parentNode.querySelectorAll("div.preview")[0].innerHTML=['<img class="thumb" src="',pastedData,'" title="',escape(pastedData),'"/>'].join("")})})}(inputFileElt),div.appendChild(ulElt)}else!function(inputElt){OSH.Helper.HtmlHelper.onDomReady(function(){inputElt.addEventListener("change",function(evt){var file=evt.target.files[0],reader=new FileReader,inputElt=this;reader.onload=function(theFile){inputElt.nextSibling.text=theFile.name,inputElt.nextSibling.value=theFile.name}(file),reader.readAsDataURL(file)},!1)})}(inputFileElt),div.appendChild(ulElt);return id},OSH.Helper.HtmlHelper.addColorPicker=function(parentElt,label,defaultValue,placeholder){var id=OSH.Utils.randomUUID(),ulElt=document.createElement("ul");ulElt.setAttribute("class","osh-ul");var liElt=document.createElement("li");liElt.setAttribute("class","osh-li");var inputElt=document.createElement("input");if(inputElt.setAttribute("id",id+""),inputElt.setAttribute("class","input-text"),inputElt.setAttribute("type","input-text"),inputElt.setAttribute("name",""+id),isUndefinedOrNull(defaultValue)||""===defaultValue||inputElt.setAttribute("value",defaultValue),isUndefinedOrNull(placeholder)||inputElt.setAttribute("placeholder",placeholder),!isUndefinedOrNull(label)){var labelElt=document.createElement("label");labelElt.setAttribute("for",""+id),labelElt.innerHTML=label+":",liElt.appendChild(labelElt)}var inputColorElt=document.createElement("input");inputColorElt.setAttribute("id","color-"+id),inputColorElt.setAttribute("class","input-color"),inputColorElt.setAttribute("type","color"),inputColorElt.setAttribute("name","color-"+id),OSH.Helper.HtmlHelper.onDomReady(function(){isUndefinedOrNull(defaultValue)||(inputColorElt.value=defaultValue,inputColorElt.select())});var regex=/^#(?:[0-9a-f]{6})$/i;return inputElt.addEventListener("keyup",function(event){regex.test(this.value)&&(inputColorElt.value=this.value,inputColorElt.select())},!1),inputColorElt.addEventListener("input",function(event){inputElt.value=event.target.value,inputElt.innerHTML=event.target.value},!1),inputColorElt.addEventListener("change",function(event){inputElt.value=event.target.value,inputElt.innerHTML=event.target.value},!1),liElt.appendChild(inputElt),liElt.appendChild(inputColorElt),ulElt.appendChild(liElt),parentElt.appendChild(ulElt),inputElt.onfocus=function(e){OSH.Utils.fixSelectable(this,!0)},inputElt.onblur=function(e){OSH.Utils.fixSelectable(this,!1)},id},OSH.Helper.HtmlHelper.addInputTextValueWithUOM=function(parentElt,label,placeholder,uom){var id=OSH.Utils.randomUUID(),ulElt=document.createElement("ul");ulElt.setAttribute("class","osh-ul");var liElt=document.createElement("li");liElt.setAttribute("class","osh-li");var inputElt=document.createElement("input");inputElt.setAttribute("id",id+""),inputElt.setAttribute("class","input-text input-uom"),inputElt.setAttribute("type","input-text"),inputElt.setAttribute("name",""+id),isUndefinedOrNull(placeholder)||inputElt.setAttribute("placeholder",placeholder);var uomElt=document.createElement("div");if(uomElt.setAttribute("class","uom"),uomElt.innerHTML=""+uom,!isUndefinedOrNull(label)){var labelElt=document.createElement("label");labelElt.setAttribute("for",""+id),labelElt.innerHTML=label+":",liElt.appendChild(labelElt)}return liElt.appendChild(inputElt),liElt.appendChild(uomElt),ulElt.appendChild(liElt),parentElt.appendChild(ulElt),inputElt.onfocus=function(e){OSH.Utils.fixSelectable(this,!0)},inputElt.onblur=function(e){OSH.Utils.fixSelectable(this,!1)},id},OSH.Helper.HtmlHelper.addInputText=function(parentElt,label,defaultValue,placeholder){var id=OSH.Utils.randomUUID(),ulElt=document.createElement("ul");ulElt.setAttribute("class","osh-ul");var liElt=document.createElement("li");liElt.setAttribute("class","osh-li");var inputElt=document.createElement("input");if(inputElt.setAttribute("id",id+""),inputElt.setAttribute("class","input-text"),inputElt.setAttribute("type","input-text"),inputElt.setAttribute("name",""+id),isUndefinedOrNull(defaultValue)||""===defaultValue||inputElt.setAttribute("value",defaultValue),isUndefinedOrNull(placeholder)||inputElt.setAttribute("placeholder",placeholder),!isUndefinedOrNull(label)){var labelElt=document.createElement("label");labelElt.setAttribute("for",""+id),labelElt.innerHTML=label+":",liElt.appendChild(labelElt)}return liElt.appendChild(inputElt),ulElt.appendChild(liElt),parentElt.appendChild(ulElt),inputElt.onfocus=function(e){OSH.Utils.fixSelectable(this,!0)},inputElt.onblur=function(e){OSH.Utils.fixSelectable(this,!1)},id},OSH.Helper.HtmlHelper.removeAllNodes=function(div){if(!isUndefinedOrNull(div))for(;div.firstChild;)div.removeChild(div.firstChild)},OSH.Helper.HtmlHelper.removeAllFromSelect=function(tagId){var i,selectTag=document.getElementById(tagId);for(i=selectTag.options.length-1;i>=0;i--)selectTag.remove(i)},OSH.Helper.HtmlHelper.addHTMLListBox=function(parentElt,label,values,defaultTitleOption,defaultSelectTagId){var id=OSH.Utils.randomUUID(),selectTagId=OSH.Utils.randomUUID(),ulElt=document.createElement("ul");ulElt.setAttribute("class","osh-ul");var liElt=document.createElement("li");if(liElt.setAttribute("class","osh-li"),isUndefinedOrNull(defaultSelectTagId)||(selectTagId=defaultSelectTagId),!isUndefinedOrNull(label)&&""!==label){var labelElt=document.createElement("label");labelElt.innerHTML=label,liElt.appendChild(labelElt)}var divElt=document.createElement("div");divElt.setAttribute("id",""+id),divElt.setAttribute("class","select-style");var selectElt=document.createElement("select");if(selectElt.setAttribute("id",""+selectTagId),!isUndefinedOrNull(defaultTitleOption)){var optionElt=document.createElement("option");optionElt.setAttribute("value",""),optionElt.setAttribute("disabled",""),optionElt.setAttribute("selected",""),optionElt.innerHTML=defaultTitleOption,selectElt.appendChild(optionElt)}if(!isUndefinedOrNull(values)){var optionElt,first=!0;for(var key in values)optionElt=document.createElement("option"),optionElt.setAttribute("value",values[key]),optionElt.innerHTML=values[key]+"",first&&(optionElt.setAttribute("selected",""),first=!1),selectElt.appendChild(optionElt)}return divElt.appendChild(selectElt),liElt.appendChild(divElt),ulElt.appendChild(liElt),parentElt.appendChild(ulElt),selectTagId},OSH.Helper.HtmlHelper.addHTMLObjectWithLabelListBox=function(parentElt,label,values,defaultTitleOption,defaultSelectTagId){var id=OSH.Utils.randomUUID(),selectTagId=OSH.Utils.randomUUID(),ulElt=document.createElement("ul");ulElt.setAttribute("class","osh-ul");var liElt=document.createElement("li");if(liElt.setAttribute("class","osh-li"),isUndefinedOrNull(defaultSelectTagId)||(selectTagId=defaultSelectTagId),!isUndefinedOrNull(label)&&""!==label){var labelElt=document.createElement("label");labelElt.innerHTML=label,liElt.appendChild(labelElt)}var divElt=document.createElement("div");divElt.setAttribute("id",""+id),divElt.setAttribute("class","select-style");var selectElt=document.createElement("select");if(selectElt.setAttribute("id",""+selectTagId),!isUndefinedOrNull(defaultTitleOption)){var optionElt=document.createElement("option");optionElt.setAttribute("value",""),optionElt.setAttribute("disabled",""),optionElt.setAttribute("selected",""),optionElt.innerHTML=defaultTitleOption,selectElt.appendChild(optionElt)}if(!isUndefinedOrNull(values)){var optionElt,first=!0;for(var key in values)optionElt=document.createElement("option"),optionElt.setAttribute("value",values[key].name),optionElt.innerHTML=values[key].name+"",optionElt.object=values[key],first&&(optionElt.setAttribute("selected",""),first=!1),selectElt.appendChild(optionElt)}return divElt.appendChild(selectElt),liElt.appendChild(divElt),ulElt.appendChild(liElt),parentElt.appendChild(ulElt),selectTagId},OSH.Helper.HtmlHelper.fireEvent=function(node,eventName){var doc;if(node.ownerDocument)doc=node.ownerDocument;else{if(9!=node.nodeType)throw new Error("Invalid node passed to fireEvent: "+node.id);doc=node}if(node.dispatchEvent){var eventClass="";switch(eventName){case"click":case"mousedown":case"mouseup":eventClass="MouseEvents";break;case"focus":case"change":case"blur":case"select":eventClass="HTMLEvents";break;default:throw"fireEvent: Couldn't find an event class for event '"+eventName+"'."}var event=doc.createEvent(eventClass);event.initEvent(eventName,!0,!0),event.synthetic=!0,node.dispatchEvent(event,!0)}else if(node.fireEvent){var event=doc.createEventObject();event.synthetic=!0,node.fireEvent("on"+eventName,event)}},OSH.Helper.HtmlHelper.addCheckbox=function(parentElt,label,defaultValue){var id=OSH.Utils.randomUUID(),ulElt=document.createElement("ul");ulElt.setAttribute("class","osh-ul");var liElt=document.createElement("li");liElt.setAttribute("class","osh-li");var checkboxElt=document.createElement("input");if(checkboxElt.setAttribute("id",id+""),checkboxElt.setAttribute("class","input-checkbox"),checkboxElt.setAttribute("type","checkbox"),checkboxElt.setAttribute("name",""+id),!isUndefinedOrNull(defaultValue)&&defaultValue&&checkboxElt.setAttribute("checked",""),!isUndefinedOrNull(label)){var labelElt=document.createElement("label");labelElt.setAttribute("for",""+id),labelElt.innerHTML=label+":",liElt.appendChild(labelElt)}return liElt.appendChild(checkboxElt),ulElt.appendChild(liElt),parentElt.appendChild(ulElt),id};
OSH.EventMap=BaseClass.extend({initialize:function(){this.eventMap={}},observe:function(eventName,fnCallback){isUndefinedOrNull(eventName)||isUndefinedOrNull(fnCallback)||(eventName in this.eventMap||(this.eventMap[eventName]=[]),this.eventMap[eventName].push(fnCallback))},fire:function(eventName,properties){if(!isUndefinedOrNull(eventName)&&eventName in this.eventMap)for(var fnCallbackArr=this.eventMap[eventName],i=0;i<fnCallbackArr.length;i++)fnCallbackArr[i](properties)},remove:function(eventName){isUndefinedOrNull(eventName)||delete this.eventMap[eventName]}});
OSH.EventManager=function(){};var eventMap=new OSH.EventMap;OSH.EventManager.fire=function(eventName,properties){isUndefinedOrNull(properties)?eventMap.fire("osh:"+eventName,{name:eventName}):(properties.name=eventName,eventMap.fire("osh:"+eventName,properties))},OSH.EventManager.observe=function(eventName,fnCallback){eventMap.observe("osh:"+eventName,fnCallback)},OSH.EventManager.remove=function(eventName){eventMap.remove("osh:"+eventName)},OSH.EventManager.observeDiv=function(divId,eventName,fnCallback){OSH.Asserts.checkIsDefineOrNotNull(divId),OSH.Helper.HtmlHelper.onDomReady(function(){elem=document.getElementById(divId),elem.addEventListener(eventName,fnCallback)})},OSH.EventManager.observeElement=function(element,eventName,fnCallback){OSH.Helper.HtmlHelper.onDomReady(function(){element.addEventListener(eventName,fnCallback)})},OSH.EventManager.EVENT={DATA:"data",SYNC_DATA:"syncData",SELECT_VIEW:"selectView",CONTEXT_MENU:"contextMenu",SHOW_VIEW:"showView",GET_OBJECT:"getObject",SEND_OBJECT:"sendObject",CONNECT_DATASOURCE:"connectDataSource",DISCONNECT_DATASOURCE:"disconnectDataSource",DATASOURCE_UPDATE_TIME:"updateDataSourceTime",CURRENT_MASTER_TIME:"currentMasterTime",UAV_TAKEOFF:"uav:takeoff",UAV_GOTO:"uav:goto",UAV_LOOKAT:"uav:lookat",UAV_LAND:"uav:land",UAV_ORBIT:"uav:orbit",LOADING_START:"loading:start",LOADING_STOP:"loading:stop",ADD_VIEW_ITEM:"addViewItem",REMOVE_VIEW_ITEM:"addViewItem",RESIZE:"resize",PTZ_SEND_REQUEST:"ptzSendRequest",EXCEPTION_MESSAGE:"exception_message",LOG:"log",SHOW:"show"};
var INITIAL_BUFFERING_TIME=3e3,BUFFER_STATUS={CANCEL:"cancel",START:"start",STOP:"stop",NOT_START_YET:"notStartYet"};OSH.Buffer=BaseClass.extend({initialize:function(options){this.buffers={},this.replayFactor=1,void 0!==options&&void 0!==options.replayFactor&&(this.replayFactor=options.replayFactor),this.stop=!1,this.isStarted=!1,this.bufferingState=!1},startObservers:function(){this.observeId=OSH.Utils.randomUUID(),this.boundHandlerMethod=this.push.bind(this),OSH.EventManager.observe(OSH.EventManager.EVENT.DATA,this.boundHandlerMethod,this.observeId)},stopObservers:function(){void 0===this.observeId&&null===this.observeId||(OSH.EventManager.observe(OSH.EventManager.EVENT.DATA,this.boundHandlerMethod,this.observeId),this.observeId=void 0)},start:function(){this.isStarted||(this.stop=!1,this.isStarted=!0,this.startObservers(),this.startRealTime=(new Date).getTime(),this.processSyncData())},stop:function(){this.stopObservers(),this.stop=!0,this.isStarted=!1},cancelAll:function(){for(var dataSourceId in this.buffers)this.cancelDataSource(dataSourceId)},cancelDataSource:function(dataSourceId){this.buffers[dataSourceId].buffer=[],this.buffers[dataSourceId].status=BUFFER_STATUS.CANCEL},startDataSource:function(dataSourceId){this.start(),this.buffers[dataSourceId].status=BUFFER_STATUS.NOT_START_YET,this.buffers[dataSourceId].lastRecordTime=Date.now()},startAll:function(){for(var dataSourceId in this.buffers)this.startDataSource(dataSourceId)},addDataSource:function(dataSourceId,options){this.buffers[dataSourceId]={buffer:[],syncMasterTime:!1,bufferingTime:INITIAL_BUFFERING_TIME,timeOut:3e3,lastRecordTime:Date.now(),status:BUFFER_STATUS.NOT_START_YET,name:"undefined"},void 0!==options&&(void 0!==options.syncMasterTime&&(this.buffers[dataSourceId].syncMasterTime=options.syncMasterTime),void 0!==options.bufferingTime&&(this.buffers[dataSourceId].bufferingTime=options.bufferingTime),void 0!==options.timeOut&&(this.buffers[dataSourceId].timeOut=options.timeOut),void 0!==options.name&&(this.buffers[dataSourceId].name=options.name))},removeDataSource:function(dataSourceId){dataSourceId in this.buffers&&delete this.buffers[dataSourceId]},addEntity:function(entity,options){if(void 0!==entity.dataSources)for(var i=0;i<entity.dataSources.length;i++)this.addDataSource(entity.dataSources[i],options)},push:function(event){var dataSourceId=event.dataSourceId,currentBufferObj=this.buffers[dataSourceId],sync=currentBufferObj.syncMasterTime;sync&&event.data.timeStamp<this.currentTime||currentBufferObj.status!=BUFFER_STATUS.CANCEL&&(currentBufferObj.status==BUFFER_STATUS.NOT_START_YET&&(currentBufferObj.startRelativeTime=event.data.timeStamp,currentBufferObj.startRelativeRealTime=(new Date).getTime(),currentBufferObj.status=BUFFER_STATUS.START),currentBufferObj.buffer.push(event.data),currentBufferObj.lastRecordTime=Date.now(),sync||this.processData(currentBufferObj,dataSourceId))},processSyncData:function(){if(!this.bufferingState){var minTimeStampBufferObj=null,minTimeStampDSId=null,minTimeStamp=MAX_LONG,currentBufferObj=null;for(var dataSourceId in this.buffers)if(currentBufferObj=this.buffers[dataSourceId],(currentBufferObj.status==BUFFER_STATUS.START||currentBufferObj.status==BUFFER_STATUS.NOT_START_YET)&&currentBufferObj.syncMasterTime)if(0===currentBufferObj.buffer.length){var waitTime=currentBufferObj.timeOut-(Date.now()-currentBufferObj.lastRecordTime);if(waitTime>0)return void window.setTimeout(function(){this.processSyncData()}.bind(this),waitTime/10)}else currentBufferObj.buffer[0].timeStamp<minTimeStamp&&(minTimeStampBufferObj=currentBufferObj,minTimeStampDSId=dataSourceId,minTimeStamp=currentBufferObj.buffer[0].timeStamp);null!==minTimeStampBufferObj?(this.currentTime=minTimeStamp,this.processData(minTimeStampBufferObj,minTimeStampDSId,function(){this.processSyncData()}.bind(this))):window.setTimeout(function(){this.processSyncData()}.bind(this),1e3)}},processData:function(bufferObj,dataSourceId,fnEndTimeout){var startRelativeTime=bufferObj.startRelativeTime,elapsedTime=(new Date).getTime()-bufferObj.startRelativeRealTime,data=bufferObj.buffer.shift(),waitTime=(data.timeStamp-startRelativeTime)/this.replayFactor-elapsedTime;bufferObj.startRelativeTime=data.timeStamp,bufferObj.startRelativeRealTime=(new Date).getTime(),waitTime>0?window.setTimeout(function(){this.dispatchData(dataSourceId,data),void 0!==fnEndTimeout&&fnEndTimeout()}.bind(this),waitTime):(this.dispatchData(dataSourceId,data),void 0!==fnEndTimeout&&fnEndTimeout())},dispatchData:function(dataSourceId,data){var bufObj=this.buffers[dataSourceId];bufObj.status!=BUFFER_STATUS.CANCEL&&(bufObj.syncMasterTime&&OSH.EventManager.fire(OSH.EventManager.EVENT.CURRENT_MASTER_TIME,{timeStamp:data.timeStamp,dataSourceId:dataSourceId}),OSH.EventManager.fire(OSH.EventManager.EVENT.DATA+"-"+dataSourceId,{data:data}))},buffering:function(name,bufferingTime){OSH.EventManager.fire(OSH.EventManager.EVENT.LOADING_START,{name:name}),this.bufferingState=!0,window.setTimeout(function(){this.bufferingState=!1,OSH.EventManager.fire(OSH.EventManager.EVENT.LOADING_STOP),this.processSyncData()}.bind(this),bufferingTime)}});
OSH.DataConnector.DataConnector=BaseClass.extend({initialize:function(url){this.url=url,this.id="DataConnector-"+OSH.Utils.randomUUID()},getId:function(){return this.id},getUrl:function(){return this.url},onClose:function(){}});
OSH.DataConnector.AjaxConnector=OSH.DataConnector.DataConnector.extend({initialize:function(url,properties){this._super(url),this.method="POST",this.responseType="arraybuffer",void 0!==properties&&(properties.method&&(this.method=properties.method),properties.responseType&&(this.responseType=properties.responseType))},sendRequest:function(request,extraUrl){var self=this,xmlhttp=new XMLHttpRequest;xmlhttp.timeout=6e4,null===request?(void 0!==extraUrl?xmlhttp.open("GET",this.getUrl()+"?"+extraUrl,!0):xmlhttp.open("GET",this.getUrl(),!0),xmlhttp.responseType=this.responseType,xmlhttp.onload=function(oEvent){xmlhttp.response&&self.onMessage(xmlhttp.response)},xmlhttp.ontimeout=function(e){console.log("Timeout")},xmlhttp.send(null)):(xmlhttp.open("POST",this.getUrl(),!0),xmlhttp.setRequestHeader("Content-Type","text/xml"),xmlhttp.send(request),xmlhttp.onreadystatechange=function(){xmlhttp.readyState<4||4==xmlhttp.readyState&&(200==xmlhttp.status&&xmlhttp.status<300?this.onSuccess(xmlhttp.responseText):this.onError(""))}.bind(this))},onError:function(event){},onSuccess:function(event){},connect:function(){this.sendRequest(null)}});
OSH.DataConnector.WebSocketDataConnector=OSH.DataConnector.DataConnector.extend({connect:function(){if(this.ENABLED=!1,!this.init){if(OSH.Utils.isWebWorker()&&this.ENABLED){var url=this.getUrl(),blobURL=URL.createObjectURL(new Blob(["(",function(){function init(url){ws=new WebSocket(url),ws.binaryType="arraybuffer",ws.onmessage=function(event){event.data.byteLength>0&&self.postMessage(event.data,[event.data])},ws.onerror=function(event){ws.close(),self.onerror(event)}}function close(){ws.close()}var ws=null;self.onmessage=function(e){"close"===e.data?close():init(e.data)}}.toString(),")()"],{type:"application/javascript"}));this.worker=new Worker(blobURL),this.worker.postMessage(url),this.worker.onmessage=function(e){this.onMessage(e.data)}.bind(this),this.worker.onerror=function(error){this.onError(error)}.bind(this),URL.revokeObjectURL(blobURL)}else this.ws=new WebSocket(this.getUrl()),this.ws.binaryType="arraybuffer",this.ws.onmessage=function(event){event.data.byteLength>0&&this.onMessage(event.data)}.bind(this),this.ws.onerror=function(event){this.close()},this.ws.onclose=function(e){var reason="Unknown error";switch(e.code){case 1e3:reason="Normal closure";break;case 1001:reason="An endpoint is going away";break;case 1002:reason="An endpoint is terminating the connection due to a protocol error.";break;case 1003:reason="An endpoint is terminating the connection because it has received a type of data it cannot accept";break;case 1004:reason="Reserved. The specific meaning might be defined in the future.";break;case 1005:reason="No status code was actually present";break;case 1006:reason="The connection was closed abnormally";break;case 1007:reason="The endpoint is terminating the connection because a message was received that contained inconsistent data";break;case 1008:reason="The endpoint is terminating the connection because it received a message that violates its policy";break;case 1009:reason="The endpoint is terminating the connection because a data frame was received that is too large";break;case 1010:reason="The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't.";break;case 1011:reason="The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request.";break;case 1012:reason="The server is terminating the connection because it is restarting";break;case 1013:reason="The server is terminating the connection due to a temporary condition";break;case 1015:reason="The connection was closed due to a failure to perform a TLS handshake"}if(1e3!==e.code&&1005!==e.code)throw new OSH.Exception.Exception("Datasource is now closed["+reason+"]: "+this.getUrl(),event);console.log("Datasource has been closed normally"),this.init=!1,this.onClose()}.bind(this);this.init=!0}},disconnect:function(){OSH.Utils.isWebWorker()&&!isUndefinedOrNull(this.ws)&&this.ENABLED?(this.worker.postMessage("close"),this.worker.terminate(),this.init=!1):isUndefinedOrNull(this.ws)||(this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.init=!1)},onMessage:function(data){},onError:function(error){throw new OSH.Exception.Exception("Cannot connect to the datasource "+this.getUrl(),error)},close:function(){this.disconnect()}});
OSH.DataReceiver.DataSource=BaseClass.extend({initialize:function(name,properties){this.id="DataSource-"+OSH.Utils.randomUUID(),this.name=name,this.properties=properties,this.initDataSource(properties)},initDataSource:function(properties){this.timeShift=0,this.connected=!1,isUndefinedOrNull(properties.timeShift)||(this.timeShift=properties.timeShift),isUndefinedOrNull(properties.syncMasterTime)?this.syncMasterTime=!1:this.syncMasterTime=properties.syncMasterTime,isUndefinedOrNull(properties.bufferingTime)||(this.bufferingTime=properties.bufferingTime),isUndefinedOrNull(properties.timeOut)||(this.timeOut=properties.timeOut),isUndefinedOrNull(properties.replaySpeed)||(this.replaySpeed=properties.replaySpeed),"ws"==properties.protocol?(this.connector=new OSH.DataConnector.WebSocketDataConnector(this.buildUrl(properties)),this.connector.onClose=function(){this.connected=!1}.bind(this),this.connector.onMessage=this.onMessage.bind(this)):"http"==properties.protocol&&(this.connector=new OSH.DataConnector.AjaxConnector(this.buildUrl(properties)),this.connector.responseType="arraybuffer",this.connector.onMessage=this.onMessage.bind(this))},disconnect:function(){this.connector.disconnect(),this.connected=!1,OSH.EventManager.fire(OSH.EventManager.EVENT.DATA+"-"+this.id,{dataSourceId:this.id,reset:!0})},connect:function(){this.connected||(this.connector.connect(),this.connected=!0)},onMessage:function(data){this.onData({timeStamp:this.parseTimeStamp(data)+this.timeShift,data:this.parseData(data)})},parseTimeStamp:function(data){return(new Date).getTime()},parseData:function(data){return data},onData:function(data){},getId:function(){return this.id},getName:function(){return this.name},buildUrl:function(properties){var url="";return url+=properties.protocol+"://",url+=properties.endpointUrl+"?",url+="service="+properties.service+"&",url+="version=2.0&",url+="request=GetResult&",url+="offering="+properties.offeringID+"&",url+="observedProperty="+properties.observedProperty+"&",url+="temporalFilter=phenomenonTime,"+properties.startTime+"/"+properties.endTime+"&",properties.replaySpeed&&void 0!==properties.replaySpeed&&(url+="replaySpeed="+properties.replaySpeed),properties.responseFormat&&void 0!==properties.responseFormat&&""!==properties.responseFormat&&(url+="&responseFormat="+properties.responseFormat),url},reset:function(){this.initDataSource(this.properties)},clone:function(){}});
OSH.DataReceiver.EulerOrientation=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return new Date(tokens[0]).getTime()},parseData:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(","),yaw=parseFloat(tokens[1]);return{pitch:parseFloat(tokens[2]),roll:parseFloat(tokens[3]),heading:yaw}}});
OSH.DataReceiver.LatLonAlt=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return new Date(tokens[0]).getTime()},parseData:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return{lat:parseFloat(tokens[1]),lon:parseFloat(tokens[2]),alt:parseFloat(tokens[3])}}});
OSH.DataReceiver.Nexrad=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return new Date(tokens[0]).getTime()},parseData:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(","),el=parseFloat(tokens[2]),az=parseFloat(tokens[3]),rangeToCenterOfFirstRefGate=parseFloat(tokens[4]),refGateSize=parseFloat(tokens[5]),numRefGates=parseInt(tokens[6]),rangeToCenterOfFirstVelGate=parseFloat(tokens[7]),velGateSize=parseFloat(tokens[8]),numVelGates=parseInt(tokens[9]),rangeToCenterOfFirstSwGate=parseFloat(tokens[10]),swGateSize=parseFloat(tokens[11]),numSwGates=parseInt(tokens[12]),i=13,refData=[];for(count=0;count<numRefGates;count++)refData.push(parseFloat(tokens[i++]));var velData=[];for(count=0;count<numVelGates;count++)velData.push(parseFloat(tokens[i++]));var swData=[];for(count=0;count<numSwGates;count++)swData.push(parseFloat(tokens[i++]));return{elevation:el,azimuth:az,rangeToCenterOfFirstRefGate:rangeToCenterOfFirstRefGate,refGateSize:refGateSize,rangeToCenterOfFirstVelGate:rangeToCenterOfFirstVelGate,velGateSize:velGateSize,rangeToCenterOfFirstSwGate:rangeToCenterOfFirstSwGate,swGateSize:swGateSize,reflectivity:refData,velocity:velData,spectrumWidth:swData}}});
OSH.DataReceiver.DataSourceUAHWeather=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return new Date(tokens[0]).getTime()},parseData:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return{airPres:parseFloat(tokens[1]),airTemp:parseFloat(tokens[2]),humidity:parseFloat(tokens[3]),windSpeed:parseFloat(tokens[4]),windDir:parseFloat(tokens[5]),rainCnt:parseFloat(tokens[6])}}});
OSH.DataReceiver.OrientationQuaternion=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return new Date(tokens[0]).getTime()},parseData:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(","),qx=parseFloat(tokens[1]),qy=parseFloat(tokens[2]),qz=parseFloat(tokens[3]),qw=parseFloat(tokens[4]),ix=0*qw+qy*-1-0*qz,iy=0*qw+0*qz-qx*-1,iz=qw*-1+0*qx-0*qy,iw=0*-qx-0*qy-qz*-1;return xp=ix*qw+iw*-qx+iy*-qz-iz*-qy,yp=iy*qw+iw*-qy+iz*-qx-ix*-qz,zp=iz*qw+iw*-qz+ix*-qy-iy*-qx,{heading:90-180/Math.PI*Math.atan2(yp,xp),roll:null,pitch:null}}});
OSH.DataReceiver.VideoH264=OSH.DataReceiver.DataSource.extend({initialize:function(name,properties,options){this._super(name,properties,options)},parseTimeStamp:function(data){return 1e3*new DataView(data).getFloat64(0,!1)},parseData:function(data){return new Uint8Array(data,12,data.byteLength-12)},clone:function(){var cloneProperties={};return OSH.Utils.copyProperties(this.properties,cloneProperties),new OSH.DataReceiver.VideoH264(this.name,cloneProperties)}});
OSH.DataReceiver.VideoMjpeg=OSH.DataReceiver.DataSource.extend({initialize:function(name,properties,options){this._super(name,properties,options)},parseTimeStamp:function(data){return 1e3*new DataView(data).getFloat64(0,!1)},parseData:function(data){var imgBlob=new Blob([data]);return window.URL.createObjectURL(imgBlob.slice(12))}});
function readMP4Info(data){var infos={absoluteTime:0,pts:0,timeScale:0,duration:0,rate:0},pos=60;return infos.absoluteTime=new DataView(data,pos,pos+8).getUint32(0),infos.absoluteTime=1e3*(infos.absoluteTime-2082844800),pos+=8,infos.pts=new DataView(data,pos,pos+4).getUint32(0),pos+=4,infos.timeScale=new DataView(data,pos,pos+4).getUint32(0),infos.timeScale=1/infos.timeScale,pos+=4,infos.duration=new DataView(data,pos,pos+4).getUint32(0),pos+=4,infos.rate=new DataView(data,pos,pos+4).getUint32(0),infos}function readNCC(bytes,n){for(var res="",i=0;i<n;i++)res+=String.fromCharCode(bytes[i]);return res}OSH.DataReceiver.VideoMp4=OSH.DataReceiver.DataSource.extend({initialize:function(name,properties,options){this._super(name,properties,options),this.absoluteTime=-1},parseTimeStamp:function(data){if(this.absoluteTime==-1){var infos=readMP4Info(data);return this.absoluteTime=infos.absoluteTime,this.timeScale=infos.timeScale,this.absoluteTime}var infos=readMP4Info(data);return 1e3*infos.pts*this.timeScale+this.absoluteTime}});
OSH.DataReceiver.JSON=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data));return new Date(JSON.parse(rec).time).getTime()},parseData:function(data){var rec=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(data))),result={};for(var key in rec)"time"!==key&&(result[key]=rec[key]);return result},buildUrl:function(properties){var url="";url+=properties.protocol+"://",url+=properties.endpointUrl+"?",url+="service="+properties.service+"&",url+="version=2.0&",url+="request=GetResult&",url+="offering="+properties.offeringID+"&",url+="observedProperty="+properties.observedProperty+"&";var startTime=properties.startTime,endTime=properties.endTime;return"now"!==startTime&&0!=this.timeShift&&"urn:android:device:060693280a28e015-sos"!==properties.offeringID&&(startTime=new Date(Date.parse(startTime)-this.timeShift).toISOString(),endTime=new Date(Date.parse(endTime)-this.timeShift).toISOString()),url+="temporalFilter=phenomenonTime,"+startTime+"/"+endTime+"&",properties.replaySpeed&&(url+="replaySpeed="+properties.replaySpeed),url+="&responseFormat=application/json"}});
OSH.DataReceiver.Chart=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return new Date(tokens[0]).getTime()},parseData:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return tokens.shift(),tokens}});
OSH.DataReceiver.DataSourceFactory=function(){},OSH.DataReceiver.DataSourceFactory.DEFINITION_TYPE={JSON:"json",VIDEO:"video"},OSH.DataReceiver.DataSourceFactory.definitionMap={"http://sensorml.com/ont/swe/property/VideoFrame":OSH.DataReceiver.DataSourceFactory.DEFINITION_TYPE.VIDEO,"http://sensorml.com/ont/swe/property/Image":OSH.DataReceiver.DataSourceFactory.DEFINITION_TYPE.VIDEO},OSH.DataReceiver.DataSourceFactory.createDatasourceFromType=function(properties,callback){OSH.Asserts.checkIsDefineOrNotNull(properties),OSH.Asserts.checkIsDefineOrNotNull(properties.definition);var type="";properties.definition in OSH.DataReceiver.DataSourceFactory.definitionMap&&(type=OSH.DataReceiver.DataSourceFactory.definitionMap[properties.definition]),type===OSH.DataReceiver.DataSourceFactory.DEFINITION_TYPE.VIDEO?OSH.DataReceiver.DataSourceFactory.createVideoDatasource(properties,callback):OSH.DataReceiver.DataSourceFactory.createJsonDatasource(properties,callback)},OSH.DataReceiver.DataSourceFactory.createVideoDatasource=function(properties,callback){OSH.Asserts.checkIsDefineOrNotNull(properties),OSH.Asserts.checkIsDefineOrNotNull(callback);var self=this;new OSH.Server({url:"http://"+properties.endpointUrl}).getResultTemplate(properties.offeringID,properties.observedProperty,function(jsonResp){for(var resultEncodingArr=jsonResp.GetResultTemplateResponse.resultEncoding.member,compression=null,i=0;i<resultEncodingArr.length;i++){var elt=resultEncodingArr[i];if("compression"in elt){compression=elt.compression;break}}properties.compression=compression;var datasource;"JPEG"===compression?datasource=new OSH.DataReceiver.VideoMjpeg(properties.name,properties):"H264"===compression&&(datasource=new OSH.DataReceiver.VideoH264(properties.name,properties)),datasource.resultTemplate=self.buildDSStructure(datasource,jsonResp),callback(datasource)},function(error){throw new OSH.Exception.Exception("Cannot Get result template for "+properties.endpointUrl,error)})},OSH.DataReceiver.DataSourceFactory.createJsonDatasource=function(properties,callback){OSH.Asserts.checkIsDefineOrNotNull(properties),OSH.Asserts.checkIsDefineOrNotNull(callback);var datasource=new OSH.DataReceiver.JSON(properties.name,properties);this.buildDSResultTemplate(datasource,function(dsResult){callback(dsResult)})},OSH.DataReceiver.DataSourceFactory.buildDSResultTemplate=function(dataSource,callback){var self=this;new OSH.Server({url:"http://"+dataSource.properties.endpointUrl}).getResultTemplate(dataSource.properties.offeringID,dataSource.properties.observedProperty,function(jsonResp){dataSource.resultTemplate=self.buildDSStructure(dataSource,jsonResp),callback(dataSource)},function(error){})},OSH.DataReceiver.DataSourceFactory.buildDSStructure=function(datasource,resultTemplate){var result=[],currentObj=null,group=null;OSH.Utils.traverse(resultTemplate.GetResultTemplateResponse.resultStructure.field,function(key,value,params){if(null!==params.defLevel&&params.level<params.defLevel&&(result.push(currentObj),currentObj=null,params.defLevel=null),null!==group&&params.level<group.level&&(group=null),!isUndefinedOrNull(value.definition)||!isUndefinedOrNull(value.axisID)){null!==currentObj&&(!0,group={path:currentObj.path,level:params.level,object:currentObj.object}),currentObj=isUndefinedOrNull(value.definition)?{path:null,object:value}:{definition:value.definition,path:null,object:value},params.defLevel=params.level+1}null!==params.defLevel&&params.level>=params.defLevel&&"name"===key&&(null===currentObj.path?null!==group?(currentObj.path=group.path+"."+value,currentObj.parentObject=group.object):currentObj.path=value:currentObj.path=currentObj.path+"."+value)},{level:0,defLevel:null}),null!==currentObj&&result.push(currentObj);for(var key in result){var uiLabel="no label/axisID/name defined";isUndefinedOrNull(result[key].object.label)?isUndefinedOrNull(result[key].object.axisID)?isUndefinedOrNull(result[key].object.name)||(uiLabel=result[key].object.name):uiLabel=result[key].object.axisID:uiLabel=result[key].object.label,result[key].uiLabel=uiLabel}return result};
OSH.DataReceiver.DataReceiverController=BaseClass.extend({initialize:function(options){this.options=options,this.initBuffer(),this.dataSourcesIdToDataSources={},OSH.EventManager.observe(OSH.EventManager.EVENT.CONNECT_DATASOURCE,function(event){for(var eventDataSourcesIds=event.dataSourcesId,i=0;i<eventDataSourcesIds.length;i++){var id=eventDataSourcesIds[i];id in this.dataSourcesIdToDataSources&&(this.dataSourcesIdToDataSources[id].syncMasterTime&&this.updateDataSourceTime(id,new Date(this.buffer.currentTime).toISOString()),this.dataSourcesIdToDataSources[id].connect(),this.buffer.startDataSource(id))}}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.DISCONNECT_DATASOURCE,function(event){for(var eventDataSourcesIds=event.dataSourcesId,i=0;i<eventDataSourcesIds.length;i++){var id=eventDataSourcesIds[i];id in this.dataSourcesIdToDataSources&&(this.dataSourcesIdToDataSources[id].disconnect(),this.buffer.cancelDataSource(id))}}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.DATASOURCE_UPDATE_TIME,function(event){var dataSourcesToReconnect=[];for(var id in this.dataSourcesIdToDataSources){var dataSrc=this.dataSourcesIdToDataSources[id];dataSrc.syncMasterTime&&dataSrc.connected&&(dataSrc.disconnect(),this.buffer.cancelDataSource(id),dataSourcesToReconnect.push(id))}this.buffer.currentTime=Date.parse(event.startTime);for(var i=0;i<dataSourcesToReconnect.length;i++){var id=dataSourcesToReconnect[i],dataSrc=this.dataSourcesIdToDataSources[id];this.updateDataSourceTime(id,event.startTime,event.endTime),dataSrc.connect(),this.buffer.startDataSource(id)}}.bind(this))},updateDataSourceTime:function(id,startTime,endTime){var dataSource=this.dataSourcesIdToDataSources[id],props=dataSource.properties,options=dataSource.options;void 0!==startTime&&(props.startTime=startTime),void 0!==endTime&&(props.endTime=endTime),dataSource.initDataSource(props,options)},initBuffer:function(){this.buffer=new OSH.Buffer(this.options)},addEntity:function(entity,options){if(void 0!==entity.dataSources)for(var i=0;i<entity.dataSources.length;i++)this.addDataSource(entity.dataSources[i],options)},addDataSource:function(dataSource,options){dataSource.id in this.dataSourcesIdToDataSources||(this.dataSourcesIdToDataSources[dataSource.id]=dataSource,this.buffer.addDataSource(dataSource.id,{name:dataSource.name,syncMasterTime:dataSource.syncMasterTime,bufferingTime:dataSource.bufferingTime,timeOut:dataSource.timeOut}),dataSource.onData=function(data){this.buffer.push({dataSourceId:dataSource.getId(),data:data})}.bind(this))},connectAll:function(){this.buffer.start();for(var id in this.dataSourcesIdToDataSources)this.dataSourcesIdToDataSources[id].connect()},getDataSource:function(id){return this.dataSourcesIdToDataSources[id]},removeDataSource:function(datasource){this.buffer.removeDataSource(datasource.id),datasource.id in this.dataSourcesIdToDataSources&&delete this.dataSourcesIdToDataSources[datasource.id]},updateDataSource:function(datasource){OSH.EventManager.fire(OSH.EventManager.EVENT.DISCONNECT_DATASOURCE,{dataSourcesId:[datasource.id]}),this.removeDataSource(datasource),this.addDataSource(datasource)}});
OSH.DataSender.DataSink=BaseClass.extend({initialize:function(name,properties,options){"http"==properties.protocol&&(this.connector=new OSH.DataConnector.AjaxConnector(this.buildUrl(properties)),this.connector.onError=this.onCatchError.bind(this),this.connector.onSuccess=this.onCatchSuccess.bind(this)),this.id="DataSender-"+OSH.Utils.randomUUID(),this.name=name,this.properties=properties},sendRequest:function(properties){this.connector.sendRequest(this.buildRequest(properties))},buildRequest:function(properties){return""},buildUrl:function(properties){var url="";return url+=properties.protocol+"://",url+=properties.endpointUrl},onCatchError:function(response){this.onError(response)},onCatchSuccess:function(response){this.onSuccess(response)},onError:function(response){},onSuccess:function(response){},getId:function(){return this.id},getName:function(){return this.name}});
OSH.DataSender.PtzTasking=OSH.DataSender.DataSink.extend({initialize:function(name,properties){this._super(name,properties),OSH.EventManager.observe(OSH.EventManager.EVENT.PTZ_SEND_REQUEST+"-"+this.id,function(event){this.connector.sendRequest(this.buildRequest(this.getCommandData(event.cmdData)))}.bind(this))},getCommandData:function(values){var cmdData="";return null!=values.rtilt&&(cmdData+="rtilt,"+values.rtilt+" "),null!=values.rpan&&(cmdData+="rpan,"+values.rpan+" "),null!=values.rzoom&&(cmdData+="rzoom,"+values.rzoom+" "),cmdData},buildRequest:function(cmdData){var xmlSpsRequest="<sps:Submit ";return xmlSpsRequest+='service="'+this.properties.service+'" ',xmlSpsRequest+='version="'+this.properties.version+'" ',xmlSpsRequest+='xmlns:sps="http://www.opengis.net/sps/2.0" xmlns:swe="http://www.opengis.net/swe/2.0"> ',xmlSpsRequest+="<sps:procedure>"+this.properties.offeringID+"</sps:procedure>",xmlSpsRequest+="<sps:taskingParameters><sps:ParameterData>",xmlSpsRequest+='<sps:encoding><swe:TextEncoding blockSeparator=" "  collapseWhiteSpaces="true" decimalSeparator="." tokenSeparator=","/></sps:encoding>',xmlSpsRequest+="<sps:values>"+cmdData+"</sps:values>",xmlSpsRequest+="</sps:ParameterData></sps:taskingParameters></sps:Submit>"}});
OSH.DataSender.FoscamPtzTasking=OSH.DataSender.PtzTasking.extend({getCommandData:function(values){var cmdData="";return null!==values.preset?cmdData="preset,"+values.preset:null!==values.rzoom?(cmdData="zoom,",cmdData+=values.rzoom<0?"out":"in"):null!=values.rpan&&null!=values.rtilt?(cmdData+="relMove,",null!==values.rtilt&&(cmdData+=values.rtilt<0?"Bottom":"Top"),cmdData+=values.rpan<0?"Left":"Right"):(null!==values.rpan&&(cmdData+="relMove,",cmdData+=values.rpan<0?"Left":"Right",cmdData+=" "),null!==values.rtilt&&(cmdData+="relMove,",cmdData+=values.rtilt<0?"Down":"Up")),cmdData}});
OSH.DataSender.UavMapTasking=OSH.DataSender.DataSink.extend({initialize:function(name,properties){this._super(name,properties),OSH.EventManager.observe(OSH.EventManager.EVENT.UAV_TAKEOFF,function(event){this.connector.sendRequest(this.buildTakeOffRequest())}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.UAV_GOTO,function(event){this.connector.sendRequest(this.buildGotoRequest({lat:event.geoLat,lon:event.geoLon}))}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.UAV_ORBIT,function(event){this.connector.sendRequest(this.buildOrbitRequest({lat:event.geoLat,lon:event.geoLon,radius:10}))}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.UAV_LOOKAT,function(event){this.connector.sendRequest(this.buildLookAtRequest({lat:event.geoLat,lon:event.geoLon}))}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.UAV_LAND,function(event){this.connector.sendRequest(this.buildLandRequest({lat:event.geoLat,lon:event.geoLon}))}.bind(this))},buildTakeOffRequest:function(props){return this.buildRequest("navCommands,TAKEOFF,10")},buildGotoRequest:function(props){return this.buildRequest("navCommands,GOTO_LLA,"+props.lat+","+props.lon+",0,0")},buildOrbitRequest:function(props){return this.buildRequest("navCommands,ORBIT,"+props.lat+","+props.lon+",0,"+props.radius)},buildLookAtRequest:function(props){return this.buildRequest("camCommands,MOUNT_TARGET,"+props.lat+","+props.lon+",0")},buildLandRequest:function(props){return this.buildRequest("navCommands,LAND,"+props.lat+","+props.lon)},buildRequest:function(cmdData){var xmlSpsRequest="<sps:Submit ";return xmlSpsRequest+='service="'+this.properties.service+'" ',xmlSpsRequest+='version="'+this.properties.version+'" ',xmlSpsRequest+='xmlns:sps="http://www.opengis.net/sps/2.0" xmlns:swe="http://www.opengis.net/swe/2.0"> ',xmlSpsRequest+="<sps:procedure>"+this.properties.offeringID+"</sps:procedure>",xmlSpsRequest+="<sps:taskingParameters><sps:ParameterData>",xmlSpsRequest+='<sps:encoding><swe:TextEncoding blockSeparator=" "  collapseWhiteSpaces="true" decimalSeparator="." tokenSeparator=","/></sps:encoding>',xmlSpsRequest+="<sps:values>"+cmdData+"</sps:values>",xmlSpsRequest+="</sps:ParameterData></sps:taskingParameters></sps:Submit>",document.fire("osh:log",xmlSpsRequest),xmlSpsRequest}});
OSH.DataSender.DataSenderController=BaseClass.extend({initialize:function(options){this.dataSources={}},addDataSource:function(dataSource){this.dataSources[dataSource.getId()]=dataSource},sendRequest:function(dataSourceId,properties,onSuccess,onError){dataSourceId in this.dataSources&&(void 0!==onSuccess&&null!=onSuccess&&(this.dataSources[dataSourceId].onSuccess=function(response){onSuccess(response)}),void 0!==onError&&null!=onError&&(this.dataSources[dataSourceId].onError=function(response){onError(response)}),this.dataSources[dataSourceId].sendRequest(properties))}});
OSH.Server=BaseClass.extend({initialize:function(properties){this.url=properties.url,this.id="Server-"+OSH.Utils.randomUUID()},getCapabilities:function(successCallback,errorCallback){var request=this.url+"?service=SOS&version=2.0&request=GetCapabilities";this.executeGetRequest(request,successCallback,errorCallback)},getFeatureOfInterest:function(successCallback,errorCallback){var request=this.url+"?service=SOS&version=2.0&request=GetFeatureOfInterest";this.executeGetRequest(request,successCallback,errorCallback)},getResultTemplate:function(offering,observedProperty,successCallback,errorCallback){var request=this.url+"?service=SOS&version=2.0&request=GetResultTemplate&offering="+offering+"&observedProperty="+observedProperty;this.executeGetRequest(request,successCallback,errorCallback)},getDescribeSensor:function(procedure,successCallback,errorCallback){var request=this.url+"?service=SOS&version=2.0&request=DescribeSensor&procedure="+procedure;this.executeGetRequest(request,successCallback,errorCallback)},executeGetRequest:function(request,successCallback,errorCallback){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState===XMLHttpRequest.DONE&&200===xhr.status){successCallback.bind(this)(new OSH.SWEXmlParser(xhr.responseText).toJson())}else xhr.readyState===XMLHttpRequest.DONE&&200!==xhr.status&&errorCallback(xhr.responseText)}.bind(this),xhr.open("GET",request,!0),xhr.send()}});
OSH.SWEXmlParser=BaseClass.extend({initialize:function(xml){this.originalXml=xml;var x2jsOptions={xmlns:!1,attributePrefix:"",prefix:!1,removeAttrPrefix:!0,arrayAccessFormPaths:[/.*.coordinate$/,/.*.field$/,/.*.item$/,/.*.quality$/,/.*.member$/,/.*.constraint\.value$/,/.*.constraint\.interval$/,/.*.offering$/,/.*.observableProperty/],numericalAccessFormPaths:["value","nilValue","paddingBytes-after","paddingBytes-before","byteLength","significantBits","bitLength",/.*.Time\.value/,/.*.Quantity\.value/,/.*.Count\.value/],skip:["type"]};this.x2jsParser=new X2JS(x2jsOptions)},toXml:function(){return this.originalXml},toJson:function(){return this.x2jsParser.xml_str2json(this.originalXml)}});
OSH.UI.Panel=BaseClass.extend({initialize:function(parentElementDivId,options){this.divId="panel-"+OSH.Utils.randomUUID(),this.id=this.divId,this.options=options,this.elementDiv=document.createElement("div"),this.elementDiv.setAttribute("class","osh panel"),this.elementDiv.setAttribute("id",this.divId),isUndefinedOrNull(parentElementDivId)||""===parentElementDivId?document.body.appendChild(this.elementDiv):document.getElementById(parentElementDivId).appendChild(this.elementDiv),this.componentListeners=[],isUndefinedOrNull(options)||isUndefinedOrNull(options.css)||OSH.Utils.addCss(this.elementDiv,options.css),this.initPanel(),this.handleEvents()},initPanel:function(){},addListener:function(div,listenerName,func){OSH.Asserts.checkIsDefineOrNotNull(div),OSH.Asserts.checkIsDefineOrNotNull(func),OSH.Helper.HtmlHelper.onDomReady(function(){div.addEventListener(listenerName,func,!1),this.componentListeners.push({div:div,name:listenerName,func:func})}.bind(this))},removeAllListerners:function(){for(var key in this.componentListeners){var elt=this.componentListeners[key];elt.div.removeEventListener(elt.name,elt.func)}},getAsHTML:function(){return this.elementDiv.outerHTML},attachTo:function(divId){this.attachToElement(document.getElementById(divId))},attachToElement:function(element){void 0!==this.elementDiv.parentNode&&this.elementDiv.parentNode.removeChild(this.elementDiv),element.appendChild(this.elementDiv),"none"===this.elementDiv.style.display&&(this.elementDiv.style.display="block"),this.onResize()},onResize:function(){},inputFileHandlerAsBinaryString:function(callbackFn,evt){var file=evt.target.files[0],reader=new FileReader,inputElt=this;reader.onload=function(theFile){return inputElt.nextSibling.text=theFile.name,inputElt.nextSibling.value=theFile.name,function(e){var l,d,array;d=e.target.result,l=d.length,array=new Uint8Array(l);for(var i=0;i<l;i++)array[i]=d.charCodeAt(i);var blob=new Blob([array],{type:"application/octet-stream"});callbackFn({url:URL.createObjectURL(blob),binaryString:d,name:theFile.name,length:l})}}(file),reader.readAsBinaryString(file)},inputFileHandlerAsText:function(callbackFn,evt){var file=evt.target.files[0],reader=new FileReader,inputElt=this;reader.onload=function(theFile){return inputElt.nextSibling.text=theFile.name,inputElt.nextSibling.value=theFile.name,function(e){callbackFn({data:e.target.result,file:theFile})}}(file),reader.readAsText(file)},inputFilePasteHandler:function(callbackFn,evt){OSH.Asserts.checkIsDefineOrNotNull(evt);var clipboardData=evt.clipboardData||window.clipboardData,pastedData=clipboardData.getData("Text"),name="",split=pastedData.split("/");split.length>0&&(name=split[split.length-1]),callbackFn({url:pastedData,name:name})},setInputFileValue:function(inputElt,props){if(!isUndefinedOrNull(props)){var url=props.url;inputElt.parentNode.querySelectorAll("div.preview")[0].innerHTML=['<img class="thumb" src="',url,'" title="',escape(props.name),'"/>'].join(""),inputElt.nextSibling.text=props.name,inputElt.nextSibling.value=props.name}},removeAllFromSelect:function(tagId){var i,selectTag=document.getElementById(tagId);for(i=selectTag.options.length-1;i>0;i--)selectTag.remove(i)},removeAllFromSelectElement:function(element){var i;for(i=element.options.length-1;i>0;i--)element.remove(i)},show:function(properties){this.setVisible(properties.show)},shows:function(properties){},handleEvents:function(){var self=this;OSH.EventManager.observe(OSH.EventManager.EVENT.SHOW_VIEW+"-"+this.divId,function(event){self.setVisible(!0)}),OSH.EventManager.observe(OSH.EventManager.EVENT.RESIZE+"-"+this.divId,function(event){self.onResize()}),OSH.EventManager.observe(OSH.EventManager.EVENT.SEND_OBJECT+"-"+this.divId,function(event){OSH.EventManager.fire(OSH.EventManager.EVENT.GET_OBJECT+"-"+self.divId,{object:self})})},setVisible:function(isVisible){isVisible?isUndefinedOrNull(this.elementDiv.style.displayOld)?this.elementDiv.style.display="block":this.elementDiv.style.display=this.elementDiv.style.displayOld:(this.elementDiv.style.displayOld=window.getComputedStyle(this.elementDiv).getPropertyValue("display"),this.elementDiv.style.display="none")}});
OSH.UI.Panel.TabPanel=OSH.UI.Panel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){this.mainElt=document.createElement("main"),this.mainElt.setAttribute("class","tab-panel"),this.elementDiv.appendChild(this.mainElt),this.sectionNb=0,this.sectionElts=[],this.labelElt=[]},addTab:function(label,div){var id=OSH.Utils.randomUUID(),inputElt=document.createElement("input");inputElt.setAttribute("id","tab"+this.sectionNb),inputElt.setAttribute("type","radio"),inputElt.setAttribute("name","tabs");var labelElt=document.createElement("label");labelElt.setAttribute("for",id),labelElt.setAttribute("id","label-"+id),labelElt.innerHTML=label;var sectionElt=document.createElement("section");sectionElt.setAttribute("id","content"+this.sectionNb),sectionElt.setAttribute("class","hide-tab"),sectionElt.appendChild(div),this.sectionElts.push(sectionElt),this.labelElt.push({label:labelElt,input:inputElt}),OSH.Helper.HtmlHelper.removeAllNodes(this.mainElt);for(var key in this.labelElt)this.mainElt.appendChild(this.labelElt[key].input),this.mainElt.appendChild(this.labelElt[key].label);for(var key in this.sectionElts)this.mainElt.appendChild(this.sectionElts[key]);OSH.EventManager.observeDiv(labelElt.id,"click",this.setChecked.bind(this,inputElt,sectionElt));var self=this;OSH.Helper.HtmlHelper.onDomReady(function(){OSH.Helper.HtmlHelper.fireEvent(self.labelElt[0].label,"click")})},setChecked:function(inputElt,sectionElt,evt){isUndefinedOrNull(this.currentSelectedInput)||this.currentSelectedInput.removeAttribute("checked"),isUndefinedOrNull(this.currentSelectedSection)||OSH.Utils.replaceCss(this.currentSelectedSection,"show-tab","hide-tab"),inputElt.setAttribute("checked",""),OSH.Utils.replaceCss(sectionElt,"hide-tab","show-tab"),this.currentSelectedInput=inputElt,this.currentSelectedSection=sectionElt},disableTab:function(index){},addToTab:function(index,div){this.sectionElts[index].appendChild(div)}});
OSH.UI.Panel.DialogPanel=OSH.UI.Panel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){OSH.Utils.addCss(this.elementDiv,"dialog"),this.headerElt=this.createHeader(),this.contentElt=this.createContent(),this.footerElt=this.createFooter(),this.parentElementDiv=this.elementDiv.parentNode,this.innerElementDiv=document.createElement("div"),this.innerElementDiv.setAttribute("class","dialog-inner "+this.options.css),this.elementDiv.appendChild(this.innerElementDiv),this.innerElementDiv.appendChild(this.headerElt),this.innerElementDiv.appendChild(this.contentElt),this.innerElementDiv.appendChild(this.footerElt),this.initDragAndDrop(this.innerElementDiv,this.parentElementDiv),this.updateProperties(this.options)},checkOptions:function(properties){if(!isUndefinedOrNull(properties)){if(isUndefined(properties.title)?isUndefinedOrNull(this.title)&&(this.title="Untitled"):this.title=properties.title,isUndefined(properties.show)?isUndefinedOrNull(this.show)&&(this.show=!0):this.show=properties.show,isUndefined(properties.draggable)?isUndefinedOrNull(this.draggable)&&(this.draggable=!0):this.draggable=properties.draggable,isUndefined(properties.resizable)?isUndefinedOrNull(this.resizable)&&(this.resizable=!0):this.resizable=properties.resizable,isUndefined(properties.closeable)?isUndefinedOrNull(this.closeable)&&(this.closeable=!0):this.closeable=properties.closeable,isUndefined(properties.connectionIds)?isUndefinedOrNull(this.connectionIds)&&(this.connected=!1,this.connectionIds=[]):(this.connectionIds=properties.connectionIds,this.connected=!0),isUndefined(properties.pinContainerId)?isUndefinedOrNull(this.pin)&&(this.pin=null):this.pin={containerId:this.options.pinContainerId,originalContainerId:this.parentElementDiv.id,lastPosition:{x:0,y:0}},isUndefined(properties.swapContainerId))isUndefinedOrNull(this.swap)&&(this.swap=null);else{var dstElt=document.getElementById(properties.swapContainerId);if(!isUndefinedOrNull(dstElt)){var parentDstElt=dstElt.parentNode;isUndefinedOrNull(parentDstElt)||(this.swap={swapContainerId:properties.swapContainerId,position:window.getComputedStyle(dstElt).getPropertyValue("position")})}}isUndefined(properties.destroyOnClose)?isUndefinedOrNull(this.destroyOnClose)&&(this.destroyOnClose=!1):this.destroyOnClose=properties.destroyOnClose,isUndefined(properties.modal)?isUndefinedOrNull(this.modal)&&(this.modal=!1):this.modal=properties.modal,isUndefined(properties.keepRatio)?this.keepRatio=!1:this.keepRatio=properties.keepRatio}this.minimized=!1},createHeader:function(){var dialogHeaderElt=document.createElement("div");dialogHeaderElt.setAttribute("class","dialog-header"),this.headerSpanLeftElt=document.createElement("span"),this.headerSpanLeftElt.setAttribute("class","line-left");var tableRightElt=document.createElement("table");tableRightElt.setAttribute("class","line-right");var tbodyElt=document.createElement("tbody");return this.headerTrElt=document.createElement("tr"),this.headerTdElts={},tbodyElt.appendChild(this.headerTrElt),tableRightElt.appendChild(tbodyElt),dialogHeaderElt.appendChild(this.headerSpanLeftElt),dialogHeaderElt.appendChild(tableRightElt),dialogHeaderElt},updateProperties:function(properties){if(this.checkOptions(properties),this.headerSpanLeftElt.innerHTML=this.title,!isUndefinedOrNull(this.swap)&&isUndefinedOrNull(this.headerTrElt.swap)&&(this.headerTrElt.swap=this.addSwapIcon(this.headerTrElt)),this.modal||isUndefinedOrNull(this.pin)||!isUndefinedOrNull(this.headerTrElt.pin)||(this.headerTrElt.pin=this.addPinIcon(this.headerTrElt),this.pin.position=window.getComputedStyle(this.interact.target).getPropertyValue("position")),isUndefinedOrNull(this.headerTrElt.minimize)&&(this.headerTrElt.minimize=this.addMinimizeIcon(this.headerTrElt)),!isUndefinedOrNull(this.closeable)&&this.closeable&&isUndefinedOrNull(this.headerTrElt.closeable)&&(this.headerTrElt.closeable=this.addCloseIcon(this.headerTrElt)),this.keepRatio){this.contentElt.style.overflow="hidden";var style=window.getComputedStyle(this.innerElementDiv),height=style.getPropertyValue("height");isUndefinedOrNull(height)||(this.innerElementDiv.style.height="initial",this.innerElementDiv.style.minHeight=height)}this.setModal(this.modal),this.setVisible(this.show),this.interact.draggable(this.draggable),this.interact.resizable(this.resizable)},addSwapIcon:function(parentElt){var tdElt=document.createElement("td"),swapIconElt=document.createElement("i");return swapIconElt.setAttribute("class","fa fa-fw dialog-header-icon icon-swap"),tdElt.appendChild(swapIconElt),parentElt.appendChild(tdElt),this.addListener(swapIconElt,"click",this.swapHandler.bind(this)),swapIconElt},addPinIcon:function(parentElt){var tdElt=document.createElement("td"),pinIconElt=document.createElement("i");return pinIconElt.setAttribute("class","fa fa-fw dialog-header-icon icon-pin"),tdElt.appendChild(pinIconElt),parentElt.appendChild(tdElt),this.addListener(pinIconElt,"click",this.pinHandler.bind(this)),pinIconElt},addMinimizeIcon:function(parentElt){var tdElt=document.createElement("td"),minimizeIconElt=document.createElement("i");return minimizeIconElt.setAttribute("class","fa fa-fw dialog-header-icon icon-minimize"),tdElt.appendChild(minimizeIconElt),parentElt.appendChild(tdElt),this.addListener(minimizeIconElt,"click",this.minimizeHandler.bind(this)),minimizeIconElt},addCloseIcon:function(parentElt){var tdElt=document.createElement("td"),closeIconElt=document.createElement("i");return closeIconElt.setAttribute("class","fa fa-fw dialog-header-icon icon-close"),tdElt.appendChild(closeIconElt),parentElt.appendChild(tdElt),this.addListener(closeIconElt,"click",this.closeHandler.bind(this)),closeIconElt},setModal:function(isModal){isModal?OSH.Utils.addCss(this.elementDiv,"modal-block"):OSH.Utils.removeCss(this.elementDiv,"modal-block")},createContent:function(){var dialogContentElt=document.createElement("div");return dialogContentElt.setAttribute("class","dialog-content "),dialogContentElt.setAttribute("id","dialog-content-id-"+OSH.Utils.randomUUID()),dialogContentElt},createFooter:function(){var dialogFooterElt=document.createElement("div");return dialogFooterElt.setAttribute("class","dialog-footer"),dialogFooterElt},initDragAndDrop:function(element,parentElement){function dragMoveListener(event){var target=event.target,x=(parseFloat(target.getAttribute("data-x"))||0)+event.dx,y=(parseFloat(target.getAttribute("data-y"))||0)+event.dy;target.style.webkitTransform=target.style.transform="translate("+x+"px, "+y+"px)",target.setAttribute("data-x",x),target.setAttribute("data-y",y)}this.interact=interact(element).draggable({inertia:!0,restrict:{restriction:parentElement,endOnly:!1,elementRect:{top:0,left:0,bottom:1,right:1}},autoScroll:!0,onmove:dragMoveListener,onend:function(event){}}).resizable({preserveAspectRatio:!0,edges:{left:!0,right:!0,bottom:!0,top:!0},margin:10}).on("resizemove",function(event){var target=event.target,x=parseFloat(target.getAttribute("data-x"))||0,y=parseFloat(target.getAttribute("data-y"))||0;target.style.width=event.rect.width+"px",target.style.height=event.rect.height+"px",x+=event.deltaRect.left,y+=event.deltaRect.top,target.style.webkitTransform=target.style.transform="translate("+x+"px,"+y+"px)",target.setAttribute("data-x",x),target.setAttribute("data-y",y)});window.dragMoveListener=dragMoveListener},swapHandler:function(){isUndefinedOrNull(this.swap)||this.swapWith(this.swap.swapContainerId)},pinHandler:function(){this.pinned?this.unpin():this.pinTo(this.pin.containerId)},minimizeHandler:function(){this.minimized?this.restore():this.minimize()},closeHandler:function(){this.close()},connectDataSourceHandler:function(){this.connected?OSH.EventManager.fire(OSH.EventManager.EVENT.DISCONNECT_DATASOURCE,{dataSourcesId:this.connectionIds}):OSH.EventManager.fire(OSH.EventManager.EVENT.CONNECT_DATASOURCE,{dataSourcesId:this.connectionIds}),this.connected=!this.connected},swapWith:function(dstContainerId){var dstContainerElt=document.getElementById(dstContainerId);OSH.Asserts.checkIsDefineOrNotNull(dstContainerElt);var i,childrenDst=[];for(i=0;i<dstContainerElt.children.length;i++)childrenDst.push(dstContainerElt.removeChild(dstContainerElt.children[i]));var childrenDialog=[];for(i=0;i<this.contentElt.children.length;i++)childrenDialog.push(this.contentElt.removeChild(this.contentElt.children[i]));for(i=0;i<childrenDialog.length;i++)dstContainerElt.appendChild(childrenDialog[i]);for(i=0;i<childrenDst.length;i++)this.contentElt.appendChild(childrenDst[i])},pinAuto:function(){this.pinHandler()},pinTo:function(containerId){if(!this.modal){OSH.Asserts.checkIsDefineOrNotNull(this.interact),OSH.Asserts.checkIsDefineOrNotNull(this.interact.target),this.parentElementDiv.removeChild(this.elementDiv);var dstContainerElt=document.getElementById(containerId);OSH.Asserts.checkIsDefineOrNotNull(dstContainerElt),dstContainerElt.appendChild(this.elementDiv),this.interact.draggable(!1),this.pin.lastPosition.x=parseFloat(this.interact.target.getAttribute("data-x"))||0,this.pin.lastPosition.y=parseFloat(this.interact.target.getAttribute("data-y"))||0,this.setPosition(0,0),this.interact.target.style.position="relative",OSH.Utils.addCss(this.headerTrElt.pin,"icon-selected"),this.pinned=!0}},unpin:function(){if(!this.modal){OSH.Asserts.checkIsDefineOrNotNull(this.interact),OSH.Asserts.checkIsDefineOrNotNull(this.interact.target),this.elementDiv.parentNode.removeChild(this.elementDiv);var originalContainerElt=document.getElementById(this.pin.originalContainerId);OSH.Asserts.checkIsDefineOrNotNull(originalContainerElt),originalContainerElt.appendChild(this.elementDiv),this.interact.draggable(this.draggable),this.setPosition(this.pin.lastPosition.x,this.pin.lastPosition.y),OSH.Asserts.checkIsDefineOrNotNull(this.pin.position),this.interact.target.style.position=this.pin.position,OSH.Utils.removeCss(this.headerTrElt.pin,"icon-selected"),this.pinned=!1}},minimize:function(){OSH.Utils.addCss(this.innerElementDiv,"minimized"),OSH.Utils.addCss(this.contentElt,"hide"),OSH.Utils.addCss(this.footerElt,"hide"),OSH.Utils.replaceCss(this.headerTrElt.minimize,"icon-minimize","icon-restore"),this.minimized=!0,this.interact.resizable(!1)},restore:function(){OSH.Utils.removeCss(this.innerElementDiv,"minimized"),OSH.Utils.removeCss(this.contentElt,"hide"),OSH.Utils.removeCss(this.footerElt,"hide"),OSH.Utils.replaceCss(this.headerTrElt.minimize,"icon-restore","icon-minimize"),this.minimized=!1,this.interact.resizable(this.draggable)},onClose:function(){},close:function(){this.destroyOnClose?this.elementDiv.parentNode.removeChild(this.elementDiv):this.setVisible(!1),this.onClose()},setPosition:function(x,y){this.interact.target.style.webkitTransform=this.interact.target.style.transform="translate("+x+"px, "+y+"px)",this.interact.target.setAttribute("data-x",x),this.interact.target.setAttribute("data-y",y)}});
OSH.UI.Panel.MultiDialogPanel=OSH.UI.Panel.DialogPanel.extend({initialize:function(parentElementDivId,properties){this._super(parentElementDivId,properties),this.properties=properties},initPanel:function(){this._super(),this.extraElt=this.createExtra(),this.innerElementDiv.insertChildAtIndex(this.extraElt,2)},createExtra:function(){var extraElt=document.createElement("div");extraElt.setAttribute("class","dialog-extra");var inputExtraElt=document.createElement("input");inputExtraElt.setAttribute("type","checkbox"),inputExtraElt.setAttribute("name","dialog-extra-input"),inputExtraElt.setAttribute("id","dialog-extra-input");var labelExtraElt=document.createElement("label");labelExtraElt.setAttribute("for","dialog-extra-input");var iExtraElt=document.createElement("i");iExtraElt.setAttribute("class","fa fa-fw icon-extra"),labelExtraElt.appendChild(iExtraElt);var extraContentElt=document.createElement("div");return extraContentElt.setAttribute("class","dialog-extra-content"),extraElt.appendChild(inputExtraElt),extraElt.appendChild(labelExtraElt),extraElt.appendChild(extraContentElt),extraElt},minimize:function(){this._super(),OSH.Utils.addCss(this.extraElt,"hide")},restore:function(){this._super(),OSH.Utils.removeCss(this.extraElt,"hide")},appendView:function(view,properties){var extraEltContent=this.extraElt.querySelector(".dialog-extra-content");OSH.Asserts.checkIsDefineOrNotNull(extraEltContent),OSH.Asserts.checkIsDefineOrNotNull(view),extraEltContent.appendChild(view.elementDiv),view.setVisible(!0)}});
OSH.UI.Panel.SaveDialogPanel=OSH.UI.Panel.DialogPanel.extend({initialize:function(parentElementDivId,properties){this._super(parentElementDivId,properties),this.properties=properties},initPanel:function(){this._super();var saveButtonId="dialog-save-button-"+OSH.Utils.randomUUID(),divButton=document.createElement("div");divButton.setAttribute("class","button-edit");var button=document.createElement("button");button.setAttribute("id",saveButtonId),button.setAttribute("class","submit save"),button.innerHTML="Save",divButton.appendChild(button),this.footerElt.appendChild(divButton),OSH.EventManager.observeDiv(saveButtonId,"click",this.onSaveClickButtonHandler.bind(this)),OSH.Utils.addCss(this.elementDiv,"save-dialog")},onSaveClickButtonHandler:function(event){this.onSave()},onSave:function(){}});
OSH.UI.Panel.EntityInfoPanel=OSH.UI.Panel.extend({initialize:function(parentElementDivId,properties){this._super(parentElementDivId,properties)},initPanel:function(){this.nameTagId=OSH.Helper.HtmlHelper.addInputText(this.elementDiv,"Name","My entity","entity name"),this.iconTagId=OSH.Helper.HtmlHelper.addInputText(this.elementDiv,"Icon","images/cameralook.png","icon path"),this.descriptionTagId=OSH.Helper.HtmlHelper.addInputText(this.elementDiv,"Description url","","description here"),OSH.Utils.addCss(this.elementDiv,"info")},loadInfos:function(infos){OSH.Asserts.checkIsDefineOrNotNull(infos),OSH.Asserts.checkObjectPropertyPath(infos,"name","infos.name does not exist"),OSH.Asserts.checkObjectPropertyPath(infos,"icon","infos.icon does not exist"),OSH.Asserts.checkObjectPropertyPath(infos,"description","infos.description does not exist"),document.getElementById(this.nameTagId).value=infos.name,document.getElementById(this.iconTagId).value=infos.icon,document.getElementById(this.descriptionTagId).value=infos.description}});
OSH.UI.Panel.EntityViewPanel=OSH.UI.Panel.extend({initialize:function(parentElementDivId,properties){this._super(parentElementDivId,properties)},initPanel:function(){this.views=[];var selectEltId=(OSH.Utils.randomUUID(),OSH.Utils.randomUUID(),OSH.Utils.randomUUID(),OSH.Utils.randomUUID(),OSH.Helper.HtmlHelper.addHTMLListBox(this.elementDiv,"",[],"Select a view"));this.selectElt=document.getElementById(selectEltId);var buttonElt=document.createElement("button");buttonElt.setAttribute("class","submit add-view-button"),buttonElt.innerHTML="Add",this.containerElt=document.createElement("div"),this.containerElt.setAttribute("class","view-container"),this.elementDiv.appendChild(buttonElt),this.elementDiv.appendChild(this.containerElt),OSH.Utils.addCss(this.elementDiv,"views"),OSH.EventManager.observeElement(buttonElt,"click",this.onAddViewClickHandler.bind(this)),this.initViews()},initViews:function(){var views=[{name:"Map 2D (New)",viewInstanceType:OSH.UI.ViewFactory.ViewInstanceType.LEAFLET,type:OSH.UI.View.ViewType.MAP,hash:1},{name:"Globe 3D (New)",viewInstanceType:OSH.UI.ViewFactory.ViewInstanceType.CESIUM,type:OSH.UI.View.ViewType.MAP,hash:2},{name:"Chart (New)",viewInstanceType:OSH.UI.ViewFactory.ViewInstanceType.NVD3_LINE_CHART,type:OSH.UI.View.ViewType.CHART,hash:3},{name:"Video - H264 (New)",viewInstanceType:OSH.UI.ViewFactory.ViewInstanceType.FFMPEG,type:OSH.UI.View.ViewType.VIDEO,hash:4},{name:"Video - MJPEG (New)",viewInstanceType:OSH.UI.ViewFactory.ViewInstanceType.MJPEG,type:OSH.UI.View.ViewType.VIDEO,hash:5}];this.removeAllFromSelectElement(this.selectElt);for(var key in views){var option=document.createElement("option");option.text=views[key].name,option.value=views[key].name,option.properties=views[key],this.selectElt.add(option)}OSH.Helper.HtmlHelper.onDomReady(this.initExistingViews.bind(this))},initExistingViews:function(){var self=this,viewList=this.getViewList();for(var key in viewList){var currentViewDiv=viewList[key];OSH.Utils.getObjectById(currentViewDiv.id,function(event){var option=document.createElement("option");option.text=event.object.name,option.value=event.object.name,option.properties={name:event.object.name,type:event.object.type,instance:event.object},self.selectElt.add(option);var addView=!1;for(var keyView in event.object.viewItems)if(event.object.viewItems[keyView].entityId===self.options.entityId){addView=!0;break}addView&&self.addView(option.properties)})}},onAddViewClickHandler:function(event){var viewProperties=(document.getElementById(this.viewContainer),this.selectElt.options[this.selectElt.selectedIndex].properties);isUndefinedOrNull(viewProperties)||""===viewProperties.value||this.addView(viewProperties)},addView:function(viewProperties){var viewInstance;isUndefinedOrNull(viewProperties.instance)?viewInstance=this.getNewViewInstance(viewProperties):(viewInstance=viewProperties.instance,viewInstance.hash=0),this.views.push(viewInstance);var lineElt=this.getNewLine(viewInstance.name);this.containerElt.appendChild(lineElt);var editElt=lineElt.querySelectorAll(".control td.edit"),deleteElt=lineElt.querySelectorAll(".control td.delete");return editElt=editElt[editElt.length-1],deleteElt=deleteElt[deleteElt.length-1],OSH.EventManager.observeElement(editElt,"click",this.editHandler.bind(this,lineElt,viewInstance)),OSH.EventManager.observeElement(deleteElt,"click",this.deleteHandler.bind(this,lineElt,viewInstance)),viewInstance},getViewList:function(){return document.querySelectorAll(".osh.view")},getNewViewInstance:function(properties){var defaultViewProperties,viewInstanceType=properties.viewInstanceType;isUndefinedOrNull(properties.options)?(defaultViewProperties=OSH.UI.ViewFactory.getDefaultViewProperties(viewInstanceType),defaultViewProperties.name=properties.name):defaultViewProperties=properties.options;var viewInstance=OSH.UI.ViewFactory.getDefaultViewInstance(viewInstanceType,defaultViewProperties);return viewInstance.hash=properties.hash,viewInstance},getNewLine:function(viewName){var lineElt=document.createElement("div");lineElt.setAttribute("id","LineView"+OSH.Utils.randomUUID()),lineElt.setAttribute("class","ds-line");var spanElt=document.createElement("span");spanElt.setAttribute("class","line-left"),spanElt.innerHTML=""+viewName;var tableElt=document.createElement("table");tableElt.setAttribute("class","control line-right");var trElt=document.createElement("tr"),editTdElt=document.createElement("td");editTdElt.setAttribute("class","fa fa-2x fa-pencil-square-o edit"),editTdElt.setAttribute("aria-hidden","true");var deleteTdElt=document.createElement("td");deleteTdElt.setAttribute("class","fa fa-2x fa-trash-o delete"),deleteTdElt.setAttribute("aria-hidden","true");var divElt=document.createElement("div");return divElt.setAttribute("style","clear: both;"),trElt.appendChild(editTdElt),trElt.appendChild(deleteTdElt),tableElt.appendChild(trElt),lineElt.appendChild(spanElt),lineElt.appendChild(tableElt),lineElt.appendChild(divElt),lineElt},editHandler:function(lineElt,viewInstance){var viewInstance=this.getViewById(viewInstance.id);OSH.Asserts.checkIsDefineOrNotNull(viewInstance);var dsArray=[];for(var key in this.options.datasources){var dsClone=this.options.datasources[key];dsArray.push(dsClone)}var cloneViewInstance={};OSH.Utils.copyProperties(viewInstance,cloneViewInstance);var editView,options={view:cloneViewInstance,datasources:dsArray,entityId:this.options.entityId};switch(viewInstance.type){case OSH.UI.View.ViewType.MAP:editView=new OSH.UI.Panel.EntityMapEditPanel("",options);break;case OSH.UI.View.ViewType.CHART:editView=new OSH.UI.Panel.EntityChartEditPanel("",options);break;case OSH.UI.View.ViewType.VIDEO:editView=viewInstance instanceof OSH.UI.View.MjpegView?new OSH.UI.Panel.EntityMJPEGVideoEditPanel("",options):new OSH.UI.Panel.EntityVideoEditPanel("",options)}OSH.Asserts.checkIsDefineOrNotNull(editView);var editViewDialog=new OSH.UI.Panel.SaveDialogPanel("",{draggable:!0,css:"dialog-edit-view",name:"Edit "+cloneViewInstance.name+" View",show:!0,dockable:!1,closeable:!0,connectionIds:[],destroyOnClose:!0,modal:!0});editView.attachToElement(editViewDialog.contentElt),editViewDialog.onSave=function(){var clonedView=editView.getView();lineElt.querySelector("span.line-left").innerHTML=clonedView.name;var i;for(i=0;i<this.views.length;i++)if(this.views[i].id===clonedView.id){var viewProperties=editView.getProperties();this.views[i].viewItemsToAdd=clonedView.viewItemsToAdd,this.views[i].viewItemsToRemove=clonedView.viewItemsToRemove,this.views[i].updateProperties(viewProperties),OSH.Utils.hasOwnNestedProperty(viewProperties,"name")&&(this.views[i].name=viewProperties.name,this.views[i].options.name=viewProperties.name,0===this.views[i].hash||isUndefinedOrNull(this.views[i].dialog)||this.updateDialog(this.views[i],viewProperties));break}editViewDialog.close(),editView=null,this.checkViewItems(this.views[i])}.bind(this)},updateDialog:function(view,viewProperties){var parentDialog=OSH.Utils.getSomeParentTheClass(this.views[i].elementDiv,"dialog");OSH.Asserts.checkIsDefineOrNotNull(parentDialog),OSH.Utils.getObjectById(parentDialog.id,function(event){OSH.Asserts.checkTrue(event.object instanceof OSH.UI.Panel.DialogPanel,"The class should be a dialog panel and is "+event.object);var properties={title:viewProperties.name};isUndefinedOrNull(viewProperties.keepRatio)||(properties.keepRatio=viewProperties.keepRatio),event.object.updateProperties(properties)})},deleteHandler:function(lineElt,viewInstance){var viewInstance=this.getViewById(viewInstance.id);OSH.Asserts.checkIsDefineOrNotNull(viewInstance),this.containerElt.removeChild(lineElt);for(var newArr=[],i=0;i<this.views.length;i++)this.views[i].id!==viewInstance.id&&newArr.push(this.views[i]);this.views=newArr;for(var currentViewItem,i=0;i<viewInstance.viewItems.length;i++)currentViewItem=viewInstance.viewItems[i],currentViewItem.entityId===this.options.entityId&&viewInstance.removeViewItem(currentViewItem);0!==viewInstance.hash&&OSH.Utils.destroyElement(viewInstance.elementDiv)},checkViewItems:function(view){if(!isUndefinedOrNull(view.viewItemsToAdd)){for(var j=0;j<view.viewItemsToAdd.length;j++){var viewItemToAdd=view.viewItemsToAdd[j];view.addViewItem(viewItemToAdd)}view.viewItemsToAdd=[]}if(!isUndefinedOrNull(view.viewItemsToRemove)){for(var j=0;j<view.viewItemsToRemove.length;j++){var viewItemToRemove=view.viewItemsToRemove[j];view.removeViewItem(viewItemToRemove)}view.viewItemsToRemove=[]}for(var j=0;j<view.viewItems.length;j++){var viewItemToUpdate=view.viewItems[j];view.updateViewItem(viewItemToUpdate)}},reset:function(){OSH.Helper.HtmlHelper.removeAllNodes(this.containerElt),this.views=[]},getViewById:function(id){var view;for(i=0;i<this.views.length;i++)if(this.views[i].id===id){view=this.views[i];break}return view},loadViews:function(viewPropertiesArray){this.reset();var currentProperty,existingViewList=this.getViewList();for(var key in viewPropertiesArray)if(currentProperty=viewPropertiesArray[key],0===currentProperty.hash)for(var i=0;i<existingViewList.length;i++)this.restoringExistingView(existingViewList[i],currentProperty);else this.restoringDialogView(existingViewList[i],currentProperty)},restoringDialogView:function(currentViewDiv,properties){var viewInstance=this.addView({name:properties.name,type:properties.type,hash:properties.hash,viewInstanceType:properties.viewInstanceType,options:properties.options});this.restoringView(viewInstance,currentViewDiv,properties)},restoringExistingView:function(currentViewDiv,properties){OSH.EventManager.observe(OSH.EventManager.EVENT.SEND_OBJECT+"-"+currentViewDiv.id,function(event){var viewInstance=event.object,nodeIndex=OSH.Utils.getChildNumber(viewInstance.elementDiv);viewInstance.type===properties.type&&nodeIndex===properties.nodeIdx&&viewInstance.elementDiv.parentNode.id===properties.container&&(this.restoringView(viewInstance,currentViewDiv,properties),this.addView({name:properties.name,type:properties.type,instance:viewInstance,hash:properties.hash})),OSH.EventManager.remove(OSH.EventManager.EVENT.SEND_OBJECT+"-"+currentViewDiv.id)}.bind(this)),OSH.EventManager.fire(OSH.EventManager.EVENT.GET_OBJECT+"-"+currentViewDiv.id)},restoringView:function(viewInstance,currentViewDiv,properties){for(var key in properties.viewItems){var props=this.restoringStyler(properties.viewItems[key]);viewInstance.addViewItem(props)}},restoringStyler:function(currentViewItemProps){var currentViewStylerProps=currentViewItemProps.styler,stylerInstance=OSH.UI.Styler.Factory.getNewInstanceFromType(currentViewStylerProps.type);if(OSH.Utils.copyProperties(currentViewStylerProps,stylerInstance,!1),OSH.Utils.hasOwnNestedProperty(stylerInstance,"properties.ui"))for(var property in stylerInstance.properties)if(property.endsWith("Func")){var fnProperty=this.restoringStylerFunction(property,stylerInstance.properties[property],stylerInstance.properties.ui);stylerInstance.updateProperties(fnProperty)}return{name:currentViewItemProps.name,entityId:currentViewItemProps.entityId,styler:stylerInstance}},restoringStylerFunction:function(fnName,fnProperty,uiProperty){for(var matches,regex=/(blob:[^']*)'/g,funcStr=fnProperty.handlerStr;null!==(matches=regex.exec(fnProperty.handlerStr));){var result=[];if(OSH.Utils.searchPropertyByValue(uiProperty,matches[1],result),!isUndefinedOrNull(result)&&result.length>0){var blobUrl=OSH.Utils.binaryStringToBlob(result[0].binaryString);funcStr=funcStr.replace(matches[1],blobUrl),result[0].url=blobUrl}}return OSH.UI.Styler.Factory.buildFunctionFromSource(fnProperty.dataSourceIds,fnName,funcStr)}});
OSH.UI.Panel.EntityFilePanel=OSH.UI.Panel.extend({initialize:function(parentElementDivId,properties){this._super(parentElementDivId,properties)},initPanel:function(){var loadDivElt=document.createElement("div"),loadButtonElt=document.createElement("button");loadButtonElt.setAttribute("id",OSH.Utils.randomUUID()),loadButtonElt.setAttribute("class","submit load-button"),loadButtonElt.setAttribute("disabled",""),loadButtonElt.innerHTML="Load",loadDivElt.appendChild(loadButtonElt);var inputFileEltId=OSH.Helper.HtmlHelper.addFileChooser(loadDivElt),self=this;this.loadedFiles=[],OSH.Helper.HtmlHelper.onDomReady(function(){document.getElementById("text-"+inputFileEltId).className+=" load-settings ";var lastDataLoaded,inputFileElt=document.getElementById(inputFileEltId);self.addListener(inputFileElt,"change",self.inputFileHandlerAsText.bind(inputFileElt,function(result){self.enableElt(loadButtonElt.id),lastDataLoaded=result})),self.addListener(loadButtonElt,"click",function(evt){if(!isUndefinedOrNull(lastDataLoaded))try{self.loadProperties(lastDataLoaded.data,lastDataLoaded.file.name)}catch(exception){throw new OSH.Exception.Exception("Cannot convert '"+lastDataLoaded.file.name+"' into JSON: ",exception)}})});var divSaveElt=document.createElement("div");divSaveElt.setAttribute("class","save");var saveButtonElt=document.createElement("button");saveButtonElt.setAttribute("id",OSH.Utils.randomUUID()),saveButtonElt.setAttribute("class","submit load-button"),saveButtonElt.innerHTML="Save",divSaveElt.appendChild(saveButtonElt);var inputTextSaveEltId=OSH.Helper.HtmlHelper.addInputText(divSaveElt,null,"entity-properties.json","filename.json");OSH.Helper.HtmlHelper.onDomReady(function(){var inputTextElt=document.getElementById(inputTextSaveEltId);self.addListener(saveButtonElt,"click",function(evt){var inputTextValue=inputTextElt.value,fileName="entity-properties.json";isUndefinedOrNull(inputTextValue)||""===inputTextValue||(fileName=inputTextValue),self.savePropertiesHandler(fileName)})}),this.elementDiv.appendChild(loadDivElt),this.elementDiv.appendChild(divSaveElt)},saveProperties:function(properties,fileName){try{var blob=new Blob([JSON.stringify(properties)],{type:"text/plain;charset=utf-8"});saveAs(blob,fileName)}catch(exception){throw new OSH.Exception.Exception("Cannot save the data as file: "+fileName,exception)}},loadProperties:function(textData,fileName){try{this.loadedFiles.indexOf(fileName)===-1&&(this.loadPropertiesHandler(JSON.parse(textData)),this.loadedFiles.push(fileName))}catch(exception){throw new OSH.Exception.Exception("Cannot convert '"+fileName+"' into JSON: ",exception)}},loadPropertiesHandler:function(jsonProperties){},savePropertiesHandler:function(filename){var props=this.beforeOnSaveProperties();this.saveProperties(props,filename)},beforeOnSaveProperties:function(){return[]},enableElt:function(id){document.getElementById(id).removeAttribute("disabled","")}});
OSH.UI.Panel.EntityDatasourcePanel=OSH.UI.Panel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){this.addDsButtonId=OSH.Utils.randomUUID(),this.entity=this.options.entity;var buttonElt=document.createElement("button");buttonElt.setAttribute("id",this.addDsButtonId),buttonElt.setAttribute("class","submit datasource"),buttonElt.innerHTML="Add";var divContainer=document.createElement("div");this.divDSContainerId=OSH.Utils.randomUUID(),divContainer.setAttribute("id",this.divDSContainerId),divContainer.setAttribute("class","datasource-container"),OSH.EventManager.observeDiv(this.addDsButtonId,"click",this.onAddDataSourceButtonClickHandler.bind(this)),this.elementDiv.appendChild(buttonElt),this.elementDiv.appendChild(divContainer),this.datasources={},this.nbDatasources=0},onAddDataSourceButtonClickHandler:function(event){var discoveryView=new OSH.UI.Panel.DiscoveryPanel("",{services:this.options.services});discoveryView.onAddHandler=this.addDataSource.bind(this);var discoveryDialog=new OSH.UI.Panel.DialogPanel("",{draggable:!0,css:"dialog-discovery",title:"Discovery",show:!0,dockable:!1,closeable:!0,connectionIds:[],destroyOnClose:!0,modal:!0,keepRatio:!1});discoveryView.attachToElement(discoveryDialog.contentElt)},addDataSource:function(dataSource){this.nbDatasources++,this.datasources[dataSource.id]=dataSource;var div=document.createElement("div");div.setAttribute("id",dataSource.id),div.setAttribute("class","ds-line");var deleteId=OSH.Utils.randomUUID(),editId=OSH.Utils.randomUUID(),strVar='<span class=" line-left" id="ds-name-'+dataSource.id+'">'+dataSource.name+"</span>";strVar+='   <table class="control line-right">',strVar+="      <tr>",strVar+='         <td><i class="fa fa-2x fa-pencil-square-o edit" aria-hidden="true" id="'+editId+'"></i></td>',strVar+='         <td><i class="fa fa-2x fa-trash-o delete" aria-hidden="true" id="'+deleteId+'"></i></td>',strVar+="      </tr>",strVar+="   </table>",strVar+="</div>",strVar+='<div style="clear: both;"></div>',div.innerHTML=strVar,document.getElementById(this.divDSContainerId).appendChild(div);var self=this;this.entity.dataSources.push(dataSource),OSH.EventManager.observeDiv(deleteId,"click",function(event){div.parentNode.removeChild(div),dataSource.disconnect(),delete self.datasources[dataSource.id],self.nbDatasources--,self.entity.dataSources=self.entity.dataSources.filter(function(ds){return ds.id!==dataSource.id})}),OSH.EventManager.observeDiv(editId,"click",function(event){var discoveryView=new OSH.UI.Panel.DiscoveryPanel("",{services:self.options.services});discoveryView.onEditHandler=self.editDataSource.bind(self);var discoveryDialog=new OSH.UI.Panel.DialogPanel("",{draggable:!0,css:"dialog-discovery",title:"Discovery",show:!0,dockable:!1,closeable:!0,connectionIds:[],destroyOnClose:!0,modal:!0,keepRatio:!1});discoveryView.attachToElement(discoveryDialog.contentElt),discoveryView.initDataSource(self.datasources[dataSource.id]),discoveryView.getButtonElement().value="Edit",discoveryView.getButtonElement().text="Edit",discoveryView.getButtonElement().innerHTML="Edit"})},editDataSource:function(dataSource){this.datasources[dataSource.id]=dataSource,document.getElementById("ds-name-"+dataSource.id).innerHTML=dataSource.name,dataSource.disconnect(),this.onDatasourceChanged(dataSource)},onDatasourceChanged:function(dataSource){},loadDataSourcesProperty:function(dsPropertyArray,callback){this.reset();var self=this;(isUndefinedOrNull(dsPropertyArray)||0===dsPropertyArray.length)&&callback([]);var nbElements=dsPropertyArray.length;for(var key in dsPropertyArray)!function(id){OSH.DataReceiver.DataSourceFactory.createDatasourceFromType(dsPropertyArray[key],function(result){result.id=id,self.addDataSource(result),0==--nbElements&&callback(Object.values(self.datasources))})}(dsPropertyArray[key].id)},reset:function(){OSH.Helper.HtmlHelper.removeAllNodes(document.getElementById(this.divDSContainerId)),this.datasources={},this.nbDatasources=0}});
OSH.UI.Panel.EntityEditorPanel=OSH.UI.Panel.extend({initialize:function(parentElementDivId,properties){this._super(parentElementDivId,properties),this.viewContainer=document.body.id,this.services=[],isUndefinedOrNull(properties)||(isUndefinedOrNull(properties.viewContainer)||(this.viewContainer=properties.viewContainer),isUndefinedOrNull(properties.services)||(this.services=properties.services),isUndefinedOrNull(properties.entity)||(this.entity=properties.entity)),isUndefinedOrNull(this.entity)&&this.createEntity();var entityEditor=document.createElement("div");entityEditor.setAttribute("id","Entity-editor-"+OSH.Utils.randomUUID()),entityEditor.setAttribute("class","entity-editor"),document.getElementById(this.divId).appendChild(entityEditor),this.tabPanel=new OSH.UI.Panel.TabPanel,this.tabPanel.addTab("File",this.createFilePanel()),this.tabPanel.addTab("Info",this.createInfoPanel()),this.tabPanel.addTab("Data Sources",this.createDSPanel()),this.tabPanel.addTab("Views",this.createViewPanel()),entityEditor.appendChild(this.tabPanel.elementDiv),OSH.Helper.HtmlHelper.addHTMLLine(entityEditor);var createButtonElt=document.createElement("button");createButtonElt.setAttribute("class","submit save-entity-button"),createButtonElt.innerHTML="Save",entityEditor.appendChild(createButtonElt),this.properties={datasources:{},views:[]},this.addListener(createButtonElt,"click",this.saveEntity.bind(this))},createEntity:function(){this.entity={id:"entity-"+OSH.Utils.randomUUID(),dataSources:[],dataProviderController:new OSH.DataReceiver.DataReceiverController({replayFactor:1})}},createFilePanel:function(){var filePanel=new OSH.UI.Panel.EntityFilePanel;return filePanel.beforeOnSaveProperties=function(){return this.createSaveProperty()}.bind(this),filePanel.loadPropertiesHandler=function(properties){this.restoreSavedProperties(properties)}.bind(this),filePanel.elementDiv},createInfoPanel:function(){return this.infoPanel=new OSH.UI.Panel.EntityInfoPanel,this.infoPanel.elementDiv},createDSPanel:function(){return this.datasourcePanel=new OSH.UI.Panel.EntityDatasourcePanel("",{services:this.services,entity:this.entity}),this.datasourcePanel.onDatasourceChanged=function(datasource){this.entity.dataProviderController.updateDataSource(datasource)}.bind(this),this.datasourcePanel.elementDiv},createViewPanel:function(){return this.viewPanel=new OSH.UI.Panel.EntityViewPanel("",{datasources:this.datasourcePanel.datasources,entityId:this.entity.id}),this.viewPanel.elementDiv},initDatasources:function(){if(!isUndefinedOrNull(this.entity.datacontroller))for(var key in this.entity.dataSources){var ds=this.entity.datacontroller.getDataSource(this.entity.dataSources[key]);this.datasourcePanel.addDataSource(ds)}},enableElt:function(id){document.getElementById(id).removeAttribute("disabled","")},disableElt:function(id){document.getElementById(id).setAttribute("disabled","")},saveEntity:function(){var views=this.viewPanel.views,menuItems=[];for(var key in views){var currentView=views[key],viewId=currentView.id;0!==currentView.hash&&this.saveDialog(currentView),menuItems.push({name:currentView.name,viewId:viewId,css:"fa fa-video-camera"})}if(menuItems.length>0)for(var menuId="menu-"+OSH.Utils.randomUUID(),i=(new OSH.UI.ContextMenu.StackMenu({id:menuId,groupId:"menu-"+OSH.Utils.randomUUID(),items:menuItems}),0);i<views.length;i++)for(var j=0;j<views[i].viewItems.length;j++)views[i].viewItems[j].contextMenuId=menuId;this.entity.dataSources=Object.values(this.datasourcePanel.datasources),this.entity.dataProviderController.addEntity(this.entity),this.entity.dataProviderController.connectAll()},saveDialog:function(view){if(isUndefinedOrNull(view.dialog)||!view.dialog.in){var viewDialog=new OSH.UI.Panel.DialogPanel("",{draggable:!0,css:"app-dialog",title:view.name,show:!0,dockable:!1,closeable:!0,connectionIds:[],destroyOnClose:!1,modal:!1,keepRatio:!isUndefinedOrNull(view.options.keepRatio)&&view.options.keepRatio});view.attachToElement(viewDialog.contentElt),view.dialog={in:!0,closed:!1},viewDialog.onClose=function(){view.dialog.closed=!0},viewId=viewDialog.id}else if(view.dialog.closed){var parentDialog=OSH.Utils.getSomeParentTheClass(view.elementDiv,"dialog");isUndefinedOrNull(parentDialog)||(viewId=parentDialog.id,OSH.EventManager.fire(OSH.EventManager.EVENT.SHOW_VIEW,{viewId:viewId}))}},createSaveProperty:function(){var result={};return this.saveInfo(result),this.saveDatasources(result),this.saveViews(result),result},saveInfo:function(result){result.infos={id:this.entity.id,name:document.getElementById(this.infoPanel.nameTagId).value,icon:document.getElementById(this.infoPanel.iconTagId).value,description:document.getElementById(this.infoPanel.descriptionTagId).value}},saveDatasources:function(result){var datasourcesProperty=[];for(var key in this.datasourcePanel.datasources){var dsProps={};OSH.Utils.copyProperties(this.datasourcePanel.datasources[key].properties,dsProps),dsProps.id=this.datasourcePanel.datasources[key].id,datasourcesProperty.push(dsProps)}result.datasources=datasourcesProperty},saveViews:function(result){result.views=[];var currentView;for(var key in this.viewPanel.views)currentView=this.viewPanel.views[key],result.views.push(this.saveView(currentView))},saveView:function(view){if(!isUndefinedOrNull(view.viewItems)){var currentViewItem,viewItems=[];for(var key in view.viewItems)currentViewItem=view.viewItems[key],currentViewItem.entityId===this.entity.id&&viewItems.push(this.saveViewItem(currentViewItem))}return{type:view.type,hash:view.hash,name:view.name,container:view.elementDiv.parentNode.id,nodeIdx:OSH.Utils.getChildNumber(view.elementDiv),display:view.elementDiv.style.display,viewItems:viewItems,options:view.options,viewInstanceType:view.viewInstanceType}},saveViewItem:function(viewItem){var viewItemToSave={name:viewItem.name,entityId:viewItem.entityId,styler:null};return isUndefinedOrNull(viewItem.styler)||(viewItemToSave.styler=this.saveStyler(viewItem.styler)),viewItemToSave},saveStyler:function(styler){var stylerToSave={properties:{},type:OSH.UI.Styler.Factory.getTypeFromInstance(styler)};for(var property in styler.properties)stylerToSave.properties[property]={},property.endsWith("Func")?(OSH.Utils.copyProperties(styler.properties[property],stylerToSave.properties[property]),stylerToSave.properties[property].handlerStr=styler.properties[property].handler.toSource()):stylerToSave.properties[property]=styler.properties[property];return stylerToSave},restoreSavedProperties:function(properties){this.infoPanel.loadInfos(properties.infos),this.datasourcePanel.loadDataSourcesProperty(properties.datasources,function(datasourceArray){this.createEntity(),this.entity.id=properties.infos.id,this.entity.name=properties.infos.name,this.entity.icon=properties.infos.icon,this.entity.description=properties.infos.description,this.entity.dataSources=datasourceArray,this.viewPanel.options.entityId=this.entity.id,this.viewPanel.options.datasources=this.datasourcePanel.datasources,this.viewPanel.loadViews(properties.views),this.saveEntity()}.bind(this))}});
OSH.UI.Panel.EntityEditViewPanel=OSH.UI.Panel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){this.view=this.options.view,isUndefinedOrNull(this.options.entityId)||(this.entityId=this.options.entityId),OSH.Utils.addCss(this.elementDiv,"edit-view"),this.viewPropertiesElt=document.createElement("div"),this.viewPropertiesElt.setAttribute("class","view-properties"),this.elementDiv.appendChild(this.viewPropertiesElt),this.contentElt=document.createElement("div"),this.contentElt.setAttribute("class","content-properties"),this.elementDiv.appendChild(this.contentElt),this.buildViewProperties();var containerArr=this.getContainers();""!==this.view.container&&(isUndefinedOrNull(this.view.container.id)?containerArr=this.getContainers().concat(this.view.container).filter(function(value,index,self){return self.indexOf(value)===index}):containerArr.push(this.view.container.id)),this.buildContent()},buildViewProperties:function(){OSH.Helper.HtmlHelper.addHTMLTitledLine(this.viewPropertiesElt,"View properties");var inputViewNameId=OSH.Helper.HtmlHelper.addInputText(this.viewPropertiesElt,"Name",this.view.name),self=this;OSH.EventManager.observeDiv(inputViewNameId,"change",function(event){self.view.name=this.value})},buildContainer:function(containerArr){OSH.Helper.HtmlHelper.addHTMLTitledLine(this.elementDiv,"Container"),this.containerDivId=OSH.Helper.HtmlHelper.addHTMLListBox(this.elementDiv,"",containerArr),OSH.Helper.HtmlHelper.HTMLListBoxSetSelected(document.getElementById(this.containerDivId),this.view.container);var containerElt=document.getElementById(this.containerDivId);if(!isUndefinedOrNull(this.view.container)){var idx=-1;idx=isUndefinedOrNull(this.view.container.id)?containerArr.indexOf(this.view.container):containerArr.indexOf(this.view.container.id),containerElt.options[idx].setAttribute("selected","")}var self=this;OSH.EventManager.observeDiv(this.containerDivId,"change",function(event){self.view.container=this.options[this.selectedIndex].value})},buildContent:function(){},getView:function(){return this.view},getProperties:function(){return{name:this.view.name}},getContainers:function(){return[" ","Dialog"]}});
OSH.UI.Panel.EntityViewItemsEditPanel=OSH.UI.Panel.EntityEditViewPanel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},buildContent:function(){var viewItems=[];!isUndefinedOrNull(this.view.viewItems)&&this.view.viewItems.length>0&&(viewItems=this.view.viewItems),!isUndefinedOrNull(this.view.viewItemsToAdd)&&this.view.viewItemsToAdd.length>0&&(viewItems=viewItems.concat(this.view.viewItemsToAdd)),this.buildViewItems(viewItems)},buildViewItems:function(defaultViewItemArr){isUndefinedOrNull(this.view.viewItemsToAdd)&&(this.view.viewItemsToAdd=[]),isUndefinedOrNull(this.view.viewItemsToRemove)&&(this.view.viewItemsToRemove=[]),this.viewItemsContainerDivId=OSH.Utils.randomUUID();var addViewItemId=OSH.Utils.randomUUID();OSH.Helper.HtmlHelper.addHTMLTitledLine(this.contentElt,"View items");var viewItemsDivElt=document.createElement("div");viewItemsDivElt.setAttribute("class","viewItem-section");var addViewItemButtonElt=document.createElement("button");addViewItemButtonElt.setAttribute("id",addViewItemId),addViewItemButtonElt.setAttribute("class","submit"),addViewItemButtonElt.innerHTML="Add";var viewItemsContainerElt=document.createElement("div");viewItemsContainerElt.setAttribute("id",this.viewItemsContainerDivId),viewItemsContainerElt.setAttribute("class","viewItem-container"),viewItemsDivElt.appendChild(addViewItemButtonElt),viewItemsDivElt.appendChild(viewItemsContainerElt),this.contentElt.appendChild(viewItemsDivElt);for(var i=0;i<defaultViewItemArr.length;i++)isUndefinedOrNull(defaultViewItemArr[i].entityId)||defaultViewItemArr[i].entityId!==this.entityId||this.addViewItem({viewItem:defaultViewItemArr[i]});var self=this;OSH.EventManager.observeDiv(addViewItemId,"click",function(event){self.addViewItem(event)})},addViewItem:function(event){var viewItemsContainerElt=document.getElementById(this.viewItemsContainerDivId),id=OSH.Utils.randomUUID(),stylerSelectDivId="styler-"+id,div=document.createElement("div");div.setAttribute("id","viewItem-"+id),div.setAttribute("class","ds-line");var deleteId="delete-"+id,editId="edit-"+id,viewItem=null,styler=null,stylerList=this.getStylerList(),selectedStylerName=stylerList[0];if(isUndefined(event.viewItem)){isUndefinedOrNull(this.nbViewItems)&&(this.nbViewItems=0);var stylerUI=null;isUndefinedOrNull(stylerList)||(stylerUI=OSH.UI.Styler.Factory.getNewInstanceFromType(stylerList[0])),viewItem={id:"view-item-"+OSH.Utils.randomUUID(),name:"View item #"+this.nbViewItems++,styler:stylerUI},isUndefinedOrNull(this.entityId)||(viewItem.entityId=this.entityId),this.view.viewItemsToAdd.push(viewItem)}else viewItem=event.viewItem,styler=viewItem.styler,selectedStylerName=OSH.UI.Styler.Factory.getTypeFromInstance(styler);var inputEltId=OSH.Utils.randomUUID(),strVar='<div class="line-left view-item-line">';strVar+='     <input id="'+inputEltId+'" name="'+viewItem.name+'" value="'+viewItem.name+'" type="input-text" class="input-text">',strVar+='     <div class="select-style">',strVar+='         <select id="'+stylerSelectDivId+'">';for(var i=0;i<stylerList.length;i++)strVar+=stylerList[i]===selectedStylerName?'             <option  selected value="'+stylerList[i]+'">'+stylerList[i]+"</option>":'             <option  value="'+stylerList[i]+'">'+stylerList[i]+"</option>";strVar+="         </select>",strVar+="     </div>",strVar+="  </div>",strVar+='   <table class="control line-right">',strVar+="      <tr>",strVar+='         <td><i class="fa fa-2x fa-pencil-square-o edit" aria-hidden="true" id="'+editId+'"></i></td>',strVar+='         <td><i class="fa fa-2x fa-trash-o delete" aria-hidden="true" id="'+deleteId+'"></i></td>',strVar+="      </tr>",strVar+="   </table>",strVar+="</div>",strVar+='<div style="clear: both;"></div>',div.innerHTML=strVar,OSH.Helper.HtmlHelper.onDomReady(function(){var inputElt=document.getElementById(inputEltId);inputElt.onfocus=function(e){OSH.Utils.fixSelectable(this,!0)},inputElt.onblur=function(e){OSH.Utils.fixSelectable(this,!1)}}),viewItemsContainerElt.appendChild(div);var self=this;OSH.EventManager.observeDiv(inputEltId,"change",function(event){viewItem.name=document.getElementById(inputEltId).value}),OSH.EventManager.observeDiv(deleteId,"click",function(event){viewItemsContainerElt.removeChild(div),self.view.viewItemsToRemove.push(viewItem)}),OSH.EventManager.observeDiv(editId,"click",this.editStyler.bind(this,viewItem)),OSH.EventManager.observeDiv(stylerSelectDivId,"change",function(event){self.getViewItemById(viewItem.id).styler=self.getNewStylerInstance(this.options[this.selectedIndex].value)})},editStyler:function(viewItem,event){var editStylerView=this.getStylerPanelInstance({datasources:this.options.datasources,styler:viewItem.styler}),editViewDialog=new OSH.UI.Panel.SaveDialogPanel("",{draggable:!0,css:"dialog-edit-view",title:"Edit Styler",show:!0,dockable:!1,closeable:!0,connectionIds:[],destroyOnClose:!0,modal:!0});editStylerView.attachToElement(editViewDialog.contentElt);var self=this;!function(viewItemId){editViewDialog.onSave=function(){var styler=editStylerView.getStyler();self.getViewItemById(viewItemId).styler=styler,editViewDialog.close()}}(viewItem.id)},getNewStylerInstance:function(name){},getTypeFromStylerInstance:function(stylerInstance){},getStylerList:function(){return[]},getStylerPanelInstance:function(properties){},getViewItemById:function(id){var result=null;for(var key in this.view.viewItems)if(this.view.viewItems[key].id===id){result=this.view.viewItems[key];break}if(null===result)for(var key in this.view.viewItemsToAdd)if(this.view.viewItemsToAdd[key].id===id){result=this.view.viewItemsToAdd[key];break}return result}});
OSH.UI.Panel.EntityMapEditPanel=OSH.UI.Panel.EntityViewItemsEditPanel.extend({getStylerList:function(){return[OSH.UI.Styler.Factory.TYPE.MARKER,OSH.UI.Styler.Factory.TYPE.POLYLINE]},getStylerPanelInstance:function(properties){return new OSH.UI.Panel.StylerMarkerPanel("",properties)}});
OSH.UI.Panel.EntityVideoEditPanel=OSH.UI.Panel.EntityViewItemsEditPanel.extend({buildViewProperties:function(){this._super(),this.keepRatioCheckboxId=OSH.Helper.HtmlHelper.addCheckbox(this.viewPropertiesElt,"Keep ratio",this.view.options.keepRatio),this.showFpsCheckboxId=OSH.Helper.HtmlHelper.addCheckbox(this.viewPropertiesElt,"Show fps",this.view.options.showFps)},getStylerList:function(){return[OSH.UI.Styler.Factory.TYPE.VIDEO]},getStylerPanelInstance:function(properties){return new OSH.UI.Panel.StylerVideoPanel("",properties)},getProperties:function(){var superProperties=this._super();return OSH.Utils.copyProperties({showFps:document.getElementById(this.showFpsCheckboxId).checked,keepRatio:document.getElementById(this.keepRatioCheckboxId).checked},superProperties,!0),superProperties}});
OSH.UI.Panel.EntityChartEditPanel=OSH.UI.Panel.EntityViewItemsEditPanel.extend({buildViewProperties:function(){this._super(),this.inputXLabelId=OSH.Helper.HtmlHelper.addInputText(this.viewPropertiesElt,"X label",null,"x label"),this.inputYLabelId=OSH.Helper.HtmlHelper.addInputText(this.viewPropertiesElt,"Y label",null,"y label"),this.inputMaxPoint=OSH.Helper.HtmlHelper.addInputText(this.viewPropertiesElt,"Max points",null,"maximum points displayed at the same time"),OSH.Helper.HtmlHelper.onDomReady(function(){document.getElementById(this.inputXLabelId).value=this.options.view.xLabel,document.getElementById(this.inputYLabelId).value=this.options.view.yLabel,document.getElementById(this.inputMaxPoint).value=this.options.view.maxPoints}.bind(this))},getStylerList:function(){return[OSH.UI.Styler.Factory.TYPE.LINE_PLOT]},getStylerPanelInstance:function(properties){return new OSH.UI.Panel.StylerLinePlotPanel("",properties)},getProperties:function(){var superProperties=this._super();return OSH.Utils.copyProperties({xLabel:document.getElementById(this.inputXLabelId).value,yLabel:document.getElementById(this.inputYLabelId).value,maxPoints:Number(document.getElementById(this.inputMaxPoint).value)},superProperties,!0),superProperties},getView:function(){return this.view}});
OSH.UI.Panel.EntityMJPEGVideoEditPanel=OSH.UI.Panel.EntityVideoEditPanel.extend({});
OSH.UI.Panel.StylerPanel=OSH.UI.Panel.extend({initialize:function(parentElementDivId,options){this.styler=options.styler,this._super(parentElementDivId,options)},getObservable:function(datasourceSelectId){var datasourceSelectTag=document.getElementById(datasourceSelectId),currentDS=this.options.datasources[datasourceSelectTag.selectedIndex],result=[];if(!isUndefinedOrNull(currentDS))for(var key in currentDS.resultTemplate)result.push({uiLabel:currentDS.resultTemplate[key].uiLabel});return result},loadObservable:function(datasourceSelectId,observableSelectId){var isNotEmpty=!0;OSH.Helper.HtmlHelper.removeAllFromSelect(observableSelectId);var datasourceSelectTag=document.getElementById(datasourceSelectId),observableSelectTag=document.getElementById(observableSelectId),currentDS=this.options.datasources[datasourceSelectTag.selectedIndex];if(!isUndefinedOrNull(currentDS))for(var key in currentDS.resultTemplate){var option=document.createElement("option");option.text=currentDS.resultTemplate[key].uiLabel,option.value=currentDS.resultTemplate[key].uiLabel,option.object=currentDS.resultTemplate[key].object,observableSelectTag.add(option),isNotEmpty=!1}return isNotEmpty},loadUom:function(observableSelectId,thresholdInputId){var observableSelectTag=document.getElementById(observableSelectId),observableOptionSelectedTag=observableSelectTag.options[observableSelectTag.selectedIndex];if(isUndefined(observableOptionSelectedTag)||isUndefined(observableOptionSelectedTag.object.uom))document.getElementById(thresholdInputId).nextElementSibling.innerHTML="";else{var uom=OSH.Utils.getUOM(observableOptionSelectedTag.object.uom);isUndefinedOrNull(uom)?document.getElementById(thresholdInputId).nextElementSibling.innerHTML="":document.getElementById(thresholdInputId).nextElementSibling.innerHTML=uom}},getProperties:function(){},loadData:function(data){},loadStyler:function(styler){}});
OSH.UI.Panel.StylerVideoPanel=OSH.UI.Panel.StylerPanel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){var tabPanel=new OSH.UI.Panel.TabPanel;this.videoPanel=new OSH.UI.Panel.VideoPanel("",this.options),tabPanel.addTab("Video",this.videoPanel.elementDiv),this.elementDiv.appendChild(tabPanel.elementDiv)},getStyler:function(){var videoPanelProperties=this.videoPanel.getProperties();return OSH.Asserts.checkObjectPropertyPath(videoPanelProperties,"properties","missing property 'properties"),this.options.styler.updateProperties(videoPanelProperties.properties),this.options.styler}});
OSH.UI.Panel.StylerPolylinePanel=OSH.UI.Panel.StylerPanel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){var tabPanel=new OSH.UI.Panel.TabPanel;this.locationPanel=new OSH.UI.Panel.LocationPanel("",this.options),tabPanel.addTab("Location",this.locationPanel.elementDiv),this.elementDiv.appendChild(tabPanel.elementDiv)},getStyler:function(){var uiProperties={},locationPanelProperties=this.locationPanel.getProperties();return OSH.Utils.copyProperties(locationPanelProperties.ui,uiProperties),this.options.styler.updateProperties(locationPanelProperties),OSH.Utils.copyProperties(uiProperties,this.options.styler.ui),this.options.styler}});
OSH.UI.Panel.StylerMarkerPanel=OSH.UI.Panel.StylerPanel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){var tabPanel=new OSH.UI.Panel.TabPanel;this.locationPanel=new OSH.UI.Panel.LocationPanel("",this.options),this.iconPanel=new OSH.UI.Panel.IconPanel("",this.options),tabPanel.addTab("Location",this.locationPanel.elementDiv),tabPanel.addTab("Icon",this.iconPanel.elementDiv),this.elementDiv.appendChild(tabPanel.elementDiv)},getStyler:function(){var locationPanelProperties=this.locationPanel.getProperties(),iconPanelProperties=this.iconPanel.getProperties();OSH.Asserts.checkObjectPropertyPath(locationPanelProperties,"properties","missing property 'properties"),OSH.Asserts.checkObjectPropertyPath(iconPanelProperties,"properties","missing property 'properties");var mergedProperties={};return OSH.Utils.copyProperties(locationPanelProperties,mergedProperties),OSH.Utils.copyProperties(iconPanelProperties,mergedProperties),OSH.Utils.copyProperties(iconPanelProperties.properties.ui,mergedProperties.properties.ui,!0),this.options.styler.updateProperties(mergedProperties.properties),this.options.styler}});
OSH.UI.Panel.StylerLinePlotPanel=OSH.UI.Panel.StylerPanel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){var tabPanel=new OSH.UI.Panel.TabPanel;this.valesPanel=new OSH.UI.Panel.XYPanel("",this.options),this.colorPanel=new OSH.UI.Panel.ColorPanel("",this.options),tabPanel.addTab("Values",this.valesPanel.elementDiv),tabPanel.addTab("Color",this.colorPanel.elementDiv),this.elementDiv.appendChild(tabPanel.elementDiv)},getStyler:function(){var valuesPanelProperties=this.valesPanel.getProperties(),colorPanelProperties=this.colorPanel.getProperties();OSH.Asserts.checkObjectPropertyPath(valuesPanelProperties,"properties","missing property 'properties"),OSH.Asserts.checkObjectPropertyPath(colorPanelProperties,"properties","missing property 'properties");var mergedProperties={};return OSH.Utils.copyProperties(valuesPanelProperties,mergedProperties),OSH.Utils.copyProperties(colorPanelProperties,mergedProperties),OSH.Utils.copyProperties(colorPanelProperties.properties.ui,mergedProperties.properties.ui,!0),this.options.styler.updateProperties(mergedProperties.properties),this.options.styler}});
OSH.UI.Panel.ColorPanel=OSH.UI.Panel.StylerPanel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){this.typeInputId=OSH.Helper.HtmlHelper.addHTMLListBox(this.elementDiv,"Color type",["None","Fixed","Threshold"]),this.content=document.createElement("div"),this.elementDiv.appendChild(this.content),this.properties={};var self=this;document.getElementById(this.typeInputId).addEventListener("change",function(){var currentValue=this.options[this.selectedIndex].value;switch(OSH.Helper.HtmlHelper.removeAllNodes(self.content),self.removeAllListerners(),self.removeProps(),currentValue){case"Threshold":self.addThreshold();break;case"Fixed":self.addFixed();break;case"None":self.addNone()}}),this.initDefaultValues()},initDefaultValues:function(){var typeInputElt=document.getElementById(this.typeInputId);OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.color")?OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.color.fixed")?(typeInputElt.options.selectedIndex=1,this.addFixed(this.styler.properties.ui.color.fixed)):OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.color.threshold")?(typeInputElt.options.selectedIndex=2,this.addThreshold(this.styler.properties.ui.color.threshold)):OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.color.map")?(typeInputElt.options.selectedIndex=3,this.addMap(this.styler.properties.ui.color.map)):OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.color.custom")&&(typeInputElt.options.selectedIndex=4,this.addCustom(this.styler.properties.ui.color.custom)):OSH.Utils.hasOwnNestedProperty(this.styler,"properties.colorFunc")&&(typeInputElt.options.selectedIndex=4,this.addCustom(this.styler.properties.colorFunc.handler.toSource()))},removeProps:function(){delete this.properties.fixed,delete this.properties.threshold},addNone:function(){this.properties={}},addFixed:function(defaultProperties){this.properties={fixed:{default:null,selected:null}},this.defaultColorInputId=OSH.Helper.HtmlHelper.addColorPicker(this.content,"Default color","#1f77b5","color"),this.selectedColorInputId=OSH.Helper.HtmlHelper.addColorPicker(this.content,"Selected color","#1f77b5","color"),OSH.Helper.HtmlHelper.onDomReady(function(){if(!isUndefinedOrNull(defaultProperties)){if(!isUndefinedOrNull(defaultProperties.default)){var defaultColorInputElt=document.getElementById(this.defaultColorInputId),defaultColorPickerElt=defaultColorInputElt.nextElementSibling;defaultColorPickerElt.value=defaultProperties.default,defaultColorPickerElt.select(),defaultColorInputElt.value=defaultProperties.default,defaultColorInputElt.innerHTML=defaultProperties.default,this.properties.fixed.default=defaultProperties.default}if(!isUndefinedOrNull(defaultProperties.selected)){var selectedColorInputElt=document.getElementById(this.selectedColorInputId),selectedColorPickerElt=document.getElementById(this.selectedColorInputId).nextElementSibling;selectedColorPickerElt.value=defaultProperties.selected,selectedColorPickerElt.select(),selectedColorInputElt.value=defaultProperties.selected,selectedColorInputElt.innerHTML=defaultProperties.selected,this.properties.fixed.selected=defaultProperties.selected}}}.bind(this))},addThreshold:function(defaultProperties){this.properties={threshold:{low:null,high:null,default:null,datasourceId:null,observableIdx:null}},OSH.Helper.HtmlHelper.addHTMLTitledLine(this.content,"Data source"),this.options.datasources.length>0&&(this.properties.threshold.datasourceIdx=0);var dsListBoxId=OSH.Helper.HtmlHelper.addHTMLObjectWithLabelListBox(this.content,"Data Source",this.options.datasources),observableListBoxId=OSH.Helper.HtmlHelper.addHTMLListBox(this.content,"Observable",[]);OSH.Helper.HtmlHelper.addHTMLTitledLine(this.content,"Default");var defaultColorInputId=OSH.Helper.HtmlHelper.addTitledFileChooser(this.content,"Default color",!0);OSH.Helper.HtmlHelper.addHTMLTitledLine(this.content,"Threshold");var lowColorInputId=OSH.Helper.HtmlHelper.addTitledFileChooser(this.content,"Low color",!0),highColorInputId=OSH.Helper.HtmlHelper.addTitledFileChooser(this.content,"High color",!0),thresholdInputId=OSH.Helper.HtmlHelper.addInputTextValueWithUOM(this.content,"Threshold value","12.0","");this.loadObservable(dsListBoxId,observableListBoxId,thresholdInputId)||(this.properties.threshold.observableIdx=0),this.loadUom(observableListBoxId,thresholdInputId);var self=this;self.addListener(document.getElementById(dsListBoxId),"change",function(){self.properties.threshold.datasourceIdx=this.selectedIndex,self.loadObservable(dsListBoxId,observableListBoxId)}),self.addListener(document.getElementById(observableListBoxId),"change",function(){self.properties.threshold.observableIdx=this.selectedIndex,self.loadUom(observableListBoxId,thresholdInputId)});var defaultColorInputElt=document.getElementById(defaultColorInputId);this.addListener(defaultColorInputElt,"change",this.inputFileHandlerAsBinaryString.bind(defaultColorInputElt,function(result){self.properties.threshold.default=result})),this.addListener(defaultColorInputElt.nextElementSibling,"paste",this.inputFilePasteHandler.bind(defaultColorInputElt.nextElementSibling,function(result){self.properties.threshold.default=result}));var lowColorInputElt=document.getElementById(lowColorInputId);this.addListener(lowColorInputElt,"change",this.inputFileHandlerAsBinaryString.bind(lowColorInputElt,function(result){self.properties.threshold.low=result})),this.addListener(lowColorInputElt.nextElementSibling,"paste",this.inputFilePasteHandler.bind(lowColorInputElt.nextElementSibling,function(result){self.properties.threshold.low=result}));var highColorInputElt=document.getElementById(highColorInputId);if(this.addListener(highColorInputElt,"change",this.inputFileHandlerAsBinaryString.bind(highColorInputElt,function(result){self.properties.threshold.high=result})),this.addListener(highColorInputElt.nextElementSibling,"paste",this.inputFilePasteHandler.bind(highColorInputElt.nextElementSibling,function(result){self.properties.threshold.high=result})),this.addListener(document.getElementById(thresholdInputId),"change",function(){self.properties.threshold.value=this.value}),!isUndefinedOrNull(defaultProperties)){this.setInputFileValue(defaultColorInputElt,defaultProperties.default),this.setInputFileValue(lowColorInputElt,defaultProperties.low),this.setInputFileValue(highColorInputElt,defaultProperties.high),document.getElementById(thresholdInputId).value=defaultProperties.value,this.properties.threshold.default=defaultProperties.default,this.properties.threshold.low=defaultProperties.low,this.properties.threshold.high=defaultProperties.high,this.properties.threshold.value=defaultProperties.value;for(var dsSelectTag=document.getElementById(dsListBoxId),i=0;i<dsSelectTag.options.length;i++){var currentOption=dsSelectTag.options[i];if(currentOption.object.id===defaultProperties.datasourceId){currentOption.setAttribute("selected",""),this.properties.threshold.datasourceIdx=i;break}}this.loadObservable(dsListBoxId,observableListBoxId,thresholdInputId);document.getElementById(observableListBoxId).options[defaultProperties.observableIdx].setAttribute("selected",""),this.properties.threshold.observableIdx=defaultProperties.observableIdx}},addCustom:function(textContent){this.properties={custom:{}};var defaultValue="";isUndefinedOrNull(textContent)||(defaultValue=textContent),this.textareaId=OSH.Utils.createJSEditor(this.content,defaultValue)},addMap:function(defaultProperties){},getProperties:function(){var stylerProperties={properties:{ui:{color:{}}}},dsIdsArray=[];for(var key in this.options.datasources)dsIdsArray.push(this.options.datasources[key].id);if(isUndefinedOrNull(this.properties.fixed))if(isUndefinedOrNull(this.properties.custom))if(isUndefinedOrNull(this.properties.threshold))delete stylerProperties.properties.color;else{stylerProperties.properties.ui.color.threshold={},OSH.Asserts.checkObjectPropertyPath(this.properties,"threshold"),OSH.Asserts.checkIsDefineOrNotNull(this.properties.threshold.observableIdx),OSH.Asserts.checkIsDefineOrNotNull(this.properties.threshold.datasourceIdx),OSH.Asserts.checkIsDefineOrNotNull(this.properties.threshold.default),OSH.Asserts.checkIsDefineOrNotNull(this.properties.threshold.low),OSH.Asserts.checkIsDefineOrNotNull(this.properties.threshold.high),OSH.Asserts.checkIsDefineOrNotNull(this.properties.threshold.value);var currentDatasource=this.options.datasources[this.properties.threshold.datasourceIdx],colorFuncProps=OSH.UI.Styler.Factory.getThresholdColor(currentDatasource,this.properties.threshold.observableIdx,this.properties.threshold.default,this.properties.threshold.low,this.properties.threshold.high,this.properties.threshold.value);OSH.Utils.copyProperties(colorFuncProps,stylerProperties.properties),stylerProperties.properties.color=colorFuncProps.color,stylerProperties.properties.ui.color.threshold.default=this.properties.threshold.default,stylerProperties.properties.ui.color.threshold.low=this.properties.threshold.low,stylerProperties.properties.ui.color.threshold.high=this.properties.threshold.high,stylerProperties.properties.ui.color.threshold.value=this.properties.threshold.value,stylerProperties.properties.ui.color.threshold.observableIdx=this.properties.threshold.observableIdx,stylerProperties.properties.ui.color.threshold.datasourceId=currentDatasource.id}else{OSH.Asserts.checkObjectPropertyPath(this.properties,"custom"),stylerProperties.properties.ui.color.custom={};var textContent=document.getElementById(this.textareaId).value,colorFuncProps=OSH.UI.Styler.Factory.getCustomColorFunc(dsIdsArray,textContent);OSH.Utils.copyProperties(colorFuncProps,stylerProperties.properties),stylerProperties.properties.ui.color.custom=textContent}else{OSH.Asserts.checkObjectPropertyPath(this.properties,"fixed"),stylerProperties.properties.ui.color.fixed={},OSH.Asserts.checkObjectPropertyPath(this.properties,"fixed.default");var defaultColor=document.getElementById(this.defaultColorInputId).value,defaultColorProps=OSH.UI.Styler.Factory.getFixedColor(dsIdsArray,defaultColor);if(OSH.Utils.copyProperties(defaultColorProps,stylerProperties.properties),stylerProperties.properties.color=defaultColorProps.color,stylerProperties.properties.ui.color.fixed.default=defaultColor,OSH.Utils.hasOwnNestedProperty(this.properties,"fixed.selected")){OSH.Asserts.checkObjectPropertyPath(this.properties,"fixed.selected");var selectedColor=document.getElementById(this.selectedColorInputId).value;if(!isUndefinedOrNull(selectedColor)){var selectedColorProps=OSH.UI.Styler.Factory.getSelectedColorFunc(dsIdsArray,defaultColor,selectedColor);OSH.Utils.copyProperties(selectedColorProps,stylerProperties.properties),stylerProperties.properties.color=selectedColorProps.color,stylerProperties.properties.ui.color.fixed.selected=selectedColor}}}return stylerProperties}});
OSH.UI.Panel.IconPanel=OSH.UI.Panel.StylerPanel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){this.typeInputId=OSH.Helper.HtmlHelper.addHTMLListBox(this.elementDiv,"Icon type",["None","Fixed","Threshold","Map","Custom"]),this.content=document.createElement("div"),this.elementDiv.appendChild(this.content),this.properties={};var self=this;document.getElementById(this.typeInputId).addEventListener("change",function(){var currentValue=this.options[this.selectedIndex].value;switch(OSH.Helper.HtmlHelper.removeAllNodes(self.content),self.removeAllListerners(),self.removeProps(),currentValue){case"Threshold":self.addThreshold();break;case"Fixed":self.addFixed();break;case"Custom":self.addCustom();break;case"None":self.addNone()}}),this.initDefaultValues()},initDefaultValues:function(){var typeInputElt=document.getElementById(this.typeInputId);OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.icon")?OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.icon.fixed")?(typeInputElt.options.selectedIndex=1,this.addFixed(this.styler.properties.ui.icon.fixed)):OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.icon.threshold")?(typeInputElt.options.selectedIndex=2,this.addThreshold(this.styler.properties.ui.icon.threshold)):OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.icon.map")?(typeInputElt.options.selectedIndex=3,this.addMap(this.styler.properties.ui.icon.map)):OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.icon.custom")&&(typeInputElt.options.selectedIndex=4,this.addCustom(this.styler.properties.ui.icon.custom)):OSH.Utils.hasOwnNestedProperty(this.styler,"properties.iconFunc")&&(typeInputElt.options.selectedIndex=4,this.addCustom(this.styler.properties.iconFunc.handler.toSource()))},removeProps:function(){delete this.properties.fixed,delete this.properties.threshold},addNone:function(){this.properties={}},addFixed:function(defaultProperties){this.properties={fixed:{default:null,selected:null}},this.defaultIconInputId=OSH.Helper.HtmlHelper.addTitledFileChooser(this.content,"Default icon",!0);var defaultIconInputElt=document.getElementById(this.defaultIconInputId),selectedIconInputId=OSH.Helper.HtmlHelper.addTitledFileChooser(this.content,"Selected icon",!0),selectedIconInputElt=document.getElementById(selectedIconInputId),self=this;this.addListener(defaultIconInputElt,"change",this.inputFileHandlerAsBinaryString.bind(defaultIconInputElt,function(result){self.properties.fixed.default=result})),this.addListener(defaultIconInputElt.nextElementSibling,"paste",this.inputFilePasteHandler.bind(defaultIconInputElt.nextElementSibling,function(result){self.properties.fixed.default=result})),this.addListener(selectedIconInputElt,"change",this.inputFileHandlerAsBinaryString.bind(selectedIconInputElt,function(result){self.properties.fixed.selected=result})),this.addListener(selectedIconInputElt.nextElementSibling,"paste",this.inputFilePasteHandler.bind(selectedIconInputElt.nextElementSibling,function(result){self.properties.fixed.selected=result})),isUndefinedOrNull(defaultProperties)||(this.setInputFileValue(defaultIconInputElt,defaultProperties.default),this.setInputFileValue(selectedIconInputElt,defaultProperties.selected),this.properties.fixed.default=defaultProperties.default,this.properties.fixed.selected=defaultProperties.selected)},addThreshold:function(defaultProperties){this.properties={threshold:{low:null,high:null,default:null,datasourceIdx:null,observableIdx:null}},OSH.Helper.HtmlHelper.addHTMLTitledLine(this.content,"Data source"),this.options.datasources.length>0&&(this.properties.threshold.datasourceIdx=0);var dsListBoxId=OSH.Helper.HtmlHelper.addHTMLObjectWithLabelListBox(this.content,"Data Source",this.options.datasources),observableListBoxId=OSH.Helper.HtmlHelper.addHTMLListBox(this.content,"Observable",[]);OSH.Helper.HtmlHelper.addHTMLTitledLine(this.content,"Default");var defaultIconInputId=OSH.Helper.HtmlHelper.addTitledFileChooser(this.content,"Default icon",!0);OSH.Helper.HtmlHelper.addHTMLTitledLine(this.content,"Threshold");var lowIconInputId=OSH.Helper.HtmlHelper.addTitledFileChooser(this.content,"Low icon",!0),highIconInputId=OSH.Helper.HtmlHelper.addTitledFileChooser(this.content,"High icon",!0),thresholdInputId=OSH.Helper.HtmlHelper.addInputTextValueWithUOM(this.content,"Threshold value","12.0","");this.loadObservable(dsListBoxId,observableListBoxId,thresholdInputId)||(this.properties.threshold.observableIdx=0),this.loadUom(observableListBoxId,thresholdInputId);var self=this;self.addListener(document.getElementById(dsListBoxId),"change",function(){self.properties.threshold.datasourceIdx=this.selectedIndex,self.loadObservable(dsListBoxId,observableListBoxId)}),self.addListener(document.getElementById(observableListBoxId),"change",function(){self.properties.threshold.observableIdx=this.selectedIndex,self.loadUom(observableListBoxId,thresholdInputId)});var defaultIconInputElt=document.getElementById(defaultIconInputId);this.addListener(defaultIconInputElt,"change",this.inputFileHandlerAsBinaryString.bind(defaultIconInputElt,function(result){self.properties.threshold.default=result})),this.addListener(defaultIconInputElt.nextElementSibling,"paste",this.inputFilePasteHandler.bind(defaultIconInputElt.nextElementSibling,function(result){self.properties.threshold.default=result}));var lowIconInputElt=document.getElementById(lowIconInputId);this.addListener(lowIconInputElt,"change",this.inputFileHandlerAsBinaryString.bind(lowIconInputElt,function(result){self.properties.threshold.low=result})),this.addListener(lowIconInputElt.nextElementSibling,"paste",this.inputFilePasteHandler.bind(lowIconInputElt.nextElementSibling,function(result){self.properties.threshold.low=result}));var highIconInputElt=document.getElementById(highIconInputId);if(this.addListener(highIconInputElt,"change",this.inputFileHandlerAsBinaryString.bind(highIconInputElt,function(result){self.properties.threshold.high=result})),this.addListener(highIconInputElt.nextElementSibling,"paste",this.inputFilePasteHandler.bind(highIconInputElt.nextElementSibling,function(result){self.properties.threshold.high=result})),this.addListener(document.getElementById(thresholdInputId),"change",function(){self.properties.threshold.value=this.value}),!isUndefinedOrNull(defaultProperties)){this.setInputFileValue(defaultIconInputElt,defaultProperties.default),this.setInputFileValue(lowIconInputElt,defaultProperties.low),this.setInputFileValue(highIconInputElt,defaultProperties.high),document.getElementById(thresholdInputId).value=defaultProperties.value,this.properties.threshold.default=defaultProperties.default,this.properties.threshold.low=defaultProperties.low,this.properties.threshold.high=defaultProperties.high,this.properties.threshold.value=defaultProperties.value;for(var dsSelectTag=document.getElementById(dsListBoxId),i=0;i<dsSelectTag.options.length;i++){var currentOption=dsSelectTag.options[i];if(currentOption.object.id===defaultProperties.datasourceId){currentOption.setAttribute("selected",""),this.properties.threshold.datasourceIdx=i;break}}this.loadObservable(dsListBoxId,observableListBoxId,thresholdInputId);document.getElementById(observableListBoxId).options[defaultProperties.observableIdx].setAttribute("selected",""),this.properties.threshold.observableIdx=defaultProperties.observableIdx}},addCustom:function(textContent){this.properties={custom:{}};var defaultValue="";isUndefinedOrNull(textContent)||(defaultValue=textContent),this.textareaId=OSH.Utils.createJSEditor(this.content,defaultValue)},addMap:function(defaultProperties){},getProperties:function(){var stylerProperties={properties:{ui:{icon:{}}}},dsIdsArray=[];for(var key in this.options.datasources)dsIdsArray.push(this.options.datasources[key].id);if(isUndefinedOrNull(this.properties.fixed))if(isUndefinedOrNull(this.properties.custom))if(isUndefinedOrNull(this.properties.threshold))delete stylerProperties.properties.icon;else{stylerProperties.properties.ui.icon.threshold={},OSH.Asserts.checkObjectPropertyPath(this.properties,"threshold"),OSH.Asserts.checkIsDefineOrNotNull(this.properties.threshold.observableIdx),OSH.Asserts.checkIsDefineOrNotNull(this.properties.threshold.datasourceIdx),OSH.Asserts.checkIsDefineOrNotNull(this.properties.threshold.default),OSH.Asserts.checkIsDefineOrNotNull(this.properties.threshold.low),OSH.Asserts.checkIsDefineOrNotNull(this.properties.threshold.high),OSH.Asserts.checkIsDefineOrNotNull(this.properties.threshold.value);var currentDatasource=this.options.datasources[this.properties.threshold.datasourceIdx],iconFuncProps=OSH.UI.Styler.Factory.getThresholdIcon(currentDatasource,this.properties.threshold.observableIdx,this.properties.threshold.default.url,this.properties.threshold.low.url,this.properties.threshold.high.url,this.properties.threshold.value);OSH.Utils.copyProperties(iconFuncProps,stylerProperties.properties),stylerProperties.properties.icon=iconFuncProps.icon,stylerProperties.properties.ui.icon.threshold.default=this.properties.threshold.default,stylerProperties.properties.ui.icon.threshold.low=this.properties.threshold.low,stylerProperties.properties.ui.icon.threshold.high=this.properties.threshold.high,stylerProperties.properties.ui.icon.threshold.value=this.properties.threshold.value,stylerProperties.properties.ui.icon.threshold.observableIdx=this.properties.threshold.observableIdx,stylerProperties.properties.ui.icon.threshold.datasourceId=currentDatasource.id}else{OSH.Asserts.checkObjectPropertyPath(this.properties,"custom"),stylerProperties.properties.ui.icon.custom={};var textContent=document.getElementById(this.textareaId).value,iconFuncProps=OSH.UI.Styler.Factory.getCustomIconFunc(dsIdsArray,textContent);OSH.Utils.copyProperties(iconFuncProps,stylerProperties.properties),stylerProperties.properties.ui.icon.custom=textContent}else{OSH.Asserts.checkObjectPropertyPath(this.properties,"fixed"),stylerProperties.properties.ui.icon.fixed={},OSH.Asserts.checkObjectPropertyPath(this.properties,"fixed.default.url");var defaultIconProps=OSH.UI.Styler.Factory.getFixedIcon(dsIdsArray,this.properties.fixed.default.url);if(OSH.Utils.copyProperties(defaultIconProps,stylerProperties.properties),stylerProperties.properties.icon=defaultIconProps.icon,stylerProperties.properties.ui.icon.fixed.default=this.properties.fixed.default,OSH.Utils.hasOwnNestedProperty(this.properties,"fixed.selected")&&(OSH.Asserts.checkObjectPropertyPath(this.properties,"fixed.selected"),!isUndefinedOrNull(this.properties.fixed.selected))){var selectedIconProps=OSH.UI.Styler.Factory.getSelectedIconFunc(dsIdsArray,this.properties.fixed.default.url,this.properties.fixed.selected.url);OSH.Utils.copyProperties(selectedIconProps,stylerProperties.properties),stylerProperties.properties.icon=selectedIconProps.icon,stylerProperties.properties.ui.icon.fixed.selected=this.properties.fixed.selected}}return stylerProperties}});
OSH.UI.Panel.LocationPanel=OSH.UI.Panel.StylerPanel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){this.contentElt=document.createElement("div"),this.elementDiv.appendChild(this.contentElt),OSH.Helper.HtmlHelper.addHTMLTitledLine(this.contentElt,"Default location");var xDefaultValue="",yDefaultValue="",zDefaultValue="";OSH.Utils.hasOwnNestedProperty(this.styler,"location")&&(xDefaultValue=this.styler.location.x,yDefaultValue=this.styler.location.y,zDefaultValue=this.styler.location.z),this.xDefaultInputId=OSH.Helper.HtmlHelper.addInputText(this.contentElt,"X",xDefaultValue,"0.0"),this.yDefaultInputId=OSH.Helper.HtmlHelper.addInputText(this.contentElt,"Y",yDefaultValue,"0.0"),this.zDefaultInputId=OSH.Helper.HtmlHelper.addInputText(this.contentElt,"Z",zDefaultValue,"0.0"),OSH.Helper.HtmlHelper.addHTMLTitledLine(this.contentElt,"Mapping"),OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.location.locationFuncMapping")||!OSH.Utils.hasOwnNestedProperty(this.styler,"properties.locationFunc")?this.initMappingFunctionUI():this.initCustomFunctionUI()},initMappingFunctionUI:function(){var dsName=[];if(!isUndefinedOrNull(this.options.datasources))for(var i=0;i<this.options.datasources.length;i++)dsName.push(this.options.datasources[i].name);this.dsListBoxId=OSH.Helper.HtmlHelper.addHTMLListBox(this.contentElt,"Data Source",dsName),this.xInputMappingId=OSH.Helper.HtmlHelper.addHTMLListBox(this.contentElt,"X",[]),this.yInputMappingId=OSH.Helper.HtmlHelper.addHTMLListBox(this.contentElt,"Y",[]),this.zInputMappingId=OSH.Helper.HtmlHelper.addHTMLListBox(this.contentElt,"Z",[]);var self=this;if(!isUndefinedOrNull(this.options.datasources)&&this.options.datasources.length>0)if(OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.location.locationFuncMapping")){for(var datasourceIdx=-1,i=0;i<this.options.datasources.length;i++)if(this.options.datasources[i].id===this.styler.properties.ui.location.locationFuncMapping.datasourceId){datasourceIdx=i;break}datasourceIdx>-1&&(document.getElementById(this.dsListBoxId).options.selectedIndex=datasourceIdx,this.loadDatasources(),document.getElementById(this.xInputMappingId).options.selectedIndex=this.styler.properties.ui.location.locationFuncMapping.xIdx,document.getElementById(this.yInputMappingId).options.selectedIndex=this.styler.properties.ui.location.locationFuncMapping.yIdx,document.getElementById(this.zInputMappingId).options.selectedIndex=this.styler.properties.ui.location.locationFuncMapping.zIdx)}else this.loadDatasources();this.addListener(document.getElementById(this.dsListBoxId),"change",function(){var observables=self.getObservable(self.dsListBoxId);self.loadMapLocation(observables,self.xInputMappingId,self.yInputMappingId,self.zInputMappingId)})},loadDatasources:function(){var observables=this.getObservable(this.dsListBoxId);this.loadMapLocation(observables,this.xInputMappingId,this.yInputMappingId,this.zInputMappingId)},loadMapLocation:function(observableArr,xInputMappingId,yInputMappingId,zInputMappingId){var xInputTag=document.getElementById(xInputMappingId),yInputTag=document.getElementById(yInputMappingId),zInputTag=document.getElementById(zInputMappingId);if(OSH.Helper.HtmlHelper.removeAllFromSelect(xInputMappingId),OSH.Helper.HtmlHelper.removeAllFromSelect(yInputMappingId),OSH.Helper.HtmlHelper.removeAllFromSelect(zInputMappingId),!isUndefinedOrNull(observableArr))for(var i=0;i<observableArr.length;i++){var option=document.createElement("option");option.text=observableArr[i].uiLabel,option.value=observableArr[i].uiLabel,xInputTag.add(option),option=document.createElement("option"),option.text=observableArr[i].uiLabel,option.value=observableArr[i].uiLabel,yInputTag.add(option),option=document.createElement("option"),option.text=observableArr[i].uiLabel,option.value=observableArr[i].uiLabel,zInputTag.add(option)}},initCustomFunctionUI:function(){this.textareaId=OSH.Utils.createJSEditor(this.contentElt,this.styler.properties.locationFunc.handler.toSource())},getProperties:function(){var locationFuncProps,defaultLocationProps,stylerProperties={properties:{ui:{location:{}}}};if(defaultLocationProps=OSH.UI.Styler.Factory.getLocation(Number(document.getElementById(this.xDefaultInputId).value),Number(document.getElementById(this.yDefaultInputId).value),Number(document.getElementById(this.zDefaultInputId).value)),isUndefinedOrNull(this.textareaId)){var xIdx=0,yIdx=0,zIdx=0;!isUndefinedOrNull(this.options.datasources)&&this.options.datasources.length>0&&(xIdx=document.getElementById(this.xInputMappingId).selectedIndex,yIdx=document.getElementById(this.yInputMappingId).selectedIndex,zIdx=document.getElementById(this.zInputMappingId).selectedIndex,locationFuncProps=OSH.UI.Styler.Factory.getLocationFunc(this.options.datasources[document.getElementById(this.dsListBoxId).selectedIndex],xIdx,yIdx,zIdx),stylerProperties.properties.ui.location.locationFuncMapping={datasourceId:this.options.datasources[document.getElementById(this.dsListBoxId).selectedIndex].id,xIdx:xIdx,yIdx:yIdx,zIdx:zIdx})}else{var textContent=document.getElementById(this.textareaId).value;locationFuncProps=OSH.UI.Styler.Factory.getCustomLocationFunc(this.styler,document.getElementById(this.textareaId).value),stylerProperties.properties.ui.location.custom=textContent}return OSH.Utils.copyProperties(defaultLocationProps,stylerProperties.properties),isUndefinedOrNull(locationFuncProps)||OSH.Utils.copyProperties(locationFuncProps,stylerProperties.properties),stylerProperties}});
OSH.UI.Panel.VideoPanel=OSH.UI.Panel.StylerPanel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){this.contentElt=document.createElement("div"),this.elementDiv.appendChild(this.contentElt),OSH.Helper.HtmlHelper.addHTMLTitledLine(this.contentElt,"Mapping");var hasUIProps=OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.video");!hasUIProps&&OSH.Utils.hasOwnNestedProperty(this.styler,"properties.frameFunc")||(hasUIProps?this.initMappingFunctionUI(this.styler.properties.ui.video):this.initMappingFunctionUI())},initMappingFunctionUI:function(properties){this.properties={frame:{datasourceIdx:null,observableIdx:null}};var dsName=[];if(!isUndefinedOrNull(this.options.datasources))for(var i=0;i<this.options.datasources.length;i++)dsName.push(this.options.datasources[i].name);this.options.datasources.length>0&&(this.properties.frame.datasourceIdx=0),this.dsListBoxId=OSH.Helper.HtmlHelper.addHTMLObjectWithLabelListBox(this.contentElt,"Data Source",this.options.datasources),this.observableListBoxId=OSH.Helper.HtmlHelper.addHTMLListBox(this.contentElt,"Observable",[]),this.loadObservable(this.dsListBoxId,this.observableListBoxId)||(this.properties.frame.observableIdx=0);var self=this;isUndefinedOrNull(properties)||OSH.Helper.HtmlHelper.onDomReady(function(){for(var dsTag=document.getElementById(self.dsListBoxId),idx=-1,i=0;i<dsTag.options.length;i++)if(dsTag.options[i].object.id===properties.datasourceId){idx=i;break}idx>-1&&(dsTag.options.selectedIndex=idx,document.getElementById(self.observableListBoxId).options.selectedIndex=properties.observableIdx)})},getProperties:function(){var stylerProperties={properties:{ui:{video:{}}}},dsIdsArray=[];for(var key in this.options.datasources)dsIdsArray.push(this.options.datasources[key].id);stylerProperties.properties.ui.video={},OSH.Asserts.checkObjectPropertyPath(this.properties,"frame"),OSH.Asserts.checkIsDefineOrNotNull(this.properties.frame.observableIdx),OSH.Asserts.checkIsDefineOrNotNull(this.properties.frame.datasourceIdx);var dsSelectedIdx=document.getElementById(this.dsListBoxId).options.selectedIndex,currentDatasource=this.options.datasources[dsSelectedIdx],observableIdx=document.getElementById(this.observableListBoxId).options.selectedIndex,videoFuncProps=OSH.UI.Styler.Factory.getVideoFunc(currentDatasource,observableIdx);return OSH.Utils.copyProperties(videoFuncProps,stylerProperties.properties),stylerProperties.properties.ui.video.observableIdx=observableIdx,stylerProperties.properties.ui.video.datasourceId=currentDatasource.id,stylerProperties}});
OSH.UI.Panel.XYPanel=OSH.UI.Panel.StylerPanel.extend({initialize:function(parentElementDivId,options){this._super(parentElementDivId,options)},initPanel:function(){this.contentElt=document.createElement("div"),this.elementDiv.appendChild(this.contentElt),OSH.Helper.HtmlHelper.addHTMLTitledLine(this.contentElt,"Default values");var xDefaultValue="",yDefaultValue="";OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.values.default")&&(xDefaultValue=this.styler.properties.ui.values.default.x,yDefaultValue=this.styler.properties.ui.values.default.y),this.xDefaultInputId=OSH.Helper.HtmlHelper.addInputText(this.contentElt,"X",xDefaultValue,"0.0"),this.yDefaultInputId=OSH.Helper.HtmlHelper.addInputText(this.contentElt,"Y",yDefaultValue,"0.0"),OSH.Helper.HtmlHelper.addHTMLTitledLine(this.contentElt,"Mapping"),OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.values.valuesFuncMapping")||!OSH.Utils.hasOwnNestedProperty(this.styler,"properties.valuesFunc")?this.initMappingFunctionUI():this.initCustomFunctionUI()},initMappingFunctionUI:function(){var dsName=[];if(!isUndefinedOrNull(this.options.datasources))for(var i=0;i<this.options.datasources.length;i++)dsName.push(this.options.datasources[i].name);this.dsListBoxId=OSH.Helper.HtmlHelper.addHTMLListBox(this.contentElt,"Data Source",dsName),this.xInputMappingId=OSH.Helper.HtmlHelper.addHTMLListBox(this.contentElt,"X",[]),this.yInputMappingId=OSH.Helper.HtmlHelper.addHTMLListBox(this.contentElt,"Y",[]);var self=this;if(!isUndefinedOrNull(this.options.datasources)&&this.options.datasources.length>0)if(OSH.Utils.hasOwnNestedProperty(this.styler,"properties.ui.values.valuesFuncMapping")){for(var datasourceIdx=-1,i=0;i<this.options.datasources.length;i++)if(this.options.datasources[i].id===this.styler.properties.ui.values.valuesFuncMapping.datasourceId){datasourceIdx=i;break}datasourceIdx>-1&&(document.getElementById(this.dsListBoxId).options.selectedIndex=datasourceIdx,this.loadDatasources(),document.getElementById(this.xInputMappingId).options.selectedIndex=this.styler.properties.ui.values.valuesFuncMapping.xIdx,document.getElementById(this.yInputMappingId).options.selectedIndex=this.styler.properties.ui.values.valuesFuncMapping.yIdx)}else this.loadDatasources();this.addListener(document.getElementById(this.dsListBoxId),"change",function(){var observables=self.getObservable(self.dsListBoxId);self.loadMapValues(observables,self.xInputMappingId,self.yInputMappingId)})},loadDatasources:function(){var observables=this.getObservable(this.dsListBoxId);this.loadMapValues(observables,this.xInputMappingId,this.yInputMappingId)},loadMapValues:function(observableArr,xInputMappingId,yInputMappingId){var xInputTag=document.getElementById(xInputMappingId),yInputTag=document.getElementById(yInputMappingId);if(OSH.Helper.HtmlHelper.removeAllFromSelect(xInputMappingId),OSH.Helper.HtmlHelper.removeAllFromSelect(yInputMappingId),!isUndefinedOrNull(observableArr))for(var i=0;i<observableArr.length;i++){var option=document.createElement("option");option.text=observableArr[i].uiLabel,option.value=observableArr[i].uiLabel,xInputTag.add(option),option=document.createElement("option"),option.text=observableArr[i].uiLabel,option.value=observableArr[i].uiLabel,yInputTag.add(option)}},initCustomFunctionUI:function(){this.textareaId=OSH.Utils.createJSEditor(this.contentElt,this.styler.properties.valuesFunc.handler.toSource())},getProperties:function(){var valuesFuncProps,fixedValuesProps,stylerProperties={properties:{ui:{values:{}}},values:{}};if(fixedValuesProps=OSH.UI.Styler.Factory.getValues(Number(document.getElementById(this.xDefaultInputId).value),Number(document.getElementById(this.yDefaultInputId).value)),stylerProperties.properties.ui.values.default={x:Number(document.getElementById(this.xDefaultInputId).value),y:Number(document.getElementById(this.yDefaultInputId).value)},isUndefinedOrNull(this.textareaId)){var xIdx=0,yIdx=0;!isUndefinedOrNull(this.options.datasources)&&this.options.datasources.length>0&&(xIdx=document.getElementById(this.xInputMappingId).selectedIndex,yIdx=document.getElementById(this.yInputMappingId).selectedIndex,valuesFuncProps=OSH.UI.Styler.Factory.getValuesFunc(this.options.datasources[document.getElementById(this.dsListBoxId).selectedIndex],xIdx,yIdx),stylerProperties.properties.ui.values.valuesFuncMapping={datasourceId:this.options.datasources[document.getElementById(this.dsListBoxId).selectedIndex].id,xIdx:xIdx,yIdx:yIdx})}else{var textContent=document.getElementById(this.textareaId).value;valuesFuncProps=OSH.UI.Styler.Factory.getCustomValuesFunc(this.styler,document.getElementById(this.textareaId).value),stylerProperties.properties.ui.values.custom=textContent}return OSH.Utils.copyProperties(fixedValuesProps,stylerProperties),isUndefinedOrNull(valuesFuncProps)||OSH.Utils.copyProperties(valuesFuncProps,stylerProperties.properties),stylerProperties}});
OSH.Log=BaseClass.extend({initialize:function(){this.logDiv=document.createElement("TEXTAREA"),this.logDiv.setAttribute("class","osh-log popup-content"),this.logDiv.setAttribute("wrap","off"),this.first=!0,document.observe("dom:loaded",function(){new OSH.UI.DialogPanel({title:"Logging console"})}.bind(this)),document.observe("osh:log",function(event){this.first?(this.logDiv.value="[osh-log]> "+event.memo+"\n",this.first=!1):this.logDiv.value+="[osh-log]> "+event.memo+"\n"}.bind(this))}});
OSH.UI.View=OSH.UI.Panel.extend({initialize:function(parentElementDivId,viewItems,options){this._super(parentElementDivId,options),this.stylers=[],this.contextMenus=[],this.viewItems=[],this.names={},this.stylerToObj={},this.stylerIdToStyler={},this.lastRec={},this.stylerIdToDatasources={},this.id="view-"+OSH.Utils.randomUUID(),this.name=this.id,this.type=this.getType(),void 0!==options&&void 0!==options.cssSelected&&(this.cssSelected=options.cssSelected),this.init(parentElementDivId,viewItems,options)},init:function(parentElementDivId,viewItems,options){isUndefinedOrNull(options)?this.options={}:(this.options=options,isUndefinedOrNull(options.entityId)||(this.entityId=options.entityId),isUndefinedOrNull(options.name)||(this.name=options.name)),this.css="view",this.cssSelected="",isUndefinedOrNull(options)||(isUndefinedOrNull(options.css)||(this.css+=" "+options.css),isUndefinedOrNull(options.cssSelected)||(this.cssSelected=options.cssSelected)),OSH.Utils.addCss(this.elementDiv,this.css);var div=document.getElementById(parentElementDivId);if(void 0===div||null===div?(document.body.appendChild(this.elementDiv),this.hide(),this.container=document.body):(div.appendChild(this.elementDiv),this.container=div),this.beforeAddingItems(options),void 0!==viewItems)for(var i=0;i<viewItems.length;i++)this.addViewItem(viewItems[i]);void 0!==options&&void 0!==options.show&&(document.getElementById(this.divId).style.display=options.show?"block":"none"),this.handleEvents();var self=this;new MutationObserver(function(mutations){mutations.forEach(function(mutation){"style"===mutation.attributeName&&self.onResize()})}).observe(this.elementDiv,{attributes:!0}),this.updateKeepRatio()},updateKeepRatio:function(){var contains=OSH.Utils.containsCss(this.elementDiv,"keep-ratio-w");this.options.keepRatio&&!contains?OSH.Utils.addCss(this.elementDiv,"keep-ratio-w"):!this.options.keepRatio&&contains&&OSH.Utils.removeCss(this.elementDiv,"keep-ratio-w")},hide:function(){this.elementDiv.style.display="none"},beforeAddingItems:function(options){},getId:function(){return this.id},getDivId:function(){return this.divId},setData:function(dataSourceId,data){},addViewItem:function(viewItem){if(OSH.Asserts.checkIsDefineOrNotNull(viewItem),this.viewItems.push(viewItem),viewItem.hasOwnProperty("styler")){var styler=viewItem.styler;this.stylers.push(styler),viewItem.hasOwnProperty("name")&&(this.names[styler.getId()]=viewItem.name),styler.init(this),styler.viewItem=viewItem,this.stylerIdToStyler[styler.id]=styler,this.observeDatasourceStyler(viewItem,styler)}viewItem.hasOwnProperty("contextmenu")&&this.contextMenus.push(viewItem.contextmenu)},observeDatasourceStyler:function(viewItem){OSH.Asserts.checkIsDefineOrNotNull(viewItem),OSH.Asserts.checkIsDefineOrNotNull(viewItem.styler);var styler=viewItem.styler,ds=styler.getDataSourcesIds();styler.id in this.stylerIdToDatasources||(this.stylerIdToDatasources[styler.id]=[]);for(var i=0;i<ds.length;i++){var dataSourceId=ds[i];this.stylerIdToDatasources[styler.id].indexOf(dataSourceId)===-1&&(this.stylerIdToDatasources[styler.id].push(dataSourceId),this.observeViewItemData(dataSourceId,viewItem),this.observeViewItemSelectedData(dataSourceId,viewItem))}},observeViewItemData:function(dataSourceId,viewItem){var view=this;OSH.EventManager.observe(OSH.EventManager.EVENT.DATA+"-"+dataSourceId,function(event){event.reset||(viewItem.styler.setData(dataSourceId,event.data,view,{selected:viewItem.styler.selected}),view.lastRec[dataSourceId]=event.data)})},observeViewItemSelectedData:function(datasourceBindId,viewItem,event){var view=this;OSH.EventManager.observe(OSH.EventManager.EVENT.SELECT_VIEW,function(event){var selected=!1;if(isUndefinedOrNull(event.entityId)){var stylerDsIds=[];for(var i in viewItem.styler.dataSourceToStylerMap)stylerDsIds.push(i);for(var i=0;i<stylerDsIds.length;i++)if(event.dataSourcesIds.indexOf(stylerDsIds[i])>-1){selected=!0;break}}else selected=viewItem.entityId===event.entityId;viewItem.styler.selected=selected,datasourceBindId in view.lastRec&&viewItem.styler.setData(datasourceBindId,view.lastRec[datasourceBindId],view,{selected:selected})})},removeViewItem:function(viewItem){OSH.Asserts.checkIsDefineOrNotNull(viewItem);for(var idx=-1,i=0;i<this.viewItems.length;i++)if(this.viewItems[i].id===viewItem.id){idx=i;break}if(idx>-1){if(!isUndefinedOrNull(viewItem.styler)){for(var viewItemToRemove=this.viewItems[idx],idxStyler=-1,i=0;i<this.stylers.length;i++)if(this.stylers[i].id===viewItemToRemove.styler.id){idxStyler=i;break}idxStyler>-1&&(viewItem.styler.remove(this),this.stylers.splice(idxStyler,1),delete this.stylerIdToStyler[viewItemToRemove.styler.id])}this.viewItems.splice(idx,1)}},updateViewItem:function(viewItem){OSH.Asserts.checkIsDefineOrNotNull(viewItem);for(var i=0;i<this.viewItems.length;i++)if(this.viewItems[i].id===viewItem.id){isUndefinedOrNull(this.viewItems[i].styler)||(this.viewItems[i].styler.update(this),this.removeOldViewItemsDatasource(this.viewItems[i]),this.observeDatasourceStyler(this.viewItems[i]));break}},removeOldViewItemsDatasource:function(viewItem){OSH.Asserts.checkIsDefineOrNotNull(viewItem),OSH.Asserts.checkIsDefineOrNotNull(viewItem.styler);var currentDsIds=this.stylerIdToDatasources[viewItem.styler.id],newDs=viewItem.styler.getDataSourcesIds();for(var key in currentDsIds){var currentDsId=currentDsIds[key];newDs.indexOf(currentDsId)===-1&&OSH.EventManager.remove(OSH.EventManager.EVENT.DATA+"-"+currentDsId)}},handleEvents:function(){this._super(),OSH.EventManager.observe(OSH.EventManager.EVENT.SELECT_VIEW,function(event){this.selectDataView(event.dataSourcesIds,event.entityId)}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.ADD_VIEW_ITEM,function(event){void 0!==event.viewId&&event.viewId===this.id&&this.addViewItem(event.viewItem)}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.ADD_VIEW_ITEM+"-"+this.id,function(event){this.addViewItem(event.viewItem)}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.REMOVE_VIEW_ITEM+"-"+this.id,function(event){this.removeViewItem(event.viewItem)}.bind(this))},selectDataView:function(){},getDataSourcesId:function(){for(var res=[],i=0;i<this.viewItems.length;i++){var viewItem=this.viewItems[i];if(viewItem.hasOwnProperty("styler")){var styler=viewItem.styler;res=res.concat(styler.getDataSourcesIds())}}return res},reset:function(){},getType:function(){return OSH.UI.View.ViewType.UNDEFINED},updateProperties:function(properties){isUndefinedOrNull(properties)||isUndefinedOrNull(properties.keepRatio)||(this.options.keepRatio=properties.keepRatio,this.updateKeepRatio())}}),OSH.UI.View.ViewType={MAP:"map",VIDEO:"video",CHART:"chart",ENTITY_TREE:"entity_tree",DISCOVERY:"discovery",TASKING:"tasking",RANGE_SLIDER:"rangeSlider",UNDEFINED:"undefined"};
OSH.UI.ViewFactory=function(){},OSH.UI.ViewFactory.getDefaultViewProperties=function(viewInstanceType){var props={};switch(viewInstanceType){case OSH.UI.ViewFactory.ViewInstanceType.LEAFLET:break;case OSH.UI.ViewFactory.ViewInstanceType.FFMPEG:props={css:"video",cssSelected:"video-selected",name:"Video",useWorker:!0,useWebWorkerTransferableData:!1,keepRatio:!0};break;case OSH.UI.ViewFactory.ViewInstanceType.MJPEG:props={css:"video",cssSelected:"video-selected",name:"Video",keepRatio:!0};break;case OSH.UI.ViewFactory.ViewInstanceType.NVD3_LINE_CHART:props={name:"Line chart",css:"chart-view",cssSelected:"",maxPoints:30,initData:!0}}return props},OSH.UI.ViewFactory.getDefaultSimpleViewInstance=function(viewInstanceType,viewProperties){var cloneProperties={};cloneProperties=OSH.Utils.clone(viewProperties);var viewInstance=null;switch(viewInstanceType){case OSH.UI.ViewFactory.ViewInstanceType.FFMPEG:viewInstance=new OSH.UI.View.FFMPEGView("",cloneProperties);break;case OSH.UI.ViewFactory.ViewInstanceType.MJPEG:viewInstance=new OSH.UI.View.MjpegView("",cloneProperties)}return viewInstance.id=viewProperties.id,viewInstance.viewInstanceType=viewInstanceType,viewInstance},OSH.UI.ViewFactory.getDefaultViewInstance=function(viewInstanceType,defaultProperties){var viewInstance=null;switch(viewInstanceType){case OSH.UI.ViewFactory.ViewInstanceType.FFMPEG:viewInstance=new OSH.UI.View.FFMPEGView("",[],defaultProperties);break;case OSH.UI.ViewFactory.ViewInstanceType.LEAFLET:viewInstance=new OSH.UI.View.LeafletView("",[],defaultProperties);break;case OSH.UI.ViewFactory.ViewInstanceType.CESIUM:viewInstance=new OSH.UI.View.CesiumView("",[],defaultProperties);break;case OSH.UI.ViewFactory.ViewInstanceType.NVD3_LINE_CHART:viewInstance=new OSH.UI.View.Nvd3LineChartView("",[],defaultProperties);break;case OSH.UI.ViewFactory.ViewInstanceType.FFMPEG:viewInstance=new OSH.UI.View.FFMPEGView("",[],defaultProperties);break;case OSH.UI.ViewFactory.ViewInstanceType.MJPEG:viewInstance=new OSH.UI.View.MjpegView("",[],defaultProperties)}return viewInstance.viewInstanceType=viewInstanceType,viewInstance},OSH.UI.ViewFactory.ViewInstanceType={LEAFLET:"leaflet",FFMPEG:"video_h264",CESIUM:"cesium",MJPEG:"video_mjpeg",NVD3_LINE_CHART:"line_chart"};
OSH.UI.View.ChartView=OSH.UI.View.extend({initialize:function(parentElementDivId,viewItems,properties){this._super(parentElementDivId,viewItems,properties)},getType:function(){return OSH.UI.View.ViewType.CHART}});
OSH.UI.View.MapView=OSH.UI.View.extend({initialize:function(parentElementDivId,viewItems,properties){this._super(parentElementDivId,viewItems,properties)},getType:function(){return OSH.UI.View.ViewType.MAP},addMarker:function(properties){},removeMarker:function(){},updateMarker:function(styler){},addPolyline:function(properties){},updatePolyline:function(styler){},removePolyline:function(){}});
OSH.UI.View.TaskingView=OSH.UI.View.extend({initialize:function(parentElementDivId,properties){this._super(parentElementDivId,[],properties)},getType:function(){return OSH.UI.View.ViewType.TASKING}});
OSH.UI.View.VideoView=OSH.UI.View.extend({initialize:function(parentElementDivId,viewItems,properties){this._super(parentElementDivId,viewItems,properties),this.fps=0,this.nbFrames=0,this.FLUSH_LIMIT=200,this.statistics={videoStartTime:0,videoPictureCounter:0,windowStartTime:0,windowPictureCounter:0,fps:0,fpsMin:1e3,fpsMax:-1e3,fpsSinceStart:0},this.firstFrame=!0},init:function(parentElementDivId,viewItems,options){this._super(parentElementDivId,viewItems,options),OSH.Utils.addCss(this.elementDiv,"video"),this.css+=" video ",this.options.showFps=!1,this.options.keepRatio=!1,isUndefinedOrNull(options)||(isUndefinedOrNull(options.showFps)||(this.options.showFps=options.showFps),isUndefinedOrNull(options.keepRatio)||(this.options.keepRatio=options.keepRatio)),this.updateShowFps()},updateShowFps:function(){var showFps=!isUndefinedOrNull(this.options)&&!isUndefinedOrNull(this.options.showFps)&&this.options.showFps;if(showFps&&isUndefinedOrNull(this.statsElt)){this.statsElt=document.createElement("div"),this.statsElt.setAttribute("class","stats"),this.elementDiv.appendChild(this.statsElt),this.statsElt.innerHTML="Fps: 0";this.onAfterDecoded=function(){this.statsElt.innerHTML="Fps: "+this.statistics.fps.toFixed(1)}}else showFps||isUndefinedOrNull(this.statsElt)||(this.elementDiv.removeChild(this.statsElt),this.statsElt=null,this.onAfterDecoded=function(){})},updateStatistics:function(){this.nbFrames++;var s=this.statistics;s.videoPictureCounter+=1,s.windowPictureCounter+=1;var now=Date.now();s.videoStartTime||(s.videoStartTime=now);var videoElapsedTime=now-s.videoStartTime;if(s.elapsed=videoElapsedTime/1e3,!(videoElapsedTime<1e3)){if(!s.windowStartTime)return void(s.windowStartTime=now);if(now-s.windowStartTime>1e3){var windowElapsedTime=now-s.windowStartTime,fps=s.windowPictureCounter/windowElapsedTime*1e3;s.windowStartTime=now,s.windowPictureCounter=0,fps<s.fpsMin&&(s.fpsMin=fps),fps>s.fpsMax&&(s.fpsMax=fps),s.fps=fps}fps=s.videoPictureCounter/videoElapsedTime*1e3,s.fpsSinceStart=fps}},onAfterDecoded:function(){},updateFrame:function(styler){this.firstFrame&&(OSH.EventManager.observeDiv(this.divId,"click",function(event){OSH.EventManager.fire(OSH.EventManager.EVENT.SELECT_VIEW,{dataSourcesIds:styler.getDataSourcesIds(),entityId:styler.viewItem.entityId})}),this.firstFrame=!1)},selectDataView:function(dataSourceIds,entityId){var currentDataSources=this.getDataSourcesId();OSH.Utils.isArrayIntersect(dataSourceIds,currentDataSources)?OSH.Utils.addCss(this.elementDiv,this.cssSelected):OSH.Utils.removeCss(this.elementDiv,this.cssSelected)},stopVideo:function(){},getType:function(){return OSH.UI.View.ViewType.VIDEO},updateProperties:function(properties){this._super(properties),isUndefinedOrNull(properties)||isUndefinedOrNull(properties.showFps)||(this.options.showFps=properties.showFps,this.updateShowFps())}});
OSH.UI.ContextMenu=BaseClass.extend({initialize:function(properties){void 0!==properties&&void 0!==properties.id?this.id=properties.id:this.id="contextMenu-"+OSH.Utils.randomUUID(),this.handleEvents()},show:function(){},hide:function(){},handleEvents:function(){OSH.EventManager.observe(OSH.EventManager.EVENT.CONTEXT_MENU+"-"+this.id,function(event){"show"==event.action?this.show(event):"hide"==event.action&&this.hide()}.bind(this))}});
OSH.UI.ContextMenu.CssMenu=OSH.UI.ContextMenu.extend({initialize:function(properties,type){if(this._super(properties),this.items=[],this.type=void 0!==type?type:"",void 0!==properties&&void 0!==properties.items)for(var i=0;i<properties.items.length;i++){var elId=OSH.Utils.randomUUID(),htmlVar='<a  id="'+elId+'" ';void 0!==properties.items[i].css&&(htmlVar+='class="'+properties.items[i].css+'" ');var name="";void 0!==properties.items[i].name&&(name=properties.items[i].name),htmlVar+='title="'+name+'"',htmlVar+='><span id ="'+elId+'"class="'+this.type+'-menu-label">'+name+"</span></a>";var action="";void 0!==properties.items[i].action&&(action=properties.items[i].action);var viewId="";void 0!==properties.items[i].viewId&&(viewId=properties.items[i].viewId),this.items.push({html:htmlVar,id:elId,action:action,viewId:viewId})}},show:function(properties){this.removeElement();var closeId=OSH.Utils.randomUUID(),htmlVar=(OSH.Utils.randomUUID(),"");htmlVar+='<div class="'+this.type+'-menu">',htmlVar+='  <div class="'+this.type+'-menu-circle">';for(var i=0;i<this.items.length;i++)htmlVar+=this.items[i].html;htmlVar+="  </div>",htmlVar+='  <a id="'+closeId+'"class="'+this.type+'-menu-button fa fa-times fa-2x"></a>',htmlVar+="</div>",this.rootTag=document.createElement("div"),this.rootTag.setAttribute("class",this.type+"-menu-container"),this.rootTag.innerHTML=htmlVar,document.body.appendChild(this.rootTag);for(var items=document.querySelectorAll("."+this.type+"-menu-circle a"),i=0,l=items.length;i<l;i++)items[i].style.left=(50-35*Math.cos(-.5*Math.PI-1/l*2*i*Math.PI)).toFixed(4)+"%",items[i].style.top=(50+35*Math.sin(-.5*Math.PI-1/l*2*i*Math.PI)).toFixed(4)+"%";document.getElementById(closeId).onclick=this.hide.bind(this);var offsetX=0,offsetY=0;properties.offsetX&&(offsetX=properties.offsetX),properties.offsetY&&(offsetY=properties.offsetY),document.querySelector("."+this.type+"-menu-circle").classList.toggle("open"),isUndefinedOrNull(properties.x)||isUndefinedOrNull(properties.y)||(this.rootTag.style.transform="translate("+(properties.x+offsetX)+"px, "+(properties.y+offsetY)+"px)"),this.bindEvents={};for(var i=0;i<this.items.length;i++){var item=this.items[i];this.bindEvents[item.id]=item.viewId,document.getElementById(item.id).onclick=function(event){OSH.EventManager.fire(OSH.EventManager.EVENT.SHOW_VIEW,{viewId:this.bindEvents[event.target.id]})}.bind(this)}this.rootTag.onmousedown=function(event){event.preventDefault(),event.stopPropagation()}},hide:function(){var selectDiv=document.querySelector("."+this.type+"-menu-circle");isUndefinedOrNull(selectDiv)||(selectDiv.classList.toggle("open"),this.removeElement())},removeElement:function(){void 0!==this.rootTag&&null!=this.rootTag&&void 0!==this.rootTag.parentNode&&(this.rootTag.parentNode.removeChild(this.rootTag),this.rootTag=null)},getTransform:function(el){var transform=el.style.transform;return transform&&0!==transform.length?/^\s*((\w+)\s*\(([^)]+)\))/.exec(transform)[1]:""}});
OSH.UI.ContextMenu.CircularMenu=OSH.UI.ContextMenu.CssMenu.extend({initialize:function(properties){this._super(properties,"circular")}});
OSH.UI.ContextMenu.StackMenu=OSH.UI.ContextMenu.CssMenu.extend({initialize:function(properties){this._super(properties,"stack")},show:function(properties){this.removeElement();var htmlVar="";htmlVar+='  <div class="'+this.type+'-menu-circle">';for(var i=0;i<this.items.length;i++)htmlVar+=this.items[i].html;htmlVar+="  </div>",this.rootTag=document.createElement("div"),this.rootTag.setAttribute("class",this.type+"-menu-container"),this.rootTag.innerHTML=htmlVar,void 0!==properties.div?properties.div.appendChild(this.rootTag):document.body.appendChild(this.rootTag);var offsetX=0,offsetY=0;properties.offsetX&&(offsetX=properties.offsetX),properties.offsetY&&(offsetY=properties.offsetY),isUndefinedOrNull(properties.x)||isUndefinedOrNull(properties.y)||(this.rootTag.style.transform="translate("+(properties.x+offsetX)+"px, "+(properties.y+offsetY)+"px)"),document.querySelector("."+this.type+"-menu-circle").classList.toggle("open"),this.bindEvents={};for(var i=0;i<this.items.length;i++){var item=this.items[i];this.bindEvents[item.id]=item.viewId,document.getElementById(item.id).onclick=function(event){OSH.EventManager.fire(OSH.EventManager.EVENT.SHOW_VIEW,{viewId:this.bindEvents[event.target.id]}),OSH.EventManager.fire(OSH.EventManager.EVENT.SHOW_VIEW+"-"+this.bindEvents[event.target.id],{viewId:this.bindEvents[event.target.id]})}.bind(this)}this.rootTag.onmousedown=function(event){event.preventDefault(),event.stopPropagation()}},handleEvents:function(){this._super();var self=this;window.onmousedown=function(){self.hide()},window.onclick=function(){self.hide()}}});
OSH.UI.Styler=BaseClass.extend({initialize:function(jsonProperties){this.properties=jsonProperties,this.id="styler-"+OSH.Utils.randomUUID(),this.dataSourceToStylerMap={},this.initEvents()},initEvents:function(){OSH.EventManager.observe(OSH.EventManager.EVENT.DATASOURCE_UPDATE_TIME,function(event){this.clear()}.bind(this))},clear:function(){},getId:function(){return this.id},select:function(dataSourceIds){},addFn:function(dataSourceIds,fn){this.removeFn(fn.fnName);for(var i=0;i<dataSourceIds.length;i++){var dataSourceId=dataSourceIds[i];isUndefinedOrNull(this.dataSourceToStylerMap[dataSourceId])&&(this.dataSourceToStylerMap[dataSourceId]=[]),this.dataSourceToStylerMap[dataSourceId].push(fn)}},removeFn:function(fnName){for(var dsKey in this.dataSourceToStylerMap){for(var currentDsArray=this.dataSourceToStylerMap[dsKey],idx=-1,j=0;j<currentDsArray.length;j++){var currentDsElt=currentDsArray[j];if(!isUndefinedOrNull(currentDsElt.fnName)&&fnName===currentDsElt.fnName){idx=j;break}}idx>-1&&(this.dataSourceToStylerMap[dsKey].splice(idx,1),0===this.dataSourceToStylerMap[dsKey].length&&delete this.dataSourceToStylerMap[dsKey])}},setData:function(dataSourceId,rec,view,options){if(dataSourceId in this.dataSourceToStylerMap){for(var fnArr=this.dataSourceToStylerMap[dataSourceId],i=0;i<fnArr.length;i++)fnArr[i](rec.data,rec.timeStamp,options);return!0}return!1},getDataSourcesIds:function(){var res=[];for(var i in this.dataSourceToStylerMap)res.push(i);return res},init:function(){},remove:function(view){},update:function(view){}});
OSH.UI.Styler.ImageDraping=OSH.UI.Styler.extend({initialize:function(properties){if(this._super(properties),this.properties=properties,this.platformLocation=null,this.platformOrientation=null,this.gimbalOrientation=null,this.cameraModel=null,this.imageSrc=null,this.snapshotFunc=null,this.options={},isUndefinedOrNull(properties.platformLocation)||(this.platformLocation=properties.platformLocation),isUndefinedOrNull(properties.platformOrientation)||(this.platformOrientation=properties.platformOrientation),isUndefinedOrNull(properties.gimbalOrientation)||(this.gimbalOrientation=properties.gimbalOrientation),isUndefinedOrNull(properties.cameraModel)||(this.cameraModel=properties.cameraModel),isUndefinedOrNull(properties.imageSrc)||(this.imageSrc=properties.imageSrc),!isUndefinedOrNull(properties.platformLocationFunc)){var fn=function(rec,timeStamp,options){this.platformLocation=properties.platformLocationFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="platformLocation",this.addFn(properties.platformLocationFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.platformOrientationFunc)){var fn=function(rec,timeStamp,options){this.platformOrientation=properties.platformOrientationFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="platformOrientation",this.addFn(properties.platformOrientationFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.gimbalOrientationFunc)){var fn=function(rec,timeStamp,options){this.gimbalOrientation=properties.gimbalOrientationFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="gimbalOrientation",this.addFn(properties.gimbalOrientationFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.cameraModelFunc)){var fn=function(rec,timeStamp,options){this.cameraModel=properties.cameraModelFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="cameraModel",this.addFn(properties.cameraModelFunc.dataSourceIds,fn)}isUndefinedOrNull(properties.snapshotFunc)||(fn.fnName="snapshot",this.snapshotFunc=properties.snapshotFunc)},init:function(view){this._super(view)},setData:function(dataSourceId,rec,view,options){if(this._super(dataSourceId,rec,view,options)){var snapshot=!1;null!=this.snapshotFunc&&(snapshot=this.snapshotFunc()),void 0!==view&&null!=this.platformLocation&&null!=this.platformOrientation&&null!=this.gimbalOrientation&&null!=this.cameraModel&&null!=this.imageSrc&&view.updateDrapedImage(this,rec.timeStamp,options,snapshot)}}});
OSH.UI.Styler.LinePlot=OSH.UI.Styler.extend({initialize:function(properties){this._super(properties),this.xLabel="",this.yLabel="",this.color="#1f77b5",this.stroke=1,this.x=0,this.y=[],this.updateProperties(properties)},updateProperties:function(properties){if(OSH.Utils.copyProperties(properties,this.properties,!0),isUndefinedOrNull(properties.stroke)||(this.stroke=properties.stroke),isUndefinedOrNull(properties.color)||(this.color=properties.color),isUndefinedOrNull(properties.x)||(this.x=properties.x),isUndefinedOrNull(properties.y)||(this.y=properties.y),!isUndefinedOrNull(properties.strokeFunc)){var fn=function(rec,timeStamp,options){this.stroke=properties.strokeFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="stroke",this.addFn(properties.strokeFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.colorFunc)){var fn=function(rec,timeStamp,options){this.color=properties.colorFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="color",this.addFn(properties.colorFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.valuesFunc)){var fn=function(rec,timeStamp,options){var values=properties.valuesFunc.handler(rec,timeStamp,options);this.x=values.x,this.y=values.y}.bind(this);fn.fnName="values",this.addFn(properties.valuesFunc.dataSourceIds,fn)}},setData:function(dataSourceId,rec,view,options){this._super(dataSourceId,rec,view,options)&&void 0!==view&&(this.lastData={lastTimeStamp:rec.timeStamp,lastOptions:options,x:this.x,y:this.y},view.updateLinePlot(this,rec.timeStamp,options))},clear:function(){},remove:function(view){isUndefinedOrNull(view)||view.removeLinePlot(this)},update:function(view){isUndefinedOrNull(view)||isUndefinedOrNull(this.lastData)||(this.x=this.lastData.x,this.y=this.lastData.y,view.updateLinePlot(this,this.lastData.lastTimeStamp,this.lastData.lastOptions))}});
OSH.UI.Styler.Video=OSH.UI.Styler.extend({initialize:function(properties){this._super(properties),this.initProperties(properties)},initProperties:function(properties){this.frame=null,this.options={},this.updateProperties(properties)},updateProperties:function(properties){if(OSH.Utils.copyProperties(properties,this.properties,!0),!isUndefinedOrNull(properties.frameFunc)){var fn=function(rec,timeStamp,options){this.frame=properties.frameFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="frame",this.addFn(properties.frameFunc.dataSourceIds,fn)}},init:function(view){this._super(view)},setData:function(dataSourceId,rec,view,options){this._super(dataSourceId,rec,view,options)&&(isUndefinedOrNull(view)||isUndefinedOrNull(this.frame)||(this.lastData={lastTimeStamp:rec.timeStamp,lastOptions:options,frame:this.frame},view.updateFrame(this,rec.timeStamp,options)))},clear:function(){},remove:function(view){isUndefinedOrNull(view)||view.stopVideo(this)},update:function(view){isUndefinedOrNull(view)||isUndefinedOrNull(this.lastData)||(this.frame=this.lastData.frame,view.updateFrame(this,this.lastData.lastTimeStamp,this.lastData.lastOptions))}});
OSH.UI.Styler.Factory=function(){},OSH.UI.Styler.Factory.LOCATION_DEFINITIONS=["http://www.opengis.net/def/property/OGC/0/SensorLocation","http://sensorml.com/ont/swe/property/Location"],OSH.UI.Styler.Factory.ORIENTATION_DEFINITIONS=["http://sensorml.com/ont/swe/property/OrientationQuaternion"],OSH.UI.Styler.Factory.CURVE_DEFINITIONS=["http://sensorml.com/ont/swe/property/Weather"],OSH.UI.Styler.Factory.TYPE={MARKER:"Marker",POLYLINE:"Polyline",LINE_PLOT:"LinePlot",VIDEO:"Video"},OSH.UI.Styler.Factory.getLocation=function(x,y,z){return{location:{x:x,y:y,z:z}}},OSH.UI.Styler.Factory.getLocationFunc=function(datasource,xIdx,yIdx,zIdx){var x="timeStamp",y="timeStamp",z="timeStamp";xIdx>0&&(x="rec."+datasource.resultTemplate[xIdx].path),yIdx>0&&(y="rec."+datasource.resultTemplate[yIdx].path),zIdx>0&&(z="rec."+datasource.resultTemplate[zIdx].path);var locationFnStr="return {x: "+x+",y: "+y+",z: "+z+"}",argsLocationTemplateHandlerFn=["rec","timeStamp","options",locationFnStr],locationTemplateHandlerFn=Function.apply(null,argsLocationTemplateHandlerFn);return{locationFunc:{dataSourceIds:[datasource.id],handler:locationTemplateHandlerFn}}},OSH.UI.Styler.Factory.getCustomLocationFunc=function(styler,locationFnStr){OSH.Asserts.checkObjectPropertyPath(styler,"properties.locationFunc.dataSourceIds","The styler must have datasourceId to be used with locationFunc");var argsLocationTemplateHandlerFn=["rec",locationFnStr],locationTemplateHandlerFn=Function.apply(null,argsLocationTemplateHandlerFn);return{locationFunc:{dataSourceIds:styler.properties.locationFunc.dataSourceIds,handler:locationTemplateHandlerFn}}},OSH.UI.Styler.Factory.getFixedIcon=function(dataSourceIdsArray,url){var iconTemplate="return '"+url+"';",argsIconTemplateHandlerFn=["rec","timeStamp","options",iconTemplate];return{icon:url,iconFunc:{dataSourceIds:dataSourceIdsArray,handler:Function.apply(null,argsIconTemplateHandlerFn)}}},OSH.UI.Styler.Factory.getThresholdIcon=function(datasource,observableIdx,defaultIconUrl,lowIconUrl,highIconUrl,thresholdValue){OSH.Asserts.checkObjectPropertyPath(datasource,"resultTemplate","The data source must contain the resultTemplate property"),OSH.Asserts.checkArrayIndex(datasource.resultTemplate,observableIdx),OSH.Asserts.checkIsDefineOrNotNull(datasource),OSH.Asserts.checkIsDefineOrNotNull(defaultIconUrl),OSH.Asserts.checkIsDefineOrNotNull(lowIconUrl),OSH.Asserts.checkIsDefineOrNotNull(highIconUrl),OSH.Asserts.checkIsDefineOrNotNull(thresholdValue);var path="timeStamp";observableIdx>0&&(path="rec."+datasource.resultTemplate[observableIdx].path);var iconTemplate="if ("+path+" < "+thresholdValue+" ) { return '"+lowIconUrl+"'; }else if ("+path+" > "+thresholdValue+" ) { return '"+highIconUrl+"'; }else { return '"+defaultIconUrl+"'; }",argsIconTemplateHandlerFn=["rec","timeStamp","options",iconTemplate],iconTemplateHandlerFn=Function.apply(null,argsIconTemplateHandlerFn);return{icon:defaultIconUrl,iconFunc:{dataSourceIds:[datasource.id],handler:iconTemplateHandlerFn}}},OSH.UI.Styler.Factory.getCustomIconFunc=function(dataSourceIdsArray,iconFnStr){var argsTemplateHandlerFn=["rec","timeStamp","options",iconFnStr];return{iconFunc:{dataSourceIds:dataSourceIdsArray,handler:Function.apply(null,argsTemplateHandlerFn)}}},OSH.UI.Styler.Factory.getSelectedIconFunc=function(dataSourceIdsArray,defaultUrl,selectedUrl){OSH.Asserts.checkIsDefineOrNotNull(dataSourceIdsArray),OSH.Asserts.checkIsDefineOrNotNull(defaultUrl),OSH.Asserts.checkIsDefineOrNotNull(selectedUrl);var iconTemplate="";iconTemplate="if (options.selected) {",iconTemplate+="  return '"+selectedUrl+"'",iconTemplate+="} else {",iconTemplate+="  return '"+defaultUrl+"'",iconTemplate+="}";var argsIconTemplateHandlerFn=["rec","timeStamp","options",iconTemplate];return{icon:defaultUrl,iconFunc:{dataSourceIds:dataSourceIdsArray,handler:Function.apply(null,argsIconTemplateHandlerFn)}}},OSH.UI.Styler.Factory.getValues=function(x,y){return{values:{x:x,y:y}}},OSH.UI.Styler.Factory.getValuesFunc=function(datasource,xIdx,yIdx){var x="timeStamp",y="timeStamp";xIdx>0&&(x="rec."+datasource.resultTemplate[xIdx].path),yIdx>0&&(y="rec."+datasource.resultTemplate[yIdx].path);var valuesFnStr="return {x: "+x+",y: "+y+"}",argsValuesTemplateHandlerFn=["rec","timeStamp","options",valuesFnStr],valuesTemplateHandlerFn=Function.apply(null,argsValuesTemplateHandlerFn);return{valuesFunc:{dataSourceIds:[datasource.id],handler:valuesTemplateHandlerFn}}},OSH.UI.Styler.Factory.getCustomValuesFunc=function(dataSourceIdsArray,valuesFnStr){var argsTemplateHandlerFn=["rec","timeStamp","options",valuesFnStr];return{valuesFunc:{dataSourceIds:dataSourceIdsArray,handler:Function.apply(null,argsTemplateHandlerFn)}}},OSH.UI.Styler.Factory.getFixedColor=function(dataSourceIdsArray,url){var colorTemplate="return '"+url+"';",argsColorTemplateHandlerFn=["rec","timeStamp","options",colorTemplate];return{color:url,colorFunc:{dataSourceIds:dataSourceIdsArray,handler:Function.apply(null,argsColorTemplateHandlerFn)}}},OSH.UI.Styler.Factory.getThresholdColor=function(datasource,observableIdx,defaultColor,lowColor,highColor,thresholdValue){OSH.Asserts.checkObjectPropertyPath(datasource,"resultTemplate","The data source must contain the resultTemplate property"),OSH.Asserts.checkArrayIndex(datasource.resultTemplate,observableIdx),OSH.Asserts.checkIsDefineOrNotNull(datasource),OSH.Asserts.checkIsDefineOrNotNull(defaultColor),OSH.Asserts.checkIsDefineOrNotNull(lowColor),OSH.Asserts.checkIsDefineOrNotNull(highColor),OSH.Asserts.checkIsDefineOrNotNull(thresholdValue);var path="timeStamp";observableIdx>0&&(path="rec."+datasource.resultTemplate[observableIdx].path);var colorTemplate="if ("+path+" < "+thresholdValue+" ) { return '"+lowColor+"'; }else if ("+path+" > "+thresholdValue+" ) { return '"+highColor+"'; }else { return '"+defaultColor+"'; }",argsColorTemplateHandlerFn=["rec","timeStamp","options",colorTemplate],colorTemplateHandlerFn=Function.apply(null,argsColorTemplateHandlerFn);return{color:defaultColor,colorFunc:{dataSourceIds:[datasource.id],handler:colorTemplateHandlerFn}}},OSH.UI.Styler.Factory.getCustomColorFunc=function(dataSourceIdsArray,colorFnStr){var argsTemplateHandlerFn=["rec","timeStamp","options",colorFnStr];return{colorFunc:{dataSourceIds:dataSourceIdsArray,handler:Function.apply(null,argsTemplateHandlerFn)}}},OSH.UI.Styler.Factory.getSelectedColorFunc=function(dataSourceIdsArray,defaultColor,selectedColor){OSH.Asserts.checkIsDefineOrNotNull(dataSourceIdsArray),OSH.Asserts.checkIsDefineOrNotNull(defaultColor),OSH.Asserts.checkIsDefineOrNotNull(selectedColor);var colorTemplate="";colorTemplate="if (options.selected) {",colorTemplate+="  return '"+selectedColor+"'",colorTemplate+="} else {",colorTemplate+="  return '"+defaultColor+"'",colorTemplate+="}";var argsColorTemplateHandlerFn=["rec","timeStamp","options",colorTemplate];return{color:defaultColor,colorFunc:{dataSourceIds:dataSourceIdsArray,handler:Function.apply(null,argsColorTemplateHandlerFn)}}},OSH.UI.Styler.Factory.getVideoFunc=function(datasource,observableIdx){OSH.Asserts.checkObjectPropertyPath(datasource,"resultTemplate","The data source must contain the resultTemplate property"),OSH.Asserts.checkArrayIndex(datasource.resultTemplate,observableIdx),OSH.Asserts.checkIsDefineOrNotNull(datasource);var argsVideoTemplateHandlerFn=["rec","timeStamp","options","return rec"],videoTemplateHandlerFn=Function.apply(null,argsVideoTemplateHandlerFn);return{frameFunc:{dataSourceIds:[datasource.id],handler:videoTemplateHandlerFn}}},OSH.UI.Styler.Factory.getTypeFromInstance=function(stylerInstance){if(stylerInstance instanceof OSH.UI.Styler.PointMarker)return OSH.UI.Styler.Factory.TYPE.MARKER;if(stylerInstance instanceof OSH.UI.Styler.Polyline)return OSH.UI.Styler.Factory.TYPE.POLYLINE;if(stylerInstance instanceof OSH.UI.Styler.LinePlot)return OSH.UI.Styler.Factory.TYPE.LINE_PLOT;if(stylerInstance instanceof OSH.UI.Styler.Video)return OSH.UI.Styler.Factory.TYPE.VIDEO;throw new OSH.Exception.Exception("No type available for the instance "+stylerInstance)},OSH.UI.Styler.Factory.getNewInstanceFromType=function(type){if(type===OSH.UI.Styler.Factory.TYPE.LINE_PLOT)return new OSH.UI.Styler.LinePlot({});if(type===OSH.UI.Styler.Factory.TYPE.MARKER)return new OSH.UI.Styler.PointMarker({});if(type===OSH.UI.Styler.Factory.TYPE.POLYLINE)return new OSH.UI.Styler.Polyline({});if(type===OSH.UI.Styler.Factory.TYPE.VIDEO)return new OSH.UI.Styler.Video({});throw new OSH.Exception.Exception("No styler instance available for the type "+type)},OSH.UI.Styler.Factory.buildFunctionFromSource=function(dataSourceIds,propertyName,strSource){var stylerFunc={},argsFuncTemplateHandlerFn=["rec","timeStamp","options",strSource],funcTemplateHandlerFn=Function.apply(null,argsFuncTemplateHandlerFn);return stylerFunc[propertyName]={dataSourceIds:dataSourceIds,handler:funcTemplateHandlerFn},stylerFunc};
OSH.UI.Panel.DiscoveryPanel=OSH.UI.Panel.extend({initialize:function(parentElementDivId,properties){this._super(parentElementDivId,[],properties),this.dialogContainer=document.body.id,this.formTagId="form-"+OSH.Utils.randomUUID(),this.serviceSelectTagId="service-"+OSH.Utils.randomUUID(),this.offeringSelectTagId="offering-"+OSH.Utils.randomUUID(),this.observablePropertyTagId="obsProperty-"+OSH.Utils.randomUUID(),this.nameTagId="name-"+OSH.Utils.randomUUID(),this.startTimeTagId="startTime-"+OSH.Utils.randomUUID(),this.endTimeTagId="endTime-"+OSH.Utils.randomUUID(),this.typeSelectTagId="type-"+OSH.Utils.randomUUID(),this.formButtonId="submit-"+OSH.Utils.randomUUID(),this.syncMasterTimeId="syncMasterTime-"+OSH.Utils.randomUUID(),this.replaySpeedId="resplaySpeed-"+OSH.Utils.randomUUID(),this.responseFormatId="responseFormat-"+OSH.Utils.randomUUID(),this.bufferingId="buffering-"+OSH.Utils.randomUUID(),this.timeShiftId="timeShift-"+OSH.Utils.randomUUID(),this.timeoutId="timeout-"+OSH.Utils.randomUUID();var discoveryForm=document.createElement("form");discoveryForm.setAttribute("action","#"),discoveryForm.setAttribute("id",this.formTagId),discoveryForm.setAttribute("class","discovery-form"),OSH.Utils.addCss(document.getElementById(this.divId),"discovery-view"),document.getElementById(this.divId).appendChild(discoveryForm);var strVar="";strVar+='<ul class="osh-ul">',strVar+='            <li class="osh-li">',strVar+="                <h2>Discovery</h2>",strVar+='                <span class="required_notification">* Denotes Required Field</span>',strVar+="            </li>",strVar+='            <li class="osh-li">',strVar+="                <label>Service:</label>",strVar+='                <div class="select-style">',strVar+='                     <select id="'+this.serviceSelectTagId+'" required pattern="^(?!Select a service$).*">',strVar+='                         <option value="" disabled selected>Select a service</option>',strVar+="                     </select>",strVar+="                </div>",strVar+="            </li>",strVar+='            <li class="osh-li">',strVar+="                <label>Offering:</label>",strVar+='                <div class="select-style">',strVar+='                    <select id="'+this.offeringSelectTagId+'" required>',strVar+='                        <option value="" disabled selected>Select an offering</option>',strVar+="                    </select>",strVar+="                </div>",strVar+="            </li>",strVar+='            <li class="osh-li">',strVar+="                <label>Observable Property:</label>",strVar+='                <div class="select-style">',strVar+='                     <select id="'+this.observablePropertyTagId+'" required>',strVar+='                         <option value="" disabled selected>Select a property</option>',strVar+="                     </select>",strVar+="                </div>",strVar+="            </li>",strVar+='            <li class="osh-li">',strVar+='                 <label for="name">Name:</label>',strVar+='                 <input id="'+this.nameTagId+'"  class="input-text" type="input-text" name="name"/>',strVar+="            </li>",strVar+='            <li class="osh-li">',strVar+='                <label for="startTime">Start time:</label>',strVar+='                <input id="'+this.startTimeTagId+'" type="text" name="startTime" class="input-text" placeholder="YYYY-MM-DDTHH:mm:ssZ" required/>',strVar+='                <span class="form_hint">YYYY-MM-DDTHH:mm:ssZ</span>',strVar+="            </li>",strVar+='            <li class="osh-li">',strVar+='                <label for="endTime">End time:</label>',strVar+='                <input id="'+this.endTimeTagId+'" type="text" name="endTime" class="input-text" placeholder="YYYY-MM-DDTHH:mm:ssZ"  required/>',strVar+='                <span class="form_hint">YYYY-MM-DDTHH:mm:ssZ</span>',strVar+="            </li>",strVar+='            <div class="advanced">',strVar+='                 <!--input type="checkbox" class="advanced"><i class="fa fa-plus-square-o details-button" aria-hidden="true"></i>&nbsp; Advanced </input-->',strVar+='                 <input type="checkbox" name="advanced" id="advanced"/><label for="advanced"><i class="fa"></i>Advanced</label>',strVar+='                 <div class="details">',strVar+='                     <li class="osh-li">',strVar+='                         <label for="syncMasterTime">Sync master time:</label>',strVar+='                         <input id="'+this.syncMasterTimeId+'"  class="input-checkbox" type="checkbox" name="syncMasterTime" />',strVar+="                     </li>",strVar+='                     <li class="osh-li">',strVar+='                         <label for="replaySpeed">Replay factor:</label>',strVar+='                         <input id="'+this.replaySpeedId+'"  class="input-text" type="input-text" name="replaySpeed" value=\'1\' />',strVar+="                     </li>",strVar+='                     <li class="osh-li">',strVar+='                         <label for="responseFormat">Response format</label>',strVar+='                         <input id="'+this.responseFormatId+'"  class="input-text" type="input-text" name="responseFormat" placeholder=\'e.g: mp4\'/>',strVar+="                     </li>",strVar+='                     <li class="osh-li">',strVar+='                         <label for="buffering">Buffering time (ms)</label>',strVar+='                         <input id="'+this.bufferingId+'"  class="input-text" type="input-text" name="buffering" value=\'1000\'/>',strVar+="                     </li>",strVar+='                     <li class="osh-li">',strVar+='                         <label for="timeShift">TimeShift (ms)</label>',strVar+='                         <input id="'+this.timeShiftId+'"  class="input-text" type="input-text" name="timeShift" value="0"/>',strVar+="                     </li>",strVar+='                     <li class="osh-li">',strVar+='                         <label for="timeout">Timeout (ms)</label>',strVar+='                         <input id="'+this.timeoutId+'"  class="input-text" type="input-text" name="timeout" value="1000"/>',strVar+="                     </li>",strVar+="                 </div>",strVar+="             </div>",strVar+='            <li class="osh-li">',strVar+='                <button id="'+this.formButtonId+'" class="submit" type="submit">Add</button>',strVar+="            </li>",strVar+="        </ul>",discoveryForm.innerHTML=strVar;for(var inputs=discoveryForm.querySelectorAll("input.input-text"),i=0;i<inputs.length;i++)inputs[i].onfocus=function(e){OSH.Utils.fixSelectable(this,!0)},inputs[i].onblur=function(e){OSH.Utils.fixSelectable(this,!1)};void 0!==properties&&void 0!==properties.services&&this.addValuesToSelect(this.serviceSelectTagId,properties.services),OSH.EventManager.observeDiv(this.serviceSelectTagId,"change",this.onSelectedService.bind(this)),OSH.EventManager.observeDiv(this.offeringSelectTagId,"change",this.onSelectedOffering.bind(this)),OSH.EventManager.observeDiv(this.observablePropertyTagId,"change",this.onSelectedObsProperty.bind(this)),OSH.EventManager.observeDiv(this.formTagId,"submit",this.onFormSubmit.bind(this))},getButtonElement:function(){return document.getElementById(this.formButtonId)},initDataSource:function(dataSource){var serverTag=document.getElementById(this.serviceSelectTagId);serverTag.dataSourceId=dataSource.id,this.removeAllFromSelect(this.offeringSelectTagId),this.removeAllFromSelect(this.observablePropertyTagId);var dataSourceEndPoint=dataSource.properties.endpointUrl;dataSourceEndPoint.startsWith("http")||(dataSourceEndPoint="http://"+dataSourceEndPoint);for(var i=0;i<serverTag.options.length;i++){var currentOption=serverTag.options[i].value;if(currentOption.startsWith("http")||(currentOption="http://"+currentOption),currentOption===dataSourceEndPoint){serverTag.options[i].setAttribute("selected",""),this.onSelectedService({dataSource:dataSource});break}}document.getElementById(this.syncMasterTimeId).checked=dataSource.syncMasterTime,document.getElementById(this.replaySpeedId).value=dataSource.properties.replaySpeed,document.getElementById(this.bufferingId).value=dataSource.bufferingTime,document.getElementById(this.responseFormatId).value=isUndefined(dataSource.properties.responseFormat)?"":dataSource.properties.responseFormat,document.getElementById(this.timeShiftId).value=dataSource.timeShift},setButton:function(name){document.getElementById(this.formButtonId).innerHTML=name},onSelectedService:function(event){var serverTag=document.getElementById(this.serviceSelectTagId),option=serverTag.options[serverTag.selectedIndex];this.removeAllFromSelect(this.offeringSelectTagId),this.oshServer=new OSH.Server({url:option.value});var onSuccessGetCapabilities=function(jsonObj){for(var offering=(document.getElementById(this.startTimeTagId),document.getElementById(this.endTimeTagId),null),offeringMap={},i=0;i<jsonObj.Capabilities.contents.offering.length;i++)offering=jsonObj.Capabilities.contents.offering[i],this.addValueToSelect(this.offeringSelectTagId,offering.name,offering),offeringMap[offering.name]=offering;if(!isUndefined(event.dataSource))for(var offeringTag=document.getElementById(this.offeringSelectTagId),offeringId=event.dataSource.properties.offeringID,i=0;i<offeringTag.options.length;i++){var currentOffering=(offeringTag.options[i].value,offeringMap[offeringTag.options[i].value]);if(!isUndefined(currentOffering)&&currentOffering.identifier===offeringId){offeringTag.options[i].setAttribute("selected",""),this.onSelectedOffering({dataSource:event.dataSource});break}}}.bind(this),onErrorGetCapabilities=function(event){};this.oshServer.getCapabilities(onSuccessGetCapabilities,onErrorGetCapabilities)},onSelectedOffering:function(event){var e=document.getElementById(this.offeringSelectTagId),option=e.options[e.selectedIndex],offering=option.parent;this.removeAllFromSelect(this.observablePropertyTagId);for(var startTimeInputTag=document.getElementById(this.startTimeTagId),endTimeInputTag=document.getElementById(this.endTimeTagId),i=0;i<offering.observableProperty.length;i++){var disable=!1;disable=!1,this.addValueToSelect(this.observablePropertyTagId,offering.observableProperty[i],offering,null,disable)}if(isUndefined(event.dataSource))if(startTimeInputTag.value=offering.phenomenonTime.beginPosition,void 0!==offering.phenomenonTime.endPosition.indeterminatePosition){var d=new Date;d.setUTCFullYear(2055),endTimeInputTag.value=d.toISOString(),startTimeInputTag.value="now"}else endTimeInputTag.value=offering.phenomenonTime.endPosition;else{for(var obsPropertyTag=document.getElementById(this.observablePropertyTagId),i=0;i<obsPropertyTag.options.length;i++){if(obsPropertyTag.options[i].value===event.dataSource.properties.observedProperty){obsPropertyTag.options[i].setAttribute("selected",""),this.onSelectedObsProperty({dataSource:event.dataSource});break}}startTimeInputTag.value=event.dataSource.properties.startTime,endTimeInputTag.value=event.dataSource.properties.endTime}},onSelectedObsProperty:function(event){if(isUndefined(event.dataSource)){var e=document.getElementById(this.observablePropertyTagId),option=e.options[e.selectedIndex],obsProp=option.value,split=obsProp.split("/"),newNameValue="";void 0!==split&&null!==split&&split.length>0&&(newNameValue=split[split.length-1]),document.getElementById(this.nameTagId).value=newNameValue}else document.getElementById(this.nameTagId).value=event.dataSource.name},onFormSubmit:function(event){event.preventDefault();var serviceTag=document.getElementById(this.serviceSelectTagId),serviceTagSelectedOption=serviceTag.options[serviceTag.selectedIndex],offeringTag=document.getElementById(this.offeringSelectTagId),offeringTagSelectedOption=offeringTag.options[offeringTag.selectedIndex],observablePropertyTag=document.getElementById(this.observablePropertyTagId),observablePropertyTagSelectedOption=observablePropertyTag.options[observablePropertyTag.selectedIndex],nameTag=document.getElementById(this.nameTagId),startTimeInputTag=document.getElementById(this.startTimeTagId),endTimeInputTag=document.getElementById(this.endTimeTagId),syncMasterTimeTag=document.getElementById(this.syncMasterTimeId),replaySpeedTag=document.getElementById(this.replaySpeedId),bufferingTag=document.getElementById(this.bufferingId),responseFormatTag=document.getElementById(this.responseFormatId),timeShiftTag=document.getElementById(this.timeShiftId),timeoutTag=document.getElementById(this.timeoutId),endPointUrl=(offeringTagSelectedOption.parent.name,serviceTagSelectedOption.value),offeringID=offeringTagSelectedOption.parent.identifier,obsProp=observablePropertyTagSelectedOption.value,startTime=startTimeInputTag.value,endTime=endTimeInputTag.value;endPointUrl=endPointUrl.replace("http://","");var syncMasterTime=syncMasterTimeTag.checked,replaySpeed=replaySpeedTag.value,buffering=bufferingTag.value,responseFormat=responseFormatTag.value,timeShift=timeShiftTag.value,timeout=timeoutTag.value,properties={name:nameTag.value,protocol:"ws",service:"SOS",endpointUrl:endPointUrl,offeringID:offeringID,observedProperty:obsProp,startTime:startTime,endTime:endTime,replaySpeed:Number(replaySpeed),syncMasterTime:syncMasterTime,bufferingTime:Number(buffering),timeShift:Number(timeShift),timeout:Number(timeout),responseFormat:void 0!==responseFormat&&null!==responseFormat?responseFormat:void 0,definition:obsProp},existingDSId=serviceTag.dataSourceId;return OSH.DataReceiver.DataSourceFactory.createDatasourceFromType(properties,function(result){isUndefinedOrNull(existingDSId)?this.onAddHandler(result):(result.id=existingDSId,this.onEditHandler(result))}.bind(this)),!1},onEditHandler:function(datasource){},onAddHandler:function(datasource){},addObjectsToSelect:function(tagId,objectsArr){for(var selectTag=document.getElementById(tagId),i=0;i<objectsArr.length;i++){var object=objectsArr[i],option=document.createElement("option");option.text=object.name,option.value=object.name,option.object=object,selectTag.add(option)}},addValuesToSelect:function(tagId,valuesArr){for(var selectTag=document.getElementById(tagId),i=0;i<valuesArr.length;i++){var value=valuesArr[i],option=document.createElement("option");option.text=value,option.value=value,selectTag.add(option)}},addValueToSelect:function(tagId,value,parent,object,disable){var selectTag=document.getElementById(tagId),option=document.createElement("option");option.text=value,option.value=value,option.parent=parent,void 0!==object&&null!==object&&(option.object=object),void 0!==parent&&(option.parent=parent),void 0!==disable&&disable&&(option.setAttribute("disabled",""),option.text+=" (not supported)"),selectTag.add(option)},removeAllFromSelect:function(tagId){var i,selectTag=document.getElementById(tagId);for(i=selectTag.options.length-1;i>0;i--)selectTag.remove(i)},getType:function(){return OSH.UI.View.ViewType.DISCOVERY}});
OSH.UI.Styler.Nexrad=OSH.UI.Styler.extend({initialize:function(properties){if(this._super(properties),this.properties=properties,this.location=null,this.radialData=null,this.options={},isUndefinedOrNull(properties.location)||(this.location=properties.location),isUndefinedOrNull(properties.radialData)||(this.radialData=properties.radialData),!isUndefinedOrNull(properties.locationFunc)){var fn=function(rec,timeStamp,options){this.location=properties.locationFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="location",this.addFn(properties.locationFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.radialDataFunc)){var fn=function(rec,timeStamp,options){this.radialData=properties.radialDataFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="radialData",this.addFn(properties.radialDataFunc.dataSourceIds,fn)}this.reflectivityColorMap=[Cesium.Color.fromBytes(100,100,100),Cesium.Color.fromBytes(204,255,255),Cesium.Color.fromBytes(204,153,204),Cesium.Color.fromBytes(153,102,153),Cesium.Color.fromBytes(102,51,102),Cesium.Color.fromBytes(204,204,153),Cesium.Color.fromBytes(153,153,102),Cesium.Color.fromBytes(100,100,100),Cesium.Color.fromBytes(4,233,231),Cesium.Color.fromBytes(1,159,244),Cesium.Color.fromBytes(3,0,244),Cesium.Color.fromBytes(2,253,2),Cesium.Color.fromBytes(1,197,1),Cesium.Color.fromBytes(0,142,0),Cesium.Color.fromBytes(253,248,2),Cesium.Color.fromBytes(229,188,0),Cesium.Color.fromBytes(253,149,0),Cesium.Color.fromBytes(253,0,0),Cesium.Color.fromBytes(212,0,0),Cesium.Color.fromBytes(188,0,0),Cesium.Color.fromBytes(248,0,253),Cesium.Color.fromBytes(152,84,198),Cesium.Color.fromBytes(253,253,253)],this.pointCollection=new Cesium.PointPrimitiveCollection,this.radialCount=0},init:function(view){this._super(view)},setData:function(dataSourceId,rec,view,options){if(this._super(dataSourceId,rec,view,options)&&!isUndefinedOrNull(view)){var DTR=Math.PI/180;if(rec.data.elevation>.7)return;for(var radarLoc=Cesium.Cartesian3.fromDegrees(this.location.x,this.location.y,this.location.z),quat=Cesium.Transforms.headingPitchRollQuaternion(radarLoc,(rec.data.azimuth-90)*DTR,rec.data.elevation*DTR,0),rotM=Cesium.Matrix3.fromQuaternion(quat),dist0=(new Cesium.PointPrimitiveCollection,rec.data.rangeToCenterOfFirstRefGate),step=rec.data.refGateSize,i=0;i<rec.data.reflectivity.length;i++){var val=rec.data.reflectivity[i];if(!(val<-32||val>94.5)){var gatePos=new Cesium.Cartesian3(dist0+i*step,0,0);Cesium.Matrix3.multiplyByVector(rotM,gatePos,gatePos),this.pointCollection.add({position:Cesium.Cartesian3.add(radarLoc,gatePos,gatePos),color:this.getReflectivityColor(val),pixelSize:3})}}this.radialCount++,100===this.radialCount&&(view.viewer.scene.primitives.add(this.pointCollection),this.pointCollection=new Cesium.PointPrimitiveCollection,this.radialCount=0)}},getReflectivityColor:function(val){var index=Math.floor((val+30)/5)+1;return this.reflectivityColorMap[index]}});
OSH.UI.Styler.Polyline=OSH.UI.Styler.extend({initialize:function(properties){if(this._super(properties),this.properties=properties,this.locations=[],this.color="red",this.weight=1,this.opacity=1,this.smoothFactor=1,this.maxPoints=10,isUndefinedOrNull(properties.color)||(this.color=properties.color),isUndefinedOrNull(properties.weight)||(this.weight=properties.weight),isUndefinedOrNull(properties.opacity)||(this.opacity=properties.opacity),isUndefinedOrNull(properties.smoothFactor)||(this.smoothFactor=properties.smoothFactor),isUndefinedOrNull(properties.maxPoints)||(this.maxPoints=properties.maxPoints),!isUndefinedOrNull(properties.locationFunc)){var fn=function(rec){var loc=properties.locationFunc.handler(rec);this.locations.push(loc),this.locations.length>this.maxPoints&&this.locations.shift()}.bind(this);fn.fnName="location",this.addFn(properties.locationFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.colorFunc)){var fn=function(rec){this.color=properties.colorFunc.handler(rec)}.bind(this);fn.fnName="color",this.addFn(properties.colorFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.weightFunc)){var fn=function(rec){this.weight=properties.weightFunc.handler(rec)}.bind(this);fn.fnName="weight",this.addFn(properties.weightFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.opacityFunc)){var fn=function(rec){this.opacity=properties.opacityFunc.handler(rec)}.bind(this);fn.fnName="opacity",this.addFn(properties.opacityFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.smoothFactorFunc)){var fn=function(rec){this.smoothFactor=properties.smoothFactorFunc.handler(rec)}.bind(this);fn.fnName="smoothFactor",this.addFn(properties.smoothFactorFunc.dataSourceIds,fn)}},setData:function(dataSourceId,rec,view,options){this._super(dataSourceId,rec,view,options)&&(isUndefinedOrNull(view)||"function"!=typeof view.updatePolyline||view.updatePolyline(this))},clear:function($super){this.locations=[]}});
OSH.UI.Styler.PointMarker=OSH.UI.Styler.extend({initialize:function(properties){this._super(properties),this.initProperties(properties)},initProperties:function(properties){this.location={x:0,y:0,z:0},this.orientation={heading:0},this.icon=null,this.iconAnchor=[16,16],this.label=null,this.color="#000000",this.options={},this.updateProperties(properties)},updateProperties:function(properties){if(OSH.Utils.copyProperties(properties,this.properties,!0),isUndefinedOrNull(properties.location)||(this.location=properties.location),isUndefinedOrNull(properties.orientation)||(this.orientation=properties.orientation),isUndefinedOrNull(properties.icon)||(this.icon=properties.icon),isUndefinedOrNull(properties.iconAnchor)||(this.iconAnchor=properties.iconAnchor),isUndefinedOrNull(properties.label)||(this.label=properties.label),isUndefinedOrNull(properties.color)||(this.color=properties.color),!isUndefinedOrNull(properties.locationFunc)){var fn=function(rec,timeStamp,options){this.location=properties.locationFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="location",this.addFn(properties.locationFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.orientationFunc)){var fn=function(rec,timeStamp,options){this.orientation=properties.orientationFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="orientation",this.addFn(properties.orientationFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.iconFunc)){var fn=function(rec,timeStamp,options){this.icon=properties.iconFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="icon",this.addFn(properties.iconFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.labelFunc)){var fn=function(rec,timeStamp,options){this.label=properties.labelFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="label",this.addFn(properties.labelFunc.dataSourceIds,fn)}if(!isUndefinedOrNull(properties.colorFunc)){var fn=function(rec,timeStamp,options){this.color=properties.colorFunc.handler(rec,timeStamp,options)}.bind(this);fn.fnName="color",this.addFn(properties.colorFunc.dataSourceIds,fn)}},init:function(view){this._super(view),isUndefinedOrNull(view)||null===this.location||view.updateMarker(this,0,{})},setData:function(dataSourceId,rec,view,options){this._super(dataSourceId,rec,view,options)&&(isUndefinedOrNull(view)||isUndefinedOrNull(this.location)||(this.lastData={lastTimeStamp:rec.timeStamp,lastOptions:options,location:this.location},view.updateMarker(this,rec.timeStamp,options)))},clear:function(){},remove:function(view){isUndefinedOrNull(view)||view.removeMarker(this)},update:function(view){isUndefinedOrNull(view)||isUndefinedOrNull(this.lastData)?view.updateMarker(this,0,{}):(this.location=this.lastData.location,view.updateMarker(this,this.lastData.lastTimeStamp,this.lastData.lastOptions))}});
OSH.UI.View.Nvd3LineChartView=OSH.UI.View.ChartView.extend({initialize:function(parentElementDivId,viewItems,options){this._super(parentElementDivId,viewItems,options),this.entityId=options.entityId,this.xLabel="Time",this.yLabel="yAxisLabel";var useInteractiveGuideline=(d3.format(".02f"),!0),showLegend=!0,showYAxis=!0,showXAxis=!0;this.maxPoints=999,isUndefinedOrNull(options)||(options.xLabel&&(this.xLabel=options.xLabel),options.yLabel&&(this.yLabel=options.yLabel),options.xTickFormat&&options.xTickFormat,options.yTickFormat&&options.yTickFormat,options.showLegend&&(showLegend=options.showLegend),options.showXAxis&&(showXAxis=options.showXAxis),options.showYAxis&&(showYAxis=options.showYAxis),options.useInteractiveGuideline&&(useInteractiveGuideline=options.useInteractiveGuideline),options.transitionDuration&&options.transitionDuration,options.maxPoints&&(this.maxPoints=options.maxPoints)),this.chart=nv.models.lineChart().margin({left:75,right:25}).options({duration:1,useInteractiveGuideline:useInteractiveGuideline}).duration(1).showLegend(showLegend).showYAxis(showYAxis).showXAxis(showXAxis),this.chart.xAxis.axisLabel(this.xLabel).tickFormat(function(d){return d3.time.format.utc("%H:%M:%SZ")(new Date(d))}).axisLabelDistance(5),this.chart.yAxis.axisLabel(this.yLabel).tickFormat(d3.format(".02f")).axisLabelDistance(5),this.css=document.getElementById(this.divId).className,isUndefinedOrNull(options)||(options.css&&(this.css+=" "+options.css),options.cssSelected&&(this.cssSelected=options.cssSelected));var svg=document.createElementNS(d3.ns.prefix.svg,"svg");this.div=document.getElementById(this.divId),this.div.appendChild(svg),this.div.style.width=this.width,this.div.style.height=this.height,this.svgChart=d3.select("#"+this.divId+" svg");this.chart.legend.margin().bottom=25,isUndefinedOrNull(options)||isUndefinedOrNull(options.initData)||!options.initData||this.svgChart.datum([{values:[{y:0,x:0}],key:"",interpolate:"cardinal",area:!0}]).call(this.chart)},updateLinePlot:function(styler,timestamp,options){if(void 0===this.data){this.d3Data=[];options.name;this.data={values:[],key:this.names[styler.getId()],interpolate:"cardinal",area:!0,color:styler.color},this.data.values.push({y:styler.y,x:styler.x}),this.svgChart.datum([this.data]).call(this.chart),OSH.EventManager.observeDiv(this.divId,"click",function(event){OSH.EventManager.fire(OSH.EventManager.EVENT.SELECT_VIEW,{dataSourcesIds:styler.getDataSourcesIds(),entityId:styler.viewItem.entityId})})}else this.data.color=styler.color,isUndefinedOrNull(styler.viewItem.name)||(this.data.key=styler.viewItem.name),this.data.values.push({y:styler.y,x:styler.x});this.chart.update(),this.data.values.length>this.maxPoints&&this.data.values.shift()},updateProperties:function(properties){isUndefined(properties)||(isUndefinedOrNull(properties.xLabel)||(this.xLabel=properties.xLabel,this.chart.xAxis.axisLabel(this.xLabel)),isUndefinedOrNull(properties.yLabel)||(this.yLabel=properties.yLabel,this.chart.yAxis.axisLabel(this.yLabel)),isUndefinedOrNull(properties.maxPoints)||(this.maxPoints=properties.maxPoints))},selectDataView:function(dataSourceIds){var currentDataSources=this.getDataSourcesId();OSH.Utils.isArrayIntersect(dataSourceIds,currentDataSources)?this.div.setAttribute("class",this.css+" "+this.cssSelected):this.div.setAttribute("class",this.css)},removeLinePlot:function(styler){},reset:function(){this.data.values=[],this.chart.update()}});
OSH.UI.EntityTreeView=OSH.UI.View.extend({initialize:function(parentElementDivId,entityItems,options){this._super(parentElementDivId,[],options),this.entityItems=entityItems,this.initTree(options)},initTree:function(options){this.tree=createTree(this.divId,"white",null);for(var i=0;i<this.entityItems.length;i++){var currentItem=this.entityItems[i],entity=currentItem.entity,path=currentItem.path,treeIcon=currentItem.treeIcon,contextMenuId=currentItem.contextMenuId;path.endsWith("/")&&(path=path.substring(0,path.length-1));for(var folder=path.split("/"),nbNodes=folder.length,currentNode=this.tree,pos=0;nbNodes>0;){var existingChildNode=null;for(n=0;n<currentNode.childNodes.length;n++){var node=currentNode.childNodes[n];if(node.text===folder[pos]){existingChildNode=node;break}}currentNode=null==existingChildNode?currentNode===this.tree?this.tree.createNode(folder[pos],!1,"",this.tree,null,null):currentNode.createChildNode(folder[pos],!1,"",null,null):existingChildNode,pos++,nbNodes--}var entityNode;entityNode=currentNode===this.tree?this.tree.createNode(entity.name,!1,treeIcon,this.tree,entity,contextMenuId):currentNode.createChildNode(entity.name,!1,treeIcon,entity,contextMenuId),currentItem.node=entityNode}this.tree.drawTree()},selectDataView:function(dataSourcesIds,entityId){if(void 0!==entityId)for(var i=0;i<this.entityItems.length;i++){var currentItem=this.entityItems[i];if(currentItem.entity.id===entityId){this.tree.selectNode(currentItem.node,!1);for(var node=currentItem.node.parent;node!=this.tree;)this.tree.expandNode(node),node=node.parent}}},getType:function(){return OSH.UI.View.ViewType.ENTITY_TREE}});
OSH.UI.View.CesiumView=OSH.UI.View.MapView.extend({initialize:function(parentElementDivId,viewItems,properties){this._super(parentElementDivId,viewItems,properties);var cssClass=document.getElementById(this.divId).className;document.getElementById(this.divId).setAttribute("class",cssClass+" "+this.css),this.imageDrapingPrimitive=null,this.imageDrapingPrimitiveReady=!1,this.frameCount=0,this.captureCanvas=document.createElement("canvas"),this.captureCanvas.width=640,this.captureCanvas.height=480},updateMarker:function(styler,timeStamp,options){var markerId=0;styler.getId()in this.stylerToObj?markerId=this.stylerToObj[styler.getId()]:(markerId=this.addMarker({lat:styler.location.y,lon:styler.location.x,alt:styler.location.z,orientation:styler.orientation,color:styler.color,icon:styler.icon,label:styler.label,timeStamp:timeStamp,selected:void 0!==options.selected&&options.selected}),this.stylerToObj[styler.getId()]=markerId),this.updateMapMarker(markerId,{lat:styler.location.y,lon:styler.location.x,alt:styler.location.z,orientation:styler.orientation,color:styler.color,icon:styler.icon,timeStamp:timeStamp,selected:void 0!==options.selected&&options.selected})},updateDrapedImage:function(styler,timeStamp,options,snapshot){var llaPos=styler.platformLocation,camPos=Cesium.Cartesian3.fromDegrees(llaPos.x,llaPos.y,llaPos.z),DTR=Math.PI/180,attitude=styler.platformOrientation,gimbal=styler.gimbalOrientation,nedTransform=Cesium.Transforms.northEastDownToFixedFrame(camPos),camRot=new Cesium.Matrix3;Cesium.Matrix4.getRotation(nedTransform,camRot);var rotM=new Cesium.Matrix3,uavHeading=Cesium.Matrix3.fromRotationZ(attitude.heading*DTR,rotM);Cesium.Matrix3.multiply(camRot,uavHeading,camRot);var uavPitch=Cesium.Matrix3.fromRotationY(attitude.pitch*DTR,rotM);Cesium.Matrix3.multiply(camRot,uavPitch,camRot);var uavRoll=Cesium.Matrix3.fromRotationX(attitude.roll*DTR,rotM);Cesium.Matrix3.multiply(camRot,uavRoll,camRot);var gimbalYaw=Cesium.Matrix3.fromRotationZ(gimbal.heading*DTR,rotM);Cesium.Matrix3.multiply(camRot,gimbalYaw,camRot);var gimbalRoll=Cesium.Matrix3.fromRotationX(gimbal.roll*DTR,rotM);Cesium.Matrix3.multiply(camRot,gimbalRoll,camRot);var gimbalPitch=Cesium.Matrix3.fromRotationY((90+gimbal.pitch)*DTR,rotM);Cesium.Matrix3.multiply(camRot,gimbalPitch,camRot);var img2cam=Cesium.Matrix3.fromRotationZ(90*DTR,rotM);Cesium.Matrix3.multiply(camRot,img2cam,camRot);var camProj=styler.cameraModel.camProj,camDistR=styler.cameraModel.camDistR,camDistT=styler.cameraModel.camDistT,imgSrc=styler.imageSrc;if(snapshot){this.captureCanvas.getContext("2d").drawImage(imgSrc,0,0,this.captureCanvas.width,this.captureCanvas.height),imgSrc=this.captureCanvas}var encCamPos=Cesium.EncodedCartesian3.fromCartesian(camPos),appearance=new Cesium.MaterialAppearance({material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:imgSrc,camPosHigh:encCamPos.high,camPosLow:encCamPos.low,camAtt:Cesium.Matrix3.toArray(Cesium.Matrix3.transpose(camRot,new Cesium.Matrix3)),camProj:Cesium.Matrix3.toArray(camProj),camDistR:camDistR,camDistT:camDistT}}}),vertexShaderSource:Cesium._shaders.ImageDrapingVS,fragmentShaderSource:Cesium._shaders.ImageDrapingFS});if(null===this.imageDrapingPrimitive||snapshot){null===this.imageDrapingPrimitive&&(this.imageDrapingPrimitive={});var promise=Cesium.sampleTerrain(this.viewer.terrainProvider,11,[Cesium.Cartographic.fromDegrees(llaPos.x,llaPos.y)]),that=this;Cesium.when(promise,function(updatedPositions){var newImageDrapingPrimitive=that.viewer.scene.primitives.add(new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.RectangleGeometry({rectangle:Cesium.Rectangle.fromDegrees(llaPos.x-.1,llaPos.y-.1,llaPos.x+.1,llaPos.y+.1),height:updatedPositions[0].height-100,extrudedHeight:llaPos.z-1})}),appearance:appearance}));snapshot||(that.imageDrapingPrimitive=newImageDrapingPrimitive),that.viewer.scene.primitives.raiseToTop(that.imageDrapingPrimitive),that.imageDrapingPrimitiveReady=!0})}else this.imageDrapingPrimitiveReady&&(this.imageDrapingPrimitive.appearance=appearance);this.frameCount++},beforeAddingItems:function(options){this.markers={},this.first=!0;var imageryProviders=Cesium.createDefaultImageryProviderViewModels();this.viewer=new Cesium.Viewer(this.divId,{baseLayerPicker:!0,imageryProviderViewModels:imageryProviders,selectedImageryProviderViewModel:imageryProviders[6],timeline:!1,homeButton:!1,navigationInstructionsInitiallyVisible:!1,navigationHelpButton:!1,geocoder:!0,fullscreenButton:!1,showRenderLoopErrors:!0,animation:!1,targetFrameRate:10,scene3DOnly:!0}),this.viewer.terrainProvider=new Cesium.CesiumTerrainProvider({url:"//assets.agi.com/stk-terrain/world"}),this.viewer.scene.copyGlobeDepth=!0,this.viewer.scene._environmentState.useGlobeDepthFramebuffer=!0;var self=this;Cesium.knockout.getObservable(this.viewer,"_selectedEntity").subscribe(function(entity){if(Cesium.defined(entity)){var entityId,dataSrcIds=[];for(var stylerId in self.stylerToObj)if(self.stylerToObj[stylerId]===entity._dsid)for(var i=0;i<self.stylers.length;i++)if(self.stylers[i].getId()===stylerId){dataSrcIds=dataSrcIds.concat(self.stylers[i].getDataSourcesIds()),entityId=self.stylers[i].viewItem.entityId;break}OSH.EventManager.fire(OSH.EventManager.EVENT.SELECT_VIEW,{dataSourcesIds:dataSrcIds,entityId:entityId})}else OSH.EventManager.fire(OSH.EventManager.EVENT.SELECT_VIEW,{dataSourcesIds:[],entityId:null})}.bind(this))},addMarker:function(properties){var imgIcon="images/cameralook.png";null!==properties.icon&&(imgIcon=properties.icon);var isModel=imgIcon.endsWith(".glb"),name="";properties.label&&(name=properties.label);var geom;geom=isModel?{name:name,position:Cesium.Cartesian3.fromDegrees(0,0,0),model:{uri:imgIcon,scale:4,modelM:Cesium.Matrix4.IDENTITY.clone()}}:{position:Cesium.Cartesian3.fromDegrees(0,0,0),billboard:{image:imgIcon,rotation:Cesium.Math.toRadians(0),horizontalOrigin:Cesium.HorizontalOrigin.CENTER}};var entity=this.viewer.entities.add(geom),id="view-marker-"+OSH.Utils.randomUUID();return entity._dsid=id,this.markers[id]=entity,id},updateMapMarker:function(id,properties){var lon=properties.lon,lat=properties.lat,alt=properties.alt,orient=properties.orientation,imgIcon=properties.icon;if(!isNaN(lon)&&!isNaN(lat)){var marker=this.markers[id];(void 0===alt||isNaN(alt))&&(alt=this.getAltitude(lat,lon))>1&&(alt+=.3);var pos=Cesium.Cartesian3.fromDegrees(lon,lat,alt);if(marker.position=pos,void 0!==orient){var DTR=Math.PI/180,heading=orient.heading,quat=Cesium.Transforms.headingPitchRollQuaternion(pos,new Cesium.HeadingPitchRoll(heading*DTR,0,0*DTR));marker.orientation=quat}marker.billboard.image=imgIcon,this.first&&(this.viewer.zoomTo(this.viewer.entities,new Cesium.HeadingPitchRange(Cesium.Math.toRadians(0),Cesium.Math.toRadians(-90),2e3)),this.first=!1),properties.selected&&(this.viewer.selectedEntity=marker)}},getAltitude:function(lat,lon){var position=Cesium.Cartesian3.fromDegrees(lon,lat,0,this.viewer.scene.globe.ellipsoid,new Cesium.Cartesian3),altitude=this.viewer.scene.globe.getHeight(Cesium.Ellipsoid.WGS84.cartesianToCartographic(position));return("undefined"===altitude||altitude<=0)&&(altitude=.1),altitude}});
OSH.UI.View.LeafletView=OSH.UI.View.MapView.extend({initialize:function(parentElementDivId,viewItems,options){this._super(parentElementDivId,viewItems,options);var cssClass=document.getElementById(this.divId).className;document.getElementById(this.divId).setAttribute("class",cssClass+" "+this.css)},beforeAddingItems:function(options){this.initMap(options),this.initEvents()},initEvents:function(){document.getElementById(this.divId).oncontextmenu=function(e){new Object({keyCode:93});void 0!=e.preventDefault&&e.preventDefault(),void 0!=e.stopPropagation&&e.stopPropagation()}},initMap:function(options){var initialView={location:new L.LatLng(0,0),zoom:3};this.first=!0;var defaultLayers=this.getDefaultLayers(),defaultLayer=defaultLayers[0].layer,baseLayers={},overlays={};baseLayers[defaultLayers[0].name]=defaultLayers[0].layer,overlays[defaultLayers[1].name]=defaultLayers[1].layer,void 0!==options&&(options.initialView&&(initialView={location:new L.LatLng(options.initialView.lat,options.initialView.lon),zoom:options.initialView.zoom}),options.autoZoomOnFirstMarker||(this.first=!1),options.overlayLayers&&(overlays=options.overlayLayers),options.baseLayers&&(baseLayers=options.baseLayers),options.defaultLayer&&(defaultLayer=options.defaultLayer)),this.map=new L.Map(this.divId,{fullscreenControl:!0,layers:defaultLayer}),L.control.layers(baseLayers,overlays).addTo(this.map),this.map.setView(initialView.location,initialView.zoom),this.markers={},this.polylines={}},getDefaultBaseLayers:function(){return{}},getDefaultLayers:function(options){var maxZoom=22;void 0!==options&&options.maxZoom&&(maxZoom=options.maxZoom);var esriLayer=L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:'&copy; <a href="http://www.esri.com/">Esri</a>, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',maxZoom:maxZoom,maxNativeZoom:19});return[{name:"OSM Streets",layer:L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{id:"mapbox.streets",attribution:'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',maxZoom:maxZoom})},{name:"Esri Satellite",layer:esriLayer}]},initLayers:function(){var osm=new L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:1,maxZoom:22,attribution:'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'});this.map.addLayer(osm)},addMarker:function(properties){var marker=null;if(null!=properties.icon){var markerIcon=L.icon({iconAnchor:properties.iconAnchor,iconUrl:properties.icon});marker=L.marker([properties.lat,properties.lon],{icon:markerIcon})}else marker=L.marker([properties.lat,properties.lon]);marker.bindPopup(properties.name),marker.addTo(this.map),marker.setRotationAngle(properties.orientation);var id="view-marker-"+OSH.Utils.randomUUID();this.markers[id]=marker,this.first===!0&&(this.map.setView(new L.LatLng(properties.lat,properties.lon),19),this.first=!1);var self=this;return marker._icon.id=id,marker.on("click",function(){var dataSourcesIds=[];for(var stylerId in self.stylerToObj)if(self.stylerToObj[stylerId]==id){var styler=self.stylerIdToStyler[stylerId];OSH.EventManager.fire(OSH.EventManager.EVENT.SELECT_VIEW,{dataSourcesIds:dataSourcesIds.concat(styler.getDataSourcesIds()),entityId:styler.viewItem.entityId});break}}),document.getElementById(id).oncontextmenu=function(e){new Object({keyCode:93});void 0!=e.preventDefault&&e.preventDefault(),void 0!=e.stopPropagation&&e.stopPropagation();for(var stylerId in self.stylerToObj)if(self.stylerToObj[stylerId]==id){OSH.Utils.hasOwnNestedProperty(self.stylerIdToStyler[stylerId],"viewItem.contextMenuId")&&OSH.EventManager.fire(OSH.EventManager.EVENT.CONTEXT_MENU+"-"+self.stylerIdToStyler[stylerId].viewItem.contextMenuId,{offsetX:-70,offsetY:-70,action:"show",x:OSH.Utils.getXCursorPosition(),y:OSH.Utils.getYCursorPosition(),drawLineTo:id});break}}.bind(this),id},addPolyline:function(properties){for(var polylinePoints=[],i=0;i<properties.locations.length;i++)polylinePoints.push(new L.LatLng(properties.locations[i].y,properties.locations[i].x));var polyline=new L.Polyline(polylinePoints,{color:properties.color,weight:properties.weight,opacity:properties.opacity,smoothFactor:properties.smoothFactor}).addTo(this.map),id="view-polyline-"+OSH.Utils.randomUUID();return this.polylines[id]=polyline,id},removeMarker:function(styler){if(styler.id in this.stylerIdToStyler){var markerId=this.stylerToObj[styler.getId()],marker=this.markers[markerId];this.map.removeLayer(marker)}},updateMarker:function(styler){var markerId=0;styler.getId()in this.stylerToObj?markerId=this.stylerToObj[styler.getId()]:(markerId=this.addMarker({lat:styler.location.y,lon:styler.location.x,orientation:styler.orientation.heading,color:styler.color,icon:styler.icon,iconAnchor:styler.iconAnchor,name:this.names[styler.getId()]}),this.stylerToObj[styler.getId()]=markerId);var marker=this.markers[markerId];isUndefinedOrNull(styler.viewItem)||marker.bindPopup(styler.viewItem.name);var lon=styler.location.x,lat=styler.location.y;if(!isNaN(lon)&&!isNaN(lat)){var newLatLng=new L.LatLng(lat,lon);marker.setLatLng(newLatLng)}if(void 0!==styler.orientation&&marker.setRotationAngle(styler.orientation.heading),null!=styler.icon&&marker._icon.iconUrl!=styler.icon){var markerIcon=L.icon({iconAnchor:[16,16],iconUrl:styler.icon});marker.setIcon(markerIcon)}},updatePolyline:function(styler){var polylineId=0;if(styler.getId()in this.stylerToObj?polylineId=this.stylerToObj[styler.getId()]:(polylineId=this.addPolyline({color:styler.color,weight:styler.weight,locations:styler.locations,maxPoints:styler.maxPoints,opacity:styler.opacity,smoothFactor:styler.smoothFactor}),this.stylerToObj[styler.getId()]=polylineId),polylineId in this.polylines){var polyline=this.polylines[polylineId];this.map.removeLayer(polyline);for(var polylinePoints=[],i=0;i<styler.locations.length;i++)polylinePoints.push(new L.LatLng(styler.locations[i].y,styler.locations[i].x));var polyline=new L.Polyline(polylinePoints,{color:styler.color,weight:styler.weight,opacity:styler.opacity,smoothFactor:styler.smoothFactor}).addTo(this.map);this.polylines[polylineId]=polyline}},attachTo:function(parentElement){this._super(parentElement),this.map.invalidateSize()},onResize:function($super){this._super(),this.map.invalidateSize()}}),L.Map=L.Map.extend({openPopup:function(popup){return this._popup=popup,this.addLayer(popup).fire("popupopen",{popup:this._popup})}}),function(){var proto_initIcon=L.Marker.prototype._initIcon,proto_setPos=L.Marker.prototype._setPos,oldIE="msTransform"===L.DomUtil.TRANSFORM;L.Marker.addInitHook(function(){var iconAnchor=this.options.icon.options.iconAnchor;iconAnchor&&(iconAnchor=iconAnchor[0]+"px "+iconAnchor[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||iconAnchor||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0}),L.Marker.include({_initIcon:function(){proto_initIcon.call(this)},_setPos:function(pos){proto_setPos.call(this,pos),this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,oldIE?this._icon.style[L.DomUtil.TRANSFORM]=" rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(angle){return this.options.rotationAngle=angle,this.update(),this},setRotationOrigin:function(origin){return this.options.rotationOrigin=origin,this.update(),this}})}();
OSH.UI.View.OpenLayerView=OSH.UI.View.MapView.extend({initialize:function(parentElementDivId,viewItems,options){this._super(parentElementDivId,viewItems,options),this.onResize()},beforeAddingItems:function(options){this.initMap(options),void 0!==options&&options.map||this.initEvents()},initEvents:function(){document.getElementById(this.divId).oncontextmenu=function(e){new Object({keyCode:93});void 0!=e.preventDefault&&e.preventDefault(),void 0!=e.stopPropagation&&e.stopPropagation()};var self=this;this.map.getViewport().addEventListener("contextmenu",function(e){e.preventDefault();var feature=self.map.forEachFeatureAtPixel(self.map.getEventPixel(e),function(feature,layer){return feature});if(feature){var id=feature.ha;for(var stylerId in self.stylerToObj)if(self.stylerToObj[stylerId]==id){OSH.EventManager.fire(OSH.EventManager.EVENT.CONTEXT_MENU+"-"+self.stylerIdToStyler[stylerId].viewItem.contextMenuId,{offsetX:-70,offsetY:-70,action:"show",x:OSH.Utils.getXCursorPosition(),y:OSH.Utils.getYCursorPosition()});break}}}),this.map.on("click",function(e){self.map.forEachFeatureAtPixel(e.pixel,function(feature,layer){var id=feature.ha,dataSourcesIds=[];for(var stylerId in self.stylerToObj)if(self.stylerToObj[stylerId]==id){var styler=self.stylerIdToStyler[stylerId];OSH.EventManager.fire(OSH.EventManager.EVENT.SELECT_VIEW,{dataSourcesIds:dataSourcesIds.concat(styler.getDataSourcesIds()),entityId:styler.viewItem.entityId});break}})})},updateMarker:function(styler){var markerId=0;styler.getId()in this.stylerToObj?markerId=this.stylerToObj[styler.getId()]:(markerId=this.addMarker({lat:styler.location.y,lon:styler.location.x,orientation:styler.orientation.heading,color:styler.color,icon:styler.icon,name:this.names[styler.getId()]}),this.stylerToObj[styler.getId()]=markerId);var markerFeature=this.markers[markerId],lon=styler.location.x,lat=styler.location.y;if(!isNaN(lon)&&!isNaN(lat)){var coordinates=ol.proj.transform([lon,lat],"EPSG:4326","EPSG:900913");markerFeature.getGeometry().setCoordinates(coordinates)}if(null!=styler.icon){var iconStyle=new ol.style.Style({image:new ol.style.Icon({opacity:.75,src:styler.icon,rotation:styler.orientation.heading*Math.PI/180})});markerFeature.setStyle(iconStyle)}},updatePolyline:function(styler){var polylineId=0;if(styler.getId()in this.stylerToObj?polylineId=this.stylerToObj[styler.getId()]:(polylineId=this.addPolyline({color:styler.color,weight:styler.weight,locations:styler.locations,maxPoints:styler.maxPoints,opacity:styler.opacity,smoothFactor:styler.smoothFactor,name:this.names[styler.getId()]}),this.stylerToObj[styler.getId()]=polylineId),polylineId in this.polylines){for(var geometry=this.polylines[polylineId],polylinePoints=[],i=0;i<styler.locations.length;i++)polylinePoints.push(ol.proj.transform([styler.locations[i].x,styler.locations[i].y],"EPSG:4326","EPSG:900913"));geometry.setCoordinates(polylinePoints)}},initMap:function(options){var initialView=null;this.first=!0;var overlays=[];this.markers={},this.polylines={};var baseLayers=this.getDefaultLayers();if(void 0!==options){var maxZoom=19;if(options.map)return void(this.map=options.map);options.maxZoom&&(maxZoom=options.maxZoom),options.initialView&&(initialView=new ol.View({center:ol.proj.transform([options.initialView.lon,options.initialView.lat],"EPSG:4326","EPSG:900913"),zoom:options.initialView.zoom,maxZoom:maxZoom})),options.autoZoomOnFirstMarker||(this.first=!1),options.overlayLayers&&(overlays=options.overlayLayers),options.baseLayers&&(baseLayers=options.baseLayers),options.defaultLayer&&options.defaultLayer}else initialView=new ol.View({center:ol.proj.transform([0,0],"EPSG:4326","EPSG:900913"),zoom:11,maxZoom:maxZoom});this.map=new ol.Map({target:this.divId,controls:ol.control.defaults({attributionOptions:{collapsible:!1}}).extend([new ol.control.ZoomSlider,new ol.control.Rotate,new ol.control.ScaleLine]),interactions:ol.interaction.defaults().extend([new ol.interaction.Select({condition:ol.events.condition.mouseMove})]),layers:[new ol.layer.Group({title:"Base maps",layers:baseLayers}),new ol.layer.Group({title:"Overlays",layers:overlays})],view:initialView});var layerSwitcher=new ol.control.LayerSwitcher({tipLabel:"Layers"});this.map.addControl(layerSwitcher);var select_interaction=new ol.interaction.Select,self=this;select_interaction.getFeatures().on("add",function(e){var feature=e.element,dataSourcesIds=[];for(var stylerId in self.stylerToObj)if(self.stylerToObj[stylerId]==feature.getId()){var styler=self.stylerIdToStyler[stylerId];OSH.EventManager.fire(OSH.EventManager.EVENT.SELECT_VIEW,{dataSourcesIds:dataSourcesIds.concat(styler.getDataSourcesIds()),entityId:styler.viewItem.entityId});break}}),this.map.addInteraction(select_interaction)},getDefaultBaseLayers:function(){return{}},getDefaultLayers:function(){return[new ol.layer.Tile({title:"OSM",type:"base",visible:!0,source:new ol.source.OSM})]},addMarker:function(properties){var marker=new ol.geom.Point(ol.proj.transform([properties.lon,properties.lat],"EPSG:4326","EPSG:900913")),markerFeature=new ol.Feature({geometry:marker,name:"Marker"});if(null!=properties.icon){var iconStyle=new ol.style.Style({image:new ol.style.Icon({opacity:.75,src:properties.icon,rotation:properties.orientation*Math.PI/180})});markerFeature.setStyle(iconStyle)}var vectorMarkerLayer=new ol.layer.Vector({title:properties.name,source:new ol.source.Vector({features:[markerFeature]})});this.map.addLayer(vectorMarkerLayer);var id="view-marker-"+OSH.Utils.randomUUID();return markerFeature.setId(id),this.markers[id]=markerFeature,this.first&&(this.first=!1,this.map.getView().setCenter(ol.proj.transform([properties.lon,properties.lat],"EPSG:4326","EPSG:900913")),this.map.getView().setZoom(19)),id},createMarkerFromStyler:function(styler){if(styler.getId()in this.stylerToObj)return this.stylerToObj[styler.getId()];var properties={lat:styler.location.y,lon:styler.location.x,orientation:styler.orientation.heading,color:styler.color,icon:styler.icon,name:this.names[styler.getId()]},marker=new ol.geom.Point(ol.proj.transform([properties.lon,properties.lat],"EPSG:4326","EPSG:900913")),markerFeature=new ol.Feature({geometry:marker,name:"Marker"});if(null!=properties.icon){var iconStyle=new ol.style.Style({image:new ol.style.Icon({opacity:.75,src:properties.icon,rotation:properties.orientation*Math.PI/180})});markerFeature.setStyle(iconStyle)}var id="view-marker-"+OSH.Utils.randomUUID();return markerFeature.setId(id),this.markers[id]=markerFeature,this.stylerToObj[styler.getId()]=id,id},addPolyline:function(properties){for(var polylinePoints=[],i=0;i<properties.locations.length;i++)polylinePoints.push(ol.proj.transform([properties.locations[i].x,properties.locations[i].y],"EPSG:4326","EPSG:900913"));var pathGeometry=new ol.geom.LineString(polylinePoints),feature=new ol.Feature({geometry:pathGeometry,name:"Line"}),source=new ol.source.Vector({features:[feature]}),vectorPathLayer=new ol.layer.Vector({title:properties.name,source:source,style:new ol.style.Style({fill:new ol.style.Fill({color:properties.color}),stroke:new ol.style.Stroke({color:properties.color,width:properties.weight})})});this.map.addLayer(vectorPathLayer);var id="view-polyline-"+OSH.Utils.randomUUID();return this.polylines[id]=pathGeometry,id},onResize:function($super){this._super(),this.map.updateSize()}});
var htmlTaskingComponent="";htmlTaskingComponent+='<div class="ptz-zoom">',htmlTaskingComponent+='   <div class="ptz-zoom-in"><i class="fa fa-plus-circle" aria-hidden="true"></i></div>',htmlTaskingComponent+='   <div class="ptz-zoom-bar"></div>',htmlTaskingComponent+='   <div class="ptz-zoom-out"><i class="fa fa-minus-circle" aria-hidden="true"></i></div>',htmlTaskingComponent+="</div>",htmlTaskingComponent+='<div class="ptz">',htmlTaskingComponent+='   <div tag="0" class=\'moveUp\' name=""></div>',htmlTaskingComponent+='   <div tag="91" class=\'moveTopLeft\' name=""></div>',htmlTaskingComponent+='   <div tag="90" class="moveTopRight" name=""></div>',htmlTaskingComponent+='   <div tag="6" class="moveLeft" name=""></div>',htmlTaskingComponent+='   <div cmd="ptzReset" class="reset" title="Center" name=""></div>',htmlTaskingComponent+='   <div tag="4" class="moveRight" name=""></div>',htmlTaskingComponent+='   <div tag="93" class="moveBottomLeft" name=""></div>',htmlTaskingComponent+='   <div tag="92" class="moveBottomRight" name=""></div>',htmlTaskingComponent+='   <div tag="2" class="moveDown" name=""></div>',htmlTaskingComponent+="</div>",htmlTaskingComponent+='<div class="ptz-right">',htmlTaskingComponent+="<ul>",htmlTaskingComponent+="            <li>",htmlTaskingComponent+="                <label>Presets:</label>",htmlTaskingComponent+='                <div class="ptz-select-style">',htmlTaskingComponent+='                     <select class="ptz-presets" required pattern="^(?!Select a Preset).*">',htmlTaskingComponent+='                         <option value="" disabled selected>Select a Preset</option>',htmlTaskingComponent+="                     </select>",htmlTaskingComponent+="                </div>",htmlTaskingComponent+="            </li>",htmlTaskingComponent+="</ul>",htmlTaskingComponent+="</div>",OSH.UI.View.PtzTaskingView=OSH.UI.View.extend({initialize:function(divId,options){this._super(divId,[],options);var width="640",height="480";this.css="tasking",this.cssSelected="",void 0!==options&&(options.width&&(width=options.width),options.height&&(height=options.height),options.css&&(this.css+=options.css),options.cssSelected&&(this.cssSelected=options.cssSelected),options.dataSenderId&&(this.dataSenderId=options.dataSenderId)),this.rootTag=document.createElement("div"),this.rootTag.setAttribute("height",height),this.rootTag.setAttribute("width",width),this.rootTag.setAttribute("class",this.css),this.rootTag.setAttribute("id","dataview-"+OSH.Utils.randomUUID()),document.getElementById(this.divId).appendChild(this.rootTag),this.rootTag.innerHTML=htmlTaskingComponent,this.pan=0,this.tilt=0,this.zoom=0;this.observers=[],document.querySelector("#"+this.rootTag.id+" >  .ptz > .moveUp").onclick=function(){this.onTiltClick(5)}.bind(this),document.querySelector("#"+this.rootTag.id+" >  .ptz > .moveTopLeft").onclick=function(){this.onTiltPanClick(-5,5)}.bind(this),document.querySelector("#"+this.rootTag.id+" >  .ptz > .moveTopRight").onclick=function(){this.onTiltPanClick(5,5)}.bind(this),document.querySelector("#"+this.rootTag.id+" >  .ptz > .moveRight").onclick=function(){this.onPanClick(5)}.bind(this),document.querySelector("#"+this.rootTag.id+" >  .ptz > .moveLeft").onclick=function(){this.onPanClick(-5)}.bind(this),document.querySelector("#"+this.rootTag.id+" >  .ptz > .moveDown").onclick=function(){this.onTiltClick(-5)}.bind(this),document.querySelector("#"+this.rootTag.id+" >  .ptz > .moveBottomLeft").onclick=function(){this.onTiltPanClick(-5,-5)}.bind(this),document.querySelector("#"+this.rootTag.id+" >  .ptz > .moveBottomRight").onclick=function(){this.onTiltPanClick(5,-5)}.bind(this),document.querySelector("#"+this.rootTag.id+" >  .ptz-zoom > .ptz-zoom-in").onclick=function(){this.onZoomClick(5)}.bind(this),document.querySelector("#"+this.rootTag.id+" >  .ptz-zoom > .ptz-zoom-out").onclick=function(){this.onZoomClick(-5)}.bind(this),void 0!==options&&options.presets&&(this.addPresets(options.presets),document.querySelector("#"+this.rootTag.id+"  .ptz-right  .ptz-select-style  .ptz-presets").onchange=this.onSelectedPresets.bind(this))},addPresets:function(presetsArr){var selectTag=document.querySelector("#"+this.rootTag.id+"  .ptz-right  .ptz-select-style  .ptz-presets");for(var i in presetsArr){var option=document.createElement("option");option.text=presetsArr[i],option.value=presetsArr[i],selectTag.add(option)}},onSelectedPresets:function(event){var serverTag=document.querySelector("#"+this.rootTag.id+"  .ptz-right  .ptz-select-style  .ptz-presets"),option=serverTag.options[serverTag.selectedIndex];this.onChange(null,null,null,option.value)},removeInterval:function(interval){this.timerIds.length>0&&setTimeout(clearInterval(this.timerIds.pop()),interval+50)},onTiltClick:function(value){this.tilt+=value,this.onChange(null,value,null,null)},onTiltPanClick:function(tiltValue,panValue){this.tilt+=tiltValue,this.pan+=panValue,this.onChange(tiltValue,panValue,null,null)},onPanClick:function(value){this.pan+=value,this.onChange(value,null,null,null)},onZoomClick:function(value){this.zoom+=value,this.onChange(null,null,value,null)},onChange:function(rpan,rtilt,rzoom,preset){OSH.EventManager.fire(OSH.EventManager.EVENT.PTZ_SEND_REQUEST+"-"+this.dataSenderId,{cmdData:{rpan:rpan,rtilt:rtilt,rzoom:rzoom,preset:preset},onSuccess:function(event){console.log("Failed to send request: "+event)},onError:function(event){console.log("Request sent successfully: "+event)}})}});
OSH.UI.View.FFMPEGView=OSH.UI.View.VideoView.extend({initialize:function(divId,viewItems,options){this._super(divId,viewItems,options),this.useWorker=OSH.Utils.isWebWorker(),this.resetCalled=!0,this.useWebWorkerTransferableData=!1;var width=1920,height=1080;if(!isUndefinedOrNull(options)){if(options.width&&(width=options.width),options.height&&(height=options.height),this.useWorker=!isUndefinedOrNull(options.useWorker)&&options.useWorker&&OSH.Utils.isWebWorker(),!isUndefinedOrNull(options.adjust)&&options.adjust){var divElt=document.getElementById(this.divId);divElt.offsetWidth<width&&(width=divElt.offsetWidth),divElt.offsetHeight<height&&(height=divElt.offsetHeight)}!isUndefinedOrNull(options.useWebWorkerTransferableData)&&options.useWebWorkerTransferableData&&(this.useWebWorkerTransferableData=options.useWebWorkerTransferableData)}this.yuvCanvas=new YUVCanvas({width:width,height:height,contextOptions:{preserveDrawingBuffer:!0}}),document.getElementById(this.divId).appendChild(this.yuvCanvas.canvasElement);this.useWorker?this.initFFMPEG_DECODER_WORKER():this.initFFMEG_DECODER()},updateFrame:function(styler){this._super(styler);var pktData=styler.frame,pktSize=pktData.length;if(this.resetCalled=!1,this.useWorker)this.decodeWorker(pktSize,pktData);else{var decodedFrame=this.decode(pktSize,pktData);isUndefinedOrNull(decodedFrame)||(decodedFrame.frame_width!==this.yuvCanvas.width&&(this.yuvCanvas.canvasElement.width=decodedFrame.frame_width,this.yuvCanvas.width=decodedFrame.frame_width),decodedFrame.frame_height!==this.yuvCanvas.height&&(this.yuvCanvas.canvasElement.height=decodedFrame.frame_height,this.yuvCanvas.height=decodedFrame.frame_height),this.yuvCanvas.drawNextOuptutPictureGL({yData:decodedFrame.frameYData,yDataPerRow:decodedFrame.frame_width,yRowCnt:decodedFrame.frame_height,uData:decodedFrame.frameUData,uDataPerRow:decodedFrame.frame_width/2,uRowCnt:decodedFrame.frame_height/2,vData:decodedFrame.frameVData,vDataPerRow:decodedFrame.frame_width/2,vRowCnt:decodedFrame.frame_height/2}),this.updateStatistics(),this.onAfterDecoded())}this.checkFlush()},reset:function(){_avcodec_flush_buffers(this.av_ctx),this.resetCalled=!0;var nodata=new Uint8Array(1);this.yuvCanvas.drawNextOuptutPictureGL({yData:nodata,yDataPerRow:1,yRowCnt:1,uData:nodata,uDataPerRow:1,uRowCnt:1,vData:nodata,vDataPerRow:1,vRowCnt:1})},initFFMPEG_DECODER_WORKER:function(callback){this.worker=new Worker(window.OSH.BASE_WORKER_URL+"/osh-UI-FFMPEGViewWorker.js");var self=this;this.worker.onmessage=function(e){var decodedFrame=e.data;this.resetCalled||(self.yuvCanvas.canvasElement.drawing=!0,decodedFrame.frame_width!=self.yuvCanvas.width&&(self.yuvCanvas.canvasElement.width=decodedFrame.frame_width,self.yuvCanvas.width=decodedFrame.frame_width),decodedFrame.frame_height!=self.yuvCanvas.height&&(self.yuvCanvas.canvasElement.height=decodedFrame.frame_height,self.yuvCanvas.height=decodedFrame.frame_height),self.yuvCanvas.drawNextOuptutPictureGL({yData:decodedFrame.frameYData,yDataPerRow:decodedFrame.frame_width,yRowCnt:decodedFrame.frame_height,uData:decodedFrame.frameUData,uDataPerRow:decodedFrame.frame_width/2,uRowCnt:decodedFrame.frame_height/2,vData:decodedFrame.frameVData,vDataPerRow:decodedFrame.frame_width/2,vRowCnt:decodedFrame.frame_height/2}),self.yuvCanvas.canvasElement.drawing=!1,self.updateStatistics(),self.onAfterDecoded())}.bind(this)},decodeWorker:function(pktSize,pktData){var data={pktSize:pktSize,pktData:pktData.buffer,byteOffset:pktData.byteOffset};this.useWebWorkerTransferableData?this.worker.postMessage(data,[data.pktData]):this.worker.postMessage(data)},checkFlush:function(){!this.useWorker&&this.nbFrames>=this.FLUSH_LIMIT&&(this.nbFrames=0,_avcodec_flush_buffers(this.av_ctx))},initFFMEG_DECODER:function(){Module.ccall("avcodec_register_all");var codec=Module.ccall("avcodec_find_decoder_by_name","number",["string"],["h264"]);return 0==codec?void console.error("Could not find H264 codec"):(this.av_ctx=_avcodec_alloc_context3(codec),_avcodec_open2(this.av_ctx,codec,0)<0?void console.error("Could not initialize codec"):(this.av_pkt=Module._malloc(96),this.av_pktData=Module._malloc(153600),_av_init_packet(this.av_pkt),Module.setValue(this.av_pkt+24,this.av_pktData,"*"),this.av_frame=_avcodec_alloc_frame(),this.av_frame||alert("Could not allocate video frame"),this.got_frame=Module._malloc(4),void(this.maxPktSize=51200)))},decode:function(pktSize,pktData){if(pktSize>this.maxPktSize&&(this.av_pkt=Module._malloc(96),this.av_pktData=Module._malloc(pktSize),_av_init_packet(this.av_pkt),Module.setValue(this.av_pkt+24,this.av_pktData,"*"),this.maxPktSize=pktSize),Module.setValue(this.av_pkt+28,pktSize,"i32"),Module.writeArrayToMemory(pktData,this.av_pktData),_avcodec_decode_video2(this.av_ctx,this.av_frame,this.got_frame,this.av_pkt)<0)return void console.log("Error while decoding frame");if(0!=Module.getValue(this.got_frame,"i8")){var decoded_frame=this.av_frame,frame_width=Module.getValue(decoded_frame+68,"i32"),frame_height=Module.getValue(decoded_frame+72,"i32"),frameYDataPtr=Module.getValue(decoded_frame,"*"),frameUDataPtr=Module.getValue(decoded_frame+4,"*"),frameVDataPtr=Module.getValue(decoded_frame+8,"*");return{frame_width:frame_width,frame_height:frame_height,frameYDataPtr:frameYDataPtr,frameUDataPtr:frameUDataPtr,frameVDataPtr:frameVDataPtr,frameYData:new Uint8Array(Module.HEAPU8.buffer,frameYDataPtr,frame_width*frame_height),frameUData:new Uint8Array(Module.HEAPU8.buffer,frameUDataPtr,frame_width/2*frame_height/2),frameVData:new Uint8Array(Module.HEAPU8.buffer,frameVDataPtr,frame_width/2*frame_height/2)}}}});
OSH.UI.View.H264View=OSH.UI.View.VideoView.extend({initialize:function(divId,viewItems,options){this._super(divId,viewItems,options);var width="640",height="480";void 0!==options&&(options.width&&(width=options.width),options.height&&(height=options.height));this.hasSps=!1,this.avcWs=new Player({useWorker:!1,reuseMemory:!1,webgl:"auto",size:{width:width,height:height}}),this.video=this.avcWs.canvas,this.video.setAttribute("width",width),this.video.setAttribute("height",height),document.getElementById(this.divId).appendChild(this.video)},decode:function(fullNal){this.avcWs.decode(fullNal)},updateFrame:function(styler){this._super(styler),this.computeFullNalFromRaw(data.data,function(nal){var nalType=31&nal[0];7!=nalType&&8!=nalType&&1!=nalType&&5!=nalType&6!=nalType||(7==nalType&&(this.hasSps=!0),this.hasSps&&this.decode(nal))}.bind(this))},computeFullNalFromRaw:function(data,callback){if(data&&data.length){for(var endIndex=-1,firstIndex=-1,nalSeparator=!1;(firstIndex=data.indexOf(1,firstIndex+1))!=-1&&(nalSeparator=0==data[firstIndex-1],nalSeparator&=0==data[firstIndex-2],!(nalSeparator&=0==data[firstIndex-3])););if(nalSeparator){for(endIndex=firstIndex;(endIndex=data.indexOf(1,endIndex+1))!=-1;)nalSeparator=0==data[endIndex-1],nalSeparator&=0==data[endIndex-2],(nalSeparator&=0==data[endIndex-3])&&(callback(data.subarray(firstIndex+1,endIndex-3)),firstIndex=endIndex);endIndex==-1&&(callback(data.subarray(firstIndex+1,data.length)),firstIndex=endIndex)}}}});
OSH.UI.View.MjpegView=OSH.UI.View.VideoView.extend({initialize:function(divId,viewItems,options){if(this._super(divId,viewItems,options),this.imgTag=document.createElement("img"),this.imgTag.setAttribute("id","dataview-"+OSH.Utils.randomUUID()),this.rotation=0,isUndefinedOrNull(options)||isUndefinedOrNull(options.rotation))document.getElementById(this.divId).appendChild(this.imgTag);else{this.rotation=options.rotation*Math.PI/180,this.canvas=document.createElement("canvas"),this.canvas.width=640,this.canvas.height=480;var ctx=this.canvas.getContext("2d");ctx.translate(0,480),ctx.rotate(this.rotation),document.getElementById(this.divId).appendChild(this.canvas)}},updateFrame:function(styler){this._super(styler);var oldBlobURL=this.imgTag.src;this.imgTag.src=styler.frame,window.URL.revokeObjectURL(oldBlobURL),this.updateStatistics(),this.onAfterDecoded()},reset:function(){this.imgTag.src=""}});
OSH.UI.View.Mp4View=OSH.UI.View.VideoView.extend({initialize:function(divId,viewItems,options){this._super(divId,viewItems,options);this.video=document.createElement("video"),this.video.setAttribute("control",""),document.getElementById(this.divId).appendChild(this.video),this.init=!1,this.mp4box=new MP4Box},updateFrame:function(styler){var frame=styler.frame;if(this.init)isUndefinedOrNull(this.sourcebuffer)||(console.log("append"),this.sourcebuffer.updating||this.queue.length>0?this.queue.push(frame):this.sourcebuffer.appendBuffer(frame));else{this.init=!0,frame.fileStart=0;var self=this;this.mp4box.onError=function(e){console.error("MP4 error")},this.mp4box.onReady=function(info){OSH.Asserts.checkArrayIndex(info.tracks,0),self.createMediaSource(info.tracks[0],function(sourcebuffer){self.sourcebuffer=sourcebuffer})},self.mp4box.appendBuffer(frame),self.mp4box.flush()}},createMediaSource:function(mp4track,callback){if(!1 in window)throw new ReferenceError("There is no MediaSource property in window object.");var codec=(mp4track.id,mp4track.codec),mime='video/mp4; codecs="'+codec+'"';if(!MediaSource.isTypeSupported(mime))throw console.log("Can not play the media. Media of MIME type "+mime+" is not supported."),"Media of type "+mime+" is not supported.";this.queue=[];var mediaSource=new MediaSource;this.video.src=window.URL.createObjectURL(mediaSource),mediaSource.addEventListener("sourceopen",function(e){mediaSource.duration=1e7;var playPromise=this.video.play();void 0!==playPromise&&playPromise.then(function(){}).catch(function(error){});var sourcebuffer=mediaSource.addSourceBuffer(mime);sourcebuffer.addEventListener("updatestart",function(e){this.queue.length>0&&!this.buffer.updating&&sourcebuffer.appendBuffer(this.queue.shift())}.bind(this)),sourcebuffer.addEventListener("error",function(e){}),sourcebuffer.addEventListener("abort",function(e){}),sourcebuffer.addEventListener("updateend",function(){this.queue.length>0&&sourcebuffer.appendBuffer(this.queue.shift())}.bind(this)),callback(sourcebuffer)}.bind(this),!1),mediaSource.addEventListener("sourceopen",function(e){}),mediaSource.addEventListener("sourceended",function(e){}),mediaSource.addEventListener("sourceclose",function(e){}),mediaSource.addEventListener("error",function(e){})}});